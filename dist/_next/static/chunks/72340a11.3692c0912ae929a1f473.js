(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[6],{ydiI:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdaptableNoCodeWizard=t.Adaptable=t.waitForCondition=void 0;const o=i("mrSG"),n=i("DR3G"),l=o.__importDefault(i("hbEN")),r=o.__importDefault(i("Muja")),s=o.__importDefault(i("UXvI")),a=o.__importDefault(i("lE2N")),d=o.__importStar(i("q1tI")),u=o.__importStar(i("i8i4")),p=o.__importDefault(i("8QLk")),h=i("EYOP"),c=i("RQz/"),m=i("w5Eo"),g=i("0J2a"),C=o.__importStar(i("fwGq")),f=i("fwGq"),y=o.__importStar(i("+Pxh")),O=i("02Nn"),S=o.__importDefault(i("F9nB")),A=i("zwJd"),E=i("qN6A"),b=o.__importDefault(i("vs66")),v=o.__importDefault(i("U/tm")),N=o.__importDefault(i("1f9d")),w=i("z1Bd"),I=i("pBDx"),F=o.__importStar(i("fkJU")),D=i("adxL"),G=i("KOcV"),R=i("9G3X"),V=i("+0VI"),x=i("bQXN"),P=i("SF8o"),T=i("QEyg"),_=i("hNCx"),L=i("fmQe"),M=i("QIb0"),k=o.__importDefault(i("vk8B")),H=i("n6u+"),U=o.__importDefault(i("OUop")),K=i("yRSI"),B=i("pioK"),j=i("wnz6"),z=i("CUPq"),W=i("YKwl"),Q=i("eoug"),$=i("E/Df"),q=i("66p8"),Y=i("r072"),J=i("Zss7");n.ModuleRegistry.registerModules(n.AllCommunityModules);const X=e=>{e&&(e.field&&!e.colId&&(e.colId=e.field),e.children?e.children.forEach(X):e.colId||I.LogAdaptableWarning("A column is missing the colId - please check ",e,'Either pass a "field" property or a "colId" property.'))};t.waitForCondition=(e,t=5e3)=>{const i=Date.now();return e()?Promise.resolve():new Promise((o,n)=>{const l=o=>{const r=e();Date.now()-i>t?n("Wait time expired"):r?o():setTimeout(()=>{l(o)},16)};l(o)})};const Z=n.RowNode.prototype,ee=Z.dispatchLocalEvent,te=n.GridApi.prototype.setColumnDefs,ie=(e,t,i)=>{e.forEach((e,o,n)=>{e.children?ie(e.children,t,e):t(e,o,n,i)})},oe={};class ne{constructor(){this.colDefPropertyCache=new Map,this.gridOptionsPropertyCache=new Map,this.flashingState=new Map,this._on=(e,t)=>this.emitter?this.emitter.on(e,t):()=>{},this._emit=(e,t)=>{if(this.emitter)return this.emitter.emit(e,t)},this._emitSync=(e,t)=>{if(this.emitter)return this.emitter.emitSync(e,t)},this._adaptableReady=!1,this.agGridModules=[],this.isPluginLoaded=e=>{const t=this.adaptableOptions.plugins||[];for(let i=0,o=t.length;i<o;i++){if(t[i].pluginId===e)return!0}return!1},this.debouncedSetColumnIntoStore=l.default(()=>{this.gridOptions.api&&this.updateColumnsIntoStore()},f.HALF_SECOND),this.debouncedSaveGridLayout=l.default(()=>{this.gridOptions.api&&this.updateLayoutFromGrid()},f.HALF_SECOND),this.debouncedSetSelectedCells=l.default(()=>{this.gridOptions.api&&this.setSelectedCells()},250),this.debouncedSetSelectedRows=l.default(()=>{this.gridOptions.api&&this.setSelectedRows()},f.HALF_SECOND),this.debouncedFilterGrid=l.default((e=(()=>{}))=>{this.gridOptions.api&&(this.applyGridFiltering(),e&&e())},f.HALF_SECOND),this.mapColumnDefs=(e,t,i)=>(i=i||{removeEmpty:!1},e=e||this.getGroupAndColumnDefs(),ie(e,(e,o,n,l)=>{const r=t(e,o,n),s=l?l.children:n;s[o]=r,o===n.length-1&&i.removeEmpty&&l&&(l.children=s.filter(e=>!!e))}),i.removeEmpty&&(e=e.filter(e=>!!e)),e),this.getGroupAndColumnDefs=()=>[].concat(this.currentColumnDefs||this.gridOptions.columnDefs),this.getColumnDefsWithCorrectVisibility=()=>{const e=this.api.layoutApi.getCurrentVisibleColumnIdsMap();return this.gridOptions.columnApi.getAllColumns().map(t=>{const i=t.getColDef(),o=t.getColId();return i.colId=o,i.hide=!e[o],i})},this.getPreviousColDefInfo=e=>e.__ab||{}}static init(e){return ne.initInternal(e)}static async initInternal(e,t){let i=null;if(Array.isArray(e.plugins))for(let n of e.plugins)i=i&&i.then?i.then(()=>n.beforeInit(e)):n.beforeInit(e);const o=i=>i.init(e,t,!0).then(t=>(Array.isArray(e.plugins)&&e.plugins.forEach(e=>{e.afterInit(i)}),t));if(i&&i.then)return i.then(()=>{const e=new ne;return o(e)});{const e=new ne;return o(e)}}static collectInstance(e){e._id=e.adaptableOptions.adaptableId||m.createUuid(),oe[e._id]=e}static forEachAdaptable(e){Object.keys(oe).forEach(t=>{e(oe[t])})}static dismissInstance(e){delete oe[e._id]}async init(e,t,i){var o,n,l,r,a,d,p;return i||I.ConsoleLogWarning('\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n!!!!!!! You should not use the "Adaptable" constructor directly, as it was deprecated in v6 and removed in v7!\n!!!!!!!\n!!!!!!! Use const api = await Adaptable.init(adaptableOptions) instead.\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!'),this.emitter=new S.default,this.adaptableOptions=v.default.assignadaptableOptions(e),this.hasAutogeneratedPrimaryKey()&&(I.LogAdaptableInfo("Autogenerated primary key (adaptableOptions.autogeneratedPrimaryKey = TRUE) should be used only as a last resort,\n      when no unique column is available, as it limits some Adaptable functionalities!\n\n      For more details see: https://docs.adaptabletools.com/docs/key-topics/primary-key"),this.adaptableOptions.primaryKey=f.AUTOGENERATED_PK_COLUMN),ne.collectInstance(this),v.default.checkAdaptableOptions(this.adaptableOptions),this.runtimeConfig=t||{},this.agGridModules=this.runtimeConfig.modules||[],this.gridOptions=this.adaptableOptions.vendorGrid,void 0===this.gridOptions.allowContextMenuWithControlKey&&(this.gridOptions.allowContextMenuWithControlKey=!0),this.isInitialised=!1,this.useRowNodeLookUp=!1,this.forPlugins(e=>e.afterInitOptions(this,this.adaptableOptions)),this.api=new h.AdaptableApiImpl(this),this.forPlugins(e=>e.afterInitApi(this,this.api)),this.DataService=new G.DataService(this),this.agGridHelper=new B.agGridHelper(this,this.gridOptions),this.agGridMenuHelper=new j.agGridMenuHelper(this,this.gridOptions),this.initStore(),this.ValidationService=new P.ValidationService(this),this.ReportService=new V.ReportService(this),this.ModuleService=new x.ModuleService(this),this.CalculatedColumnExpressionService=new D.CalculatedColumnExpressionService(this),this.EntitlementService=new T.EntitlementService(this),this.ExpressionService=new _.ExpressionService(this),this.AlertService=new L.AlertService(this),this.TeamSharingService=new R.TeamSharingService(this),this.forPlugins(e=>e.afterInitServices(this)),this.modules=this.agGridHelper.setUpModules(),this.forPlugins(e=>e.afterInitModules(this,this.modules)),this.gridOptions.api&&(this.gridOptions.api.__adaptable=this),this.gridOptions.columnTypes=this.gridOptions.columnTypes||{},Object.assign(this.gridOptions.columnTypes,{[f.AB_SPECIAL_COLUMN]:{},abColDefNumber:null!==(o=this.gridOptions.columnTypes.abColDefNumber)&&void 0!==o?o:{},abColDefString:null!==(n=this.gridOptions.columnTypes.abColDefString)&&void 0!==n?n:{},abColDefBoolean:null!==(l=this.gridOptions.columnTypes.abColDefBoolean)&&void 0!==l?l:{},abColDefDate:null!==(r=this.gridOptions.columnTypes.abColDefDate)&&void 0!==r?r:{},abColDefObject:null!==(a=this.gridOptions.columnTypes.abColDefObject)&&void 0!==a?a:{},abColDefCustom:null!==(d=this.gridOptions.columnTypes.abColDefCustom)&&void 0!==d?d:{},abColDefNumberArray:null!==(p=this.gridOptions.columnTypes.abColDefNumberArray)&&void 0!==p?p:{}}),void 0===this.gridOptions.columnTypes.abColDefNumber.cellEditor&&(this.gridOptions.columnTypes.abColDefNumber.cellEditor=q.AdaptableNumberEditor),void 0===this.gridOptions.columnTypes.abColDefDate.cellEditor&&(this.gridOptions.columnTypes.abColDefDate.cellEditor=Y.AdaptableDateEditor),this.initializeAgGrid().then(e=>{if(!e)return I.ConsoleLogError("Unable to set up ag-Grid"),this.api;let t=this;return this.gridOptions.api&&(this.gridOptions.api.__adaptable=this,this.gridOptions.api.setColumnDefs=function(e){t.currentColumnDefs=[].concat(e);const i=te.apply(this,arguments);return t.setupColumns(),i}),this.adaptableStore.Load.then(()=>{this.initInternalGridLogic(),v.default.checkValidPrimaryKey(this)},e=>{I.ConsoleLogError("Failed to Init Modules : ",e),this.initInternalGridLogic(),this.api.internalApi.hideLoadingScreen()}).then(async()=>{this.isInitialised=!0,this.api.internalApi.hideLoadingScreen()}),null==this.abContainerElement&&(this.abContainerElement=this.getadaptableContainerElement()),null!=this.abContainerElement&&(this.abContainerElement.innerHTML="",u.render(M.AdaptableApp({Adaptable:this}),this.abContainerElement)),this.throttleFilterOnEditDataChange=s.default(this.gridOptions.api.onFilterChanged,this.adaptableOptions.searchOptions.filterActionOnUserDataChange.throttleDelay),this.throttleFilterOnTickingDataChange=s.default(this.gridOptions.api.onFilterChanged,this.adaptableOptions.searchOptions.filterActionOnExternalDataChange.throttleDelay),this.api})}forPlugins(e){Array.isArray(this.adaptableOptions.plugins)&&this.adaptableOptions.plugins.forEach(t=>{e(t)})}getPlugin(e){const t=(this.adaptableOptions.plugins||[]).filter(t=>t.pluginId===e)[0];if(!t)throw`Cannot find plugin "${e}". Make sure you spelled it right!`;return t}getPluginProperty(e,t,...i){const o=(this.adaptableOptions.plugins||[]).filter(t=>t.pluginId===e)[0];if(!o)throw`Cannot find plugin "${e}". Make sure you spelled it right!`;if(o&&o.hasProperty(t))return o.getProperty(t)(...i)}lookupPlugins(e,...t){const i=this.adaptableOptions.plugins||[];for(let o=0,n=i.length;o<n;o++){const n=i[o];if(n.hasProperty(e))return n.getProperty(e)(...t)}}initStore(){this.adaptableStore=new g.AdaptableStore(this),this.adaptableStore.onAny((e,t)=>{this.performAudit(t.action,t.state,t.newState),this.forPlugins(i=>i.onStoreEvent(e,t,this.adaptableStore)),e==g.INIT_STATE&&(this._adaptableReady=!0,this.modules.forEach(e=>e.updateOldConfig()),this.forPlugins(e=>e.onAdaptableReady(this,this.adaptableOptions)),this.api.eventApi.emit("AdaptableReady",{adaptableApi:this.api,vendorGrid:this.adaptableOptions.vendorGrid}))})}performAudit(e,t,i){const o={actionName:e.type,clientTimestamp:new Date,userName:this.adaptableOptions.userName,adaptableId:this.adaptableOptions.adaptableId,adaptableStateKey:this.adaptableOptions.adaptableStateKey,action:e,oldState:t,newState:i};this.api.eventApi.emit("AdaptableStateChanged",o)}initializeAgGrid(){var e;if(this.useRowNodeLookUp=this.agGridHelper.TrySetUpNodeIds(),Array.isArray(this.gridOptions.columnDefs)&&this.gridOptions.columnDefs.forEach(X),(null===(e=this.adaptableOptions.generalOptions)||void 0===e?void 0:e.hideEmptyGroupRows)&&(this.gridOptions.components=this.gridOptions.components||{},this.gridOptions.autoGroupColumnDef=this.gridOptions.autoGroupColumnDef||{},this.gridOptions.autoGroupColumnDef.cellRenderer||(this.gridOptions.autoGroupColumnDef.cellRenderer="__adaptableGroupCellRenderer",this.gridOptions.components.__adaptableGroupCellRenderer=Q.AdaptableGroupCellRenderer)),this.adaptableOptions.userInterfaceOptions.showAdaptableToolPanel&&this.gridOptions.sideBar){this.gridOptions.sideBar=this.gridOptions.sideBar||{},this.gridOptions.components=this.gridOptions.components||{};const e=this.gridOptions.sideBar;if(!0===e)this.gridOptions.sideBar=this.agGridHelper.createAdaptableSideBarDefs(!0,!0);else if("columns"===e)this.gridOptions.sideBar=this.agGridHelper.createAdaptableSideBarDefs(!1,!0);else if("filters"===e)this.gridOptions.sideBar=this.agGridHelper.createAdaptableSideBarDefs(!0,!1);else{const e=this.gridOptions.sideBar;e&&(e.toolPanels=e.toolPanels||[],e.toolPanels.push(this.agGridHelper.createAdaptableToolPanel()))}this.gridOptions.components.AdaptableToolPanel=H.getAdaptableToolPanelAgGridComponent(this),this.gridOptions.api&&this.gridOptions.api.setSideBar(this.gridOptions.sideBar)}const i=()=>{let e=this.getGridContainerElement();return!(!e&&(e=this.initVendorContainerFromInitializedAgGrid(),!e))||(I.ConsoleLogError("You must provide an element id in `containerOptions.vendorContainer`"),!1)};if(this.gridOptions.api&&"function"===typeof this.gridOptions.api.getValue)return i()?Promise.resolve(!0):Promise.resolve(!1);if(this.runtimeConfig.waitForAgGrid)return t.waitForCondition(()=>!!this.gridOptions.api).then(()=>(this.initVendorContainerFromInitializedAgGrid(),Promise.resolve(!0)),()=>(I.ConsoleLogError("Could not find any agGrid instance rendered."),Promise.reject(!1)));if(!i())return Promise.resolve(!1);let o;const l=(this.adaptableOptions.vendorGrid||{}).modules||[];this.agGridModules=[...this.agGridModules,...l];const r=this.getGridContainerElement();return this.gridOptions.modules&&delete this.gridOptions.modules,o=new n.Grid(r,this.gridOptions,{modules:l}),this.gridOptions.api&&(this.gridOptions.api.__adaptable=this),Promise.resolve(null!=o)}initVendorContainerFromInitializedAgGrid(){if(this.getGridContainerElement())return;const e=this.gridOptions.api&&this.gridOptions.api.gridOptionsWrapper&&this.gridOptions.api.gridOptionsWrapper.layoutElements||[];let t;e.length||e.push(this.gridOptions.api.gridBodyCon.eGridBody);for(let i=0,o=e.length;i<o;i++){const o=e[i];if(o&&o.matches(".ag-root-wrapper, .ag-root")){const e=o.closest('[class*="ag-theme"]');if(e){t=e;break}}}return t||I.ConsoleLogError("Could not find the agGrid vendor container. This will probably break some AdapTable functionality."),this.adaptableOptions.containerOptions.vendorContainer=t}filterOnEditDataChange(){this.adaptableOptions.searchOptions.filterActionOnUserDataChange.applyFilter==c.FilterOnDataChangeOptions.Always?this.gridOptions.api.onFilterChanged():this.adaptableOptions.searchOptions.filterActionOnUserDataChange.applyFilter==c.FilterOnDataChangeOptions.Throttle&&this.throttleFilterOnEditDataChange()}filterOnTickingDataChange(){this.adaptableOptions.searchOptions.filterActionOnExternalDataChange.applyFilter==c.FilterOnDataChangeOptions.Always?this.gridOptions.api.onFilterChanged():this.adaptableOptions.searchOptions.filterActionOnExternalDataChange.applyFilter==c.FilterOnDataChangeOptions.Throttle&&this.throttleFilterOnTickingDataChange()}applyGridFiltering(){this.api.filterApi.isQuickFilterAvailable()&&(this.api.filterApi.isQuickFilterVisible()?this.showQuickFilter():this.hideQuickFilter()),this.gridOptions.api.onFilterChanged(),this._emit("GridFiltered"),this.setSelectedCells(),this.setSelectedRows()}isGroupRowNode(e){return!!e&&(!!e.isEmptyRowGroupNode()||(!(!e.group||!0!==e.group)||!(!e.leafGroup||!0!==e.leafGroup)))}isVisibleNode(e){return null!=this.gridOptions.api.getRenderedNodes().find(t=>t.id==e.id)}isPinnedRowNode(e){return!!e&&!!e.isRowPinned()}clearGridFiltering(){this.gridOptions.columnApi.getAllColumns().forEach(e=>{e.setFilterActive(!1)})}clearColumnFiltering(e){e.forEach(e=>{const t=this.gridOptions.columnApi.getAllColumns().find(t=>t.getColId()==e);t&&t.setFilterActive(!1)})}hideFilterForm(){this.hideFilterFormPopup&&this.hideFilterFormPopup()}updateColumnsIntoStore(){const e=[],t=this.gridOptions.columnApi.getAllColumns(),i=this.gridOptions.columnApi.getAllDisplayedColumnGroups(),o={},n=i.reduce((e,t)=>{var i,n,l;if(!(null===(n=null===(i=t.getOriginalColumnGroup)||void 0===i?void 0:i.call(t))||void 0===n?void 0:n.getColGroupDef()))return e;const r=t.getGroupId(),s=!t.getOriginalColumnGroup().getColGroupDef().marryChildren,a=null!==(l=t.getOriginalColumnGroup().getColGroupDef().headerName)&&void 0!==l?l:r,d=t.getLeafColumns();return d.forEach(t=>{const i={ColumnGroupId:r,FriendlyName:a,AllowGroupSplit:s,GroupCount:0};o[i.ColumnGroupId]=o[i.ColumnGroupId]||0,o[i.ColumnGroupId]+=d.length,e[t.getColId()]=i}),e},{});Object.keys(n).forEach(e=>{n[e].GroupCount=o[n[e].ColumnGroupId]}),t.forEach(t=>{const i=t.getColId();this.api.columnApi.isRowGroupColumn(i)||e.push(this.createAdaptableColumn(t,n))}),this.api.internalApi.setColumns(e)}createAdaptableColumn(e,t){return this.agGridHelper.createAdaptableColumnFromVendorColumn(e,t)}safeSetColDefs(e){e=this.mapColumnDefs(e,e=>(e.field&&null==e.colId&&(e.colId=e.field),e)),this.gridOptions.api.setColumnDefs(e),this.updateColumnsIntoStore()}getFormatColumnCellStyle(e,t){if(!e.IncludeGroupedRows&&this.isGroupRowNode(t.node))return;let i={};const o=e.ColumnStyle;if(o){const e=null===o||void 0===o?void 0:o.GradientStyle;if(e){const n=this.api.formatColumnApi.getNumericStyleMinValue(o,t.node,t.value),l=this.api.formatColumnApi.getNumericStyleMaxValue(o,t.node,t.value),r=p.default(t.value,n,l);let s,a=!1;if(e.ColumnComparison)s=e.ColumnComparison.Color;else{const t=e.CellRanges.find(e=>e.Min<=r&&e.Max>=r);t&&(s=t.Color,a=t.ReverseGradient)}const d=Math.abs(l-n),u=(t.value-n)/d*100;let h=Number((u/100).toPrecision(2));a&&(h=1-h),i.backgroundColor=J(s).setAlpha(h).toRgbString()}}else e.Style&&(i=this.convertAdaptableStyleToCSS(e.Style));if(e.CellAlignment)switch(e.CellAlignment){case"Left":i.textAlign="left";break;case"Right":i.textAlign="right";break;case"Center":i.textAlign="center"}return i}getAlertCellStyle(e,t){const i=this.api.internalApi.getAdaptableAlerts().filter(i=>{var o;return(null===(o=i.alertDefinition.AlertProperties)||void 0===o?void 0:o.HighlightCell)&&i.dataChangedInfo&&i.dataChangedInfo.columnId===e.ColumnId&&i.dataChangedInfo.rowNode===t.node})[0];if(i)return{backgroundColor:U.default.getColorByMessageType(i.alertDefinition.MessageType)}}getFlashingAlertRowStyle(e){const t=this.getPrimaryKeyValueFromRowNode(e.node);return this.getFlashingAlertStyleFor(t)}getFlashingAlertStyleFor(e,t){var i;const o=this.api.internalApi.getAdaptableFlashingAlertFor(e,t);return o?this.convertAdaptableStyleToCSS(null!==(i="up"===o.direction?o.flashingAlertDefinition.UpChangeStyle:"down"===o.direction?o.flashingAlertDefinition.DownChangeStyle:o.flashingAlertDefinition.NeutralChangeStyle)&&void 0!==i?i:{}):{}}getFlashingAlertCellStyle(e,t){const i=this.getPrimaryKeyValueFromRowNode(t.node);return this.getFlashingAlertStyleFor(i,e.ColumnId)}getCellHighlightStyle(e,t){var i;const o=this.getPrimaryKeyValueFromRowNode(t.node),n=this.api.internalApi.getSystemState().HighlightedCells.find(t=>e.ColumnId===t.columnId&&t.primaryKeyValue===o);if(n){switch(null!==(i=n.highlightType)&&void 0!==i?i:"Info"){case"Error":return{backgroundColor:"var(--ab-color-error)"};case"Info":return{backgroundColor:"var(--ab-color-info)"};case"Success":return{backgroundColor:"var(--ab-color-success)"};case"Warning":return{backgroundColor:"var(--ab-color-warn)"}}}}getQuickSearchCellStyle(){const e=this.api.quickSearchApi.getQuickSearchStyle();if(e&&!E.StringExtensions.IsNotNullOrEmpty(e.ClassName))return this.convertAdaptableStyleToCSS(e)}getEditableCellStyle(e,t){const i=this.api.userInterfaceApi.getEditableCellStyle();if(!i)return;const o=this.getGridCellFromRowNode(t.node,e.ColumnId);return o&&this.api.gridApi.areCellsEditable([o])?this.convertAdaptableStyleToCSS(i):void 0}getReadOnlyCellStyle(e,t){const i=this.api.userInterfaceApi.getReadOnlyCellStyle();if(!i)return;const o=this.getGridCellFromRowNode(t.node,e.ColumnId);return o&&!this.api.gridApi.areCellsEditable([o])?this.convertAdaptableStyleToCSS(i):void 0}getConditionalStyleCellStyle(e=[],t,i){const o=this.ModuleService.getModuleById(y.ConditionalStyleModuleId),n=e.reduce((e,n)=>o.isConditionalStyleActiveForColumn(n,t,i)?Object.assign(Object.assign({},e),n.Style):e,{});return this.convertAdaptableStyleToCSS(n)}getConditionalStyleCellClass(e=[],t,i){const o=this.ModuleService.getModuleById(y.ConditionalStyleModuleId);return e.map(e=>{var n,l;if((null===(n=e.Style)||void 0===n?void 0:n.ClassName)&&o.isConditionalStyleActiveForColumn(e,t,i))return null===(l=e.Style)||void 0===l?void 0:l.ClassName}).filter(e=>!!e).join(" ")}isQuickSearchActive(e,t){if(e.IsExcludedFromQuickSearch)return!1;if(!t.node||t.node.group)return!1;let i=this.api.quickSearchApi.getQuickSearchValue();if(E.StringExtensions.IsNullOrEmpty(i))return!1;const o=F.default.CreateColumnFilter(e.ColumnId,"Contains",[i]);return this.api.filterApi.evaluateColumnFilter(o,t.node)}getPrimaryKeyValueFromRowNode(e){var t;let i,o=this.getGridOptionsApi();return o&&!this.hasAutogeneratedPrimaryKey()&&(i=o.getValue(this.adaptableOptions.primaryKey,e)),(null===i||void 0==i)&&e&&e.data&&(i=null!==(t=e.data[this.adaptableOptions.primaryKey])&&void 0!==t?t:null),i}getSortedColumnStateForVisibleColumns(e,t){t=t||this.gridOptions.columnApi.getColumnState();const i=e.reduce((e,t,i)=>(e[t]=i,e),{}),o=t.reduce((e,t,i)=>(e[t.colId]=i,e),{}),n=e.reduce((e,t,i)=>(e[t]=i,e),{});return[...t].sort((e,t)=>{const i=e.colId,l=t.colId,r=o[i],s=o[l],a=this.api.columnApi.isRowGroupColumn(i),d=this.api.columnApi.isRowGroupColumn(l);return a&&d?1:a?-1:d?1:null!=n[i]&&null==n[l]?-1:null==n[i]&&null!=n[l]?1:null==n[i]&&null==n[l]?r-s:n[e.colId]-n[t.colId]}).map(e=>Object.assign(Object.assign({},e),{hide:null==i[e.colId]}))}setColumnOrder(e){const t=this.getSortedColumnStateForVisibleColumns(e);this.gridOptions.columnApi.setColumnState(t),this.updateColumnsIntoStore()}persistLayout(e){this.api.layoutApi.shouldAutoSaveLayout(e)?this.api.layoutApi.saveLayout(e):this.api.internalApi.updateCurrentDraftLayout(e)}setLayout(e){var t,i,o,n,l,s;e||(e=this.api.layoutApi.getCurrentLayout()),e.Columns=e.Columns||[];const a=e.Columns.reduce((e,t)=>(e[t]=!0,e),{}),d=this.gridOptions.columnApi.getColumnState(),u={},p=d.reduce((e,t,i)=>(u[t.colId]=i,e[t.colId]=t,e),{});let h=0;const c=(null!==(t=e.ColumnSorts)&&void 0!==t?t:[]).reduce((e,t)=>{const i=t.ColumnId;return a[i]?(e[i]={colId:i,sort:"Asc"===t.SortOrder?"asc":"desc",sortIndex:h},h++,e):e},{}),m=(e.RowGroupedColumns||[]).reduce((e,t,i)=>(e[t]=i,e),{});let g={};const C=e.AggregationColumns||{},f=[...e.PivotColumns||[],...Object.keys(e.AggregationColumns||{})],y=e.EnablePivot?f||[]:e.Columns;f.length&&e.RowGroupedColumns&&f.push(...e.RowGroupedColumns);let O=!1;const S={};let E=this.getSortedColumnStateForVisibleColumns(y,d);if(E=E.map(t=>{var i,o,n,l;const{colId:s}=t,d=p[s],u=!a[s],h=Object.assign(Object.assign({},d),{hide:u});e.ColumnWidthMap&&null!=e.ColumnWidthMap[s]?h.width=e.ColumnWidthMap[s]:S[s]=!0,h.rowGroupIndex=null!=m[s]?m[s]:null,h.rowGroup=null!=h.rowGroupIndex;const f=!!e.PinnedColumnsMap&&e.PinnedColumnsMap[s];if(f&&(h.pinned=f),h.pivotIndex=null,null!=g[s]&&(h.pivotIndex=g[s]),h.aggFunc=null,null!=C[s]){const e=null===(o=null===(i=this.gridOptions)||void 0===i?void 0:i.api)||void 0===o?void 0:o.getColumnDef(s);h.aggFunc=!0===C[s]?null!==(l=null!==(n=t.aggFunc)&&void 0!==n?n:null===e||void 0===e?void 0:e.aggFunc)&&void 0!==l?l:"sum":C[s]}return c[s]?(h.sort=c[s].sort,h.sortIndex=c[s].sortIndex):(h.sort=null,h.sortIndex=null),O=O||!r.default(h,d),h}).filter(e=>!!e),!O){const e=e=>`${e.colId}-${e.rowGroupIndex}-${e.pivotIndex}-${e.aggFunc}-${e.pinned}-${e.width}-${e.hide}`,t=d.map(e).join(","),i=E.map(e).join(",");O=i!=t}const b=!!e.EnablePivot,v=this.gridOptions.columnApi.isPivotMode()!==b;O=O||v,A.ArrayExtensions.IsNotNullOrEmpty(e.ExpandedRowGroupValues)&&this.adaptableOptions.layoutOptions.includeExpandedRowGroups&&this.expandRowGroupsForValues(e.ExpandedRowGroupValues),O&&(v&&this.gridOptions.columnApi.setPivotMode(b),this.gridOptions.columnApi.setColumnState(E),this.api.gridApi.setColumnSorts(e.ColumnSorts),this.gridOptions.columnApi.setPivotColumns(e.PivotColumns||[]),te.call(this.gridOptions.api,this.gridOptions.api.getColumnDefs()));const N=Object.keys(S);if(b&&(null===(o=null===(i=this.adaptableOptions)||void 0===i?void 0:i.layoutOptions)||void 0===o?void 0:o.autoSizeColumnsInPivotLayout))return requestAnimationFrame(()=>{this.gridOptions.columnApi.autoSizeAllColumns()}),void setTimeout(()=>{var e;null===(e=this.gridOptions.columnApi)||void 0===e||e.autoSizeAllColumns(),setTimeout(()=>{var e;null===(e=this.gridOptions.columnApi)||void 0===e||e.autoSizeAllColumns()},200)},100);(null===(l=null===(n=this.adaptableOptions)||void 0===n?void 0:n.layoutOptions)||void 0===l?void 0:l.autoSizeColumnsInLayout)&&N.length&&(null===(s=this.gridOptions.columnApi)||void 0===s||s.autoSizeColumns(N)),this.forPlugins(t=>{t.afterSetLayout&&t.afterSetLayout(this,e)})}updateLayoutFromGrid(){const e=this.api.layoutApi.getCurrentLayout(),t=Object.assign({},e),i=[],o={},n={},l=[],r=this.gridOptions.columnApi.getColumnState();let s=[...new Array(r.length)],a=[...new Array(r.length)];const d=[],u={},p=r.reduce((e,t)=>{const{colId:r}=t;return t.sort&&null!=t.sortIndex&&l.push({ColumnId:r,SortOrder:"asc"===t.sort?"Asc":"Desc",SortIndex:t.sortIndex}),null!=t.width&&(e[r]=t.width),null!=t.flex&&(o[r]=t.flex),"left"===t.pinned&&(n[r]="left"),"right"===t.pinned&&(n[r]="right"),t.hide||i.push(r),null!=t.rowGroupIndex&&(s[t.rowGroupIndex]=r),null!=t.pivotIndex&&(a[t.pivotIndex]=r),t.aggFunc&&"string"===typeof t.aggFunc&&(u[r]=t.aggFunc),e},{});l.sort((e,t)=>e.SortIndex-t.SortIndex),this.gridOptions.columnApi.getPivotColumns().forEach(e=>{d.push(e.getColId())}),s=s.filter(e=>!!e),a=a.filter(e=>!!e),t.ColumnWidthMap=p,t.PinnedColumnsMap=n,t.Columns=i,t.ColumnSorts=l,t.RowGroupedColumns=s,Object.keys(u).length&&(t.AggregationColumns=u),t.EnablePivot=this.gridOptions.columnApi.isPivotMode(),t.PivotColumns=d,this.adaptableOptions.layoutOptions.includeExpandedRowGroups&&(t.ExpandedRowGroupValues=this.getExpandRowGroupsKeys()),this.persistLayout(t)}setSelectedCells(){if(!this.isGridSelectable())return;const e=this.gridOptions.api.getCellRanges(),t=[],i=[];if(this.api.internalApi.isGridInPivotMode())return;e&&e.forEach(e=>{let o=!0;if(e.startRow&&e.endRow){let n=null!=e.startRow.rowPinned,l=null!=e.endRow.rowPinned;if(n&&(l&&(o=!1),I.ConsoleLogWarning("Cannot select pinned rows in ag-Grid.")),o){const o=Math.min(e.startRow.rowIndex,e.endRow.rowIndex),n=Math.max(e.startRow.rowIndex,e.endRow.rowIndex);for(const l of e.columns)if(null!=l){const e=l.getColId(),r=this.api.columnApi.getColumnFromId(e);r&&null==t.find(e=>e.ColumnId==r.ColumnId)&&t.push(r);for(let t=o;t<=n;t++){const o=this.gridOptions.api.getModel().getRow(t);if(o&&!this.isPinnedRowNode(o)){const t=this.getGridCellFromRowNode(o,e);i.push(t)}}}}}});const o={columns:t,gridCells:i};return this.api.internalApi.setSelectedCells(o),this._emit("CellsSelected"),this.agGridHelper.fireSelectionChangedEvent(),o}setSelectedRows(){if(!this.isGridSelectable())return;const e=this.gridOptions.api.getSelectedNodes(),t=[];if(this.gridOptions.columnApi.isPivotMode())return;A.ArrayExtensions.IsNotNullOrEmpty(e)&&e.forEach(e=>{const i={isMaster:!(null==e.master||1!=e.master),isExpanded:!(null==e.expanded||1!=e.expanded),isGroup:!(null==e.group||1!=e.group),level:e.level},o={primaryKeyValue:this.getPrimaryKeyValueFromRowNode(e),rowData:e.data,rowNode:e,rowInfo:i};t.push(o)});const i={GridRows:t};return this.api.internalApi.setSelectedRows(i),this.agGridHelper.fireSelectionChangedEvent(),i}setValue(e){let t,i=this.api.columnApi.getColumnDataTypeFromColumnId(e.columnId);if(t=i==c.DataType.Number?Number(e.newValue):e.newValue,void 0!=i)if(e.rowNode)e.rowNode.setDataValue(e.columnId,t);else if(this.useRowNodeLookUp){const i=this.gridOptions.api.getRowNode(e.primaryKeyValue);null!=i&&(i.setDataValue(e.columnId,t),e.rowNode=i)}else{let i=!1;this.gridOptions.api.getModel().forEachNode(o=>{i||e.primaryKeyValue==this.getPrimaryKeyValueFromRowNode(o)&&(o.setDataValue(e.columnId,t),e.rowNode=o,i=!0)})}}cancelEdit(){this.gridOptions.api.stopEditing(!0)}getDistinctValuesForColumn(e,t,i){let o=[];const n=this.api.userInterfaceApi.getPermittedValuesForColumn(e);A.ArrayExtensions.IsNotNull(n)?o=n.map(t=>({rawValue:t,displayValue:t,normalisedValue:t,columnId:e.ColumnId,rowNode:void 0})):t?this.gridOptions.api.forEachNodeAfterFilter(t=>{const n=this.addDistinctColumnValue(t,e.ColumnId);n&&void 0!=n.rawValue&&n.rowNode!==i&&o.push(n)}):this.gridOptions.api.forEachNode(t=>{const n=this.addDistinctColumnValue(t,e.ColumnId);n&&void 0!=n.rawValue&&n.rowNode!==i&&o.push(n)});return a.default(o,"displayValue").slice(0,this.adaptableOptions.searchOptions.maxColumnValueItemsDisplayed)}getColumnValueDisplayValuePairList(e,t,i){const o=[];let n=new Map;const l=this.api.columnApi.getColumnFromId(e),r=this.api.userInterfaceApi.getPermittedValuesForColumn(l);A.ArrayExtensions.IsNotNullOrEmpty(r)?r.forEach(t=>{n.set(t,{rawValue:t,displayValue:t,normalisedValue:t,columnId:e,rowNode:void 0})}):n=null;this.shouldUseRawValueForColumn(l);const s=(e,t,l)=>{if(e&&!this.isGroupRowNode(e)){const l=this.getGridCellFromRowNode(e,t);let r=!n||n.has(l.displayValue);if(r&&i){let t=this.getPrimaryKeyValueFromRowNode(e);r=!!i[t]}r&&o.push(l)}};return t?this.gridOptions.api.forEachNodeAfterFilter(t=>{s(t,e)}):this.gridOptions.api.forEachNode(t=>{s(t,e)}),o.slice(0,this.adaptableOptions.searchOptions.maxColumnValueItemsDisplayed)}addDistinctColumnValue(e,t){if(e&&!this.isGroupRowNode(e)){const i=this.getGridCellFromRowNode(e,t);if(w.Helper.objectExists(i))return i}}shouldUseRawValueForColumn(e){const t=this.gridOptions.api.getColumnDef(e.ColumnId);return!(!t||null==t.cellRenderer)||!!this.api.columnApi.isFormatNumericStyleColumn(e)}getDisplayValue(e,t){let i;if(this.useRowNodeLookUp){const o=this.gridOptions.api.getRowNode(e),n=this.getGridCellFromRowNode(o,t);n&&(i=n.displayValue)}else{let o=!1;this.gridOptions.api.getModel().forEachNode(n=>{if(!o){const l=this.getGridCellFromRowNode(n,t);l&&e==l.primaryKeyValue&&(i=l.displayValue),o=!0}})}return i}getGridCellFromRowNode(e,t){if(null==e)return;const i=this.getPrimaryKeyValueFromRowNode(e),o=this.getRawValueFromRowNode(e,t),n=this.getDisplayValueFromRawValue(t,o),l=this.getNormalisedValueFromRowValue(o,t);this.api.columnApi.getColumnFromId(t);return{rawValue:o,displayValue:n,normalisedValue:l,columnId:t,primaryKeyValue:i,rowNode:e}}getDisplayValueFromRowNode(e,t){const i=this.getGridCellFromRowNode(e,t);return i?i.displayValue:void 0}getFormattedValueFromRowNode(e,t){if(null==e)return;const i=this.getRawValueFromRowNode(e,t);return this.getFormattedValueFromRawValue(t,i)}getDisplayValueFromRawValue(e,t,i=!1){const o=this.api.columnApi.getColumnFromId(e);if(this.api.columnApi.isFormatNumericStyleColumn(o)){const i=this.gridOptions.api.getColumnDef(e);return"function"==typeof i.valueFormatter?this.getFormattedValue(t,e,i,i.valueFormatter):this.agGridHelper.getCleanValue(t)}if(this.api.columnApi.isActionColumn(e))return this.agGridHelper.getCleanValue(t);const n=this.gridOptions.api.getColumnDef(e);if(n){if("function"==typeof n.valueFormatter){const o=this.getFormattedValue(t,e,n,n.valueFormatter);return n.cellRenderer&&!i?this.agGridHelper.getRenderedValue(n,o):o||""}if(n.cellRenderer&&!i)return this.agGridHelper.getRenderedValue(n,t)}return this.agGridHelper.getCleanValue(t)}getFormattedValue(e,t,i,o){return o({value:e,node:null,data:null,colDef:i,column:this.gridOptions.columnApi.getAllColumns().find(e=>e.getColId()==t),api:this.gridOptions.api,columnApi:this.gridOptions.columnApi,context:this.gridOptions.context})}getFormattedValueFromRawValue(e,t){return this.getDisplayValueFromRawValue(e,t,!0)}getNormalisedValueFromRowValue(e,t){if(void 0===e||null===e)return e;const i=this.api.columnApi.getColumnDataTypeFromColumnId(t);return"String"===i?"string"!==typeof e?String(e):e:"Number"===i?"number"!==typeof e?Number(e):e:"Boolean"===i?"boolean"!==typeof e?Boolean(e):e:"Date"===i?e instanceof Date?e:new Date(e):e}getRawValueFromRowNode(e,t){return this.gridOptions.api.getValue(t,e)}getDataRowFromRowNode(e){return null!=e&&void 0!=e?e.data:void 0}getRowNodeForPrimaryKey(e){if(this.useRowNodeLookUp)return this.gridOptions.api.getRowNode(e);this.gridOptions.api.getModel().forEachNode(t=>{if(e==this.getPrimaryKeyValueFromRowNode(t))return t})}getRowNodesForPrimaryKeys(e){let t=[];return this.useRowNodeLookUp?e.forEach(e=>{const i=this.gridOptions.api.getRowNode(e);i&&t.push(i)}):e.forEach(e=>{let i=!1;this.gridOptions.api.getModel().forEachNode(o=>{i||e!=this.getPrimaryKeyValueFromRowNode(o)||(t.push(o),i=!0)})}),t}forAllRowNodesDo(e){this.gridOptions.api.getModel().forEachNode(t=>{e(t)})}forAllVisibleRowNodesDo(e){this.gridOptions.api.forEachNodeAfterFilterAndSort((t,i)=>{e(t,i)})}selectNodes(e){A.ArrayExtensions.IsNotNullOrEmpty(e)&&e.forEach(e=>this.selectNode(e))}selectNode(e){e?e.setSelected(!0,!0):I.LogAdaptableError("No node to select")}selectCells(e,t,i){const o={rowStartIndex:t.rowIndex,rowEndIndex:i.rowIndex,columns:e};this.gridOptions.api.addCellRange(o)}isRowNodeVisible(e){let t=!1;return this.gridOptions.api.forEachNodeAfterFilter(i=>{i==e&&(t=!0)}),t}redrawBody(){this.gridOptions.api.redrawRows(),this._emit("GridRefreshed")}redrawHeader(){this.gridOptions.api.refreshHeader()}redrawRow(e){const t={rowNodes:[e]};try{this.gridOptions.api.redrawRows(t)}catch(i){I.ConsoleLogError("ag-grid redrawRows was unable to find some row nodes. Tried to redraw row node: ",e,i)}}refreshCells(e,t,i){const o={rowNodes:e,columns:t,force:i};this.gridOptions.api.refreshCells(o)}jumpToRow(e){this.gridOptions.api.ensureNodeVisible(e,"middle")}jumpToColumn(e){this.gridOptions.api.ensureColumnVisible(e)}jumpToCell(e,t){this.jumpToRow(t),this.jumpToColumn(e)}getColDefsForSpecialColumns(){return[...this.getColDefsForCalculatedColumns(),...this.getColDefsForActionColumns(),...this.getColDefsForFreeTextColumns()]}getColDefsForFreeTextColumns(){let e=this.api.internalApi.getAdaptableOptions().searchOptions.enableFilterOnSpecialColumns;return this.api.freeTextColumnApi.getAllFreeTextColumn().map(t=>{const i="Number"===t.DataType?q.AdaptableNumberEditor:"Date"===t.DataType?Y.AdaptableDateEditor:null;return{headerName:t.FriendlyName||t.ColumnId,colId:t.ColumnId,editable:!0,hide:!0,filter:e,sortable:!0,resizable:!0,enableRowGroup:!0,cellEditor:null!==i&&void 0!==i?i:t.TextEditor&&"Large"==t.TextEditor?"agLargeTextCellEditor":"agTextCellEditor",type:[f.AB_SPECIAL_COLUMN,this.agGridHelper.getAgGridDataType(t.DataType)],valueSetter:e=>e.data[t.ColumnId]=e.newValue,cellRenderer:t.DataType&&"Boolean"==t.DataType?this.agGridHelper.createCheckboxRendererComp(t.ColumnId,!1):void 0,valueGetter:e=>this.api.freeTextColumnApi.getFreeTextColumnValueFromRowNode(t,e.node)}})}setupColumnValueGetter({col:e}){this.setColDefProperty(e,"valueGetter",e=>e)}setupColumnAggFunc({col:e}){this.setColDefProperty(e,"aggFunc",e=>e)}getColDefsForActionColumns(){return this.api.userInterfaceApi.getAllActionColumn().map(e=>({headerName:e.friendlyName?e.friendlyName:e.columnId,colId:e.columnId,editable:!1,hide:!1,filter:!1,sortable:!1,resizable:!0,cellRenderer:K.ActionColumnRenderer,type:[f.AB_SPECIAL_COLUMN,"abColDefObject"]}))}updateColDefsForSpecialColumns(){const e=this.getColDefsForSpecialColumns(),t=[...this.getGroupAndColumnDefs().filter(e=>{const{type:t}=e;return!(t===f.AB_SPECIAL_COLUMN||Array.isArray(t)&&t.includes(f.AB_SPECIAL_COLUMN))}),...e];this.safeSetColDefs(t),this.setLayout()}getColDefsForCalculatedColumns(){return this.api.calculatedColumnApi.getAllCalculatedColumn().map(e=>{var t;if(!e.CalculatedColumnSettings){let t=!this.adaptableOptions.searchOptions.enableFilterOnSpecialColumns||this.adaptableOptions.searchOptions.enableFilterOnSpecialColumns;e.CalculatedColumnSettings=F.CreateEmptyCalculatedColumn(t).CalculatedColumnSettings}e.CalculatedColumnSettings.DataType||(e.CalculatedColumnSettings.DataType=this.CalculatedColumnExpressionService.GetCalculatedColumnDataType(null===(t=e.Query)||void 0===t?void 0:t.ScalarExpression));const i={headerName:e.FriendlyName?e.FriendlyName:e.ColumnId,colId:e.ColumnId,hide:!0,editable:!1,width:e.CalculatedColumnSettings.Width,enableValue:e.CalculatedColumnSettings.Aggregatable,filter:e.CalculatedColumnSettings.Filterable,floatingFilter:e.CalculatedColumnSettings.Filterable,resizable:e.CalculatedColumnSettings.Resizable,enableRowGroup:e.CalculatedColumnSettings.Groupable,sortable:e.CalculatedColumnSettings.Sortable,enablePivot:e.CalculatedColumnSettings.Pivotable,type:[f.AB_SPECIAL_COLUMN,this.agGridHelper.getAgGridDataType(e.CalculatedColumnSettings.DataType)],valueGetter:t=>{var i;return this.CalculatedColumnExpressionService.ComputeExpressionValue(null===(i=e.Query)||void 0===i?void 0:i.ScalarExpression,t.node)}};return null!=e.CalculatedColumnSettings.ShowToolTip&&1==e.CalculatedColumnSettings.ShowToolTip&&(i.tooltipValueGetter=()=>{var t;return null===(t=e.Query)||void 0===t?void 0:t.ScalarExpression}),i})}isRegularColDef(e){return void 0===e.children}isGroupColDef(e){return void 0!==e.children}getColDefs(){let e=this.getGroupAndColumnDefs(),t=[];return e.forEach(e=>{this.isRegularColDef(e)&&t.push(e)}),t}getGroupedColDefs(){let e=this.getGroupAndColumnDefs(),t=[];return e.forEach(e=>{this.isGroupColDef(e)&&t.push(e)}),t}getFirstRowNode(){let e;return this.gridOptions.api.forEachNode(t=>{t.group||(e=t)}),e}destroy(e){var t,i,o,n,l,r;this.gridOptions&&this.gridOptions.api&&(this.gridOptions.api.__adaptable=null,this.gridOptions.api.setColumnDefs=te,this.gridOptions.getRowStyle=null,e&&!1===e.destroyApi||this.gridOptions.api.destroy()),this.colDefPropertyCache=null,this.gridOptionsPropertyCache=null,this.currentColumnDefs=null,this.rowListeners=null,this.emitter.clearListeners(),this.emitter=null,this._adaptableReady=!1,ne.dismissInstance(this);const s=this.getadaptableContainerElement();e&&!e.unmount||(null!=s&&u.unmountComponentAtNode(s),null===(t=this.CalculatedColumnExpressionService)||void 0===t||t.desstroy(),null===(i=this.DataService)||void 0===i||i.desstroy(),null===(o=this.EntitlementService)||void 0===o||o.desstroy(),null===(n=this.ReportService)||void 0===n||n.desstroy(),null===(l=this.ModuleService)||void 0===l||l.desstroy(),null===(r=this.ValidationService)||void 0===r||r.desstroy())}getDefaultIPPStyle(){return{Header:{headerColor:"#000000",headerBackColor:"#f5f7f7",headerFontFamily:"sans-serif",headerFontSize:"12px",headerFontStyle:"normal",headerFontWeight:"400",height:65,Columns:this.api.columnApi.getColumns().map(e=>({columnFriendlyName:e.FriendlyName,width:200,textAlign:"start"}))},Row:{color:"#000000",backColor:"#ffffff",altBackColor:"#fcfdfe",fontFamily:"sans-serif",fontSize:"12px",fontStyle:"normal",fontWeight:"400",height:30,Columns:this.api.columnApi.getColumns().map(e=>({columnFriendlyName:e.FriendlyName,width:200,textAlign:"start"}))}}}getCurrentIPPStyle(){return this.agGridHelper.getCurrentIPPStyle()}getadaptableContainerElement(){if(!this.abContainerElement){let e=this.adaptableOptions.containerOptions.adaptableContainer;if(this.abContainerElement="string"===typeof e?document.getElementById(e):e,!this.abContainerElement){let e=document.getElementById("adaptableBlotter");e&&(I.LogAdaptableWarning('\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n!!!!! The old default container element for Adaptable was "#adaptableBlotter", configured via \'containerOptions.adaptableContainer="adaptableBlotter"\'.\n!!!!! Seems like you haven\'t updated your html container selector, so we\'re falling back to using that one.\n!!!!!\n!!!!! To make this warning go away, update your html structure and make sure you have an element with id="adaptable" in your app!\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n'),this.abContainerElement=e)}}return this.abContainerElement}getGridContainerElement(){return this.gridContainerElement||(this.gridContainerElement="string"===typeof this.adaptableOptions.containerOptions.vendorContainer?document.getElementById(this.adaptableOptions.containerOptions.vendorContainer):this.adaptableOptions.containerOptions.vendorContainer),this.gridContainerElement}initInternalGridLogic(){if(null==this.abContainerElement&&(this.abContainerElement=this.getadaptableContainerElement()),null==this.abContainerElement)return void("string"===typeof this.adaptableOptions.containerOptions.adaptableContainer?I.ConsoleLogError(`There is no DIV with id="${this.adaptableOptions.containerOptions.adaptableContainer}" so cannot render Adaptable`):I.ConsoleLogError("No valid adaptableContainer found to render Adaptable",this.adaptableOptions.containerOptions.adaptableContainer));const e=this.getGridContainerElement();e&&e.addEventListener("keydown",e=>this._emit("KeyDown",e));const t=[n.Events.EVENT_COLUMN_MOVED,n.Events.EVENT_GRID_COLUMNS_CHANGED,n.Events.EVENT_COLUMN_EVERYTHING_CHANGED,n.Events.EVENT_DISPLAYED_COLUMNS_CHANGED,n.Events.EVENT_COLUMN_VISIBLE,n.Events.EVENT_NEW_COLUMNS_LOADED];this.gridOptions.api.addGlobalListener(e=>{t.indexOf(e)>-1&&(this.debouncedSetColumnIntoStore(),this.debouncedFilterGrid())}),this.gridOptions.api.addEventListener(n.Events.EVENT_FIRST_DATA_RENDERED,()=>{this.checkColumnsDataTypeSet(),this.setLayout()}),this.gridOptions.api.addEventListener(n.Events.EVENT_CELL_EDITING_STARTED,e=>{if(this.gridOptions.columnApi.isPivotMode())return;const t=this.adaptableOptions.editOptions.isCellEditable;if(t){t(this.getGridCellFromRowNode(e.node,e.column.getColId()),e.node)||this.gridOptions.api.stopEditing()}}),this.gridOptions.api.addEventListener(n.Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,e=>{"columnPivotModeChanged"==e.type&&null!=e.columnApi&&null!=e.columnApi.columnController&&1==e.columnApi.columnController.pivotMode?(1==this.adaptableOptions.layoutOptions.autoSizeColumnsInPivotLayout&&this.gridOptions.columnApi.autoSizeAllColumns(),this.api.internalApi.setPivotModeOn()):this.api.internalApi.setPivotModeOff()}),this.gridOptions.api.addEventListener(n.Events.EVENT_COLUMN_PIVOT_CHANGED,e=>{"columnPivotChanged"==e.type&&null!=e.columnApi&&null!=e.columnApi.columnController&&1==e.columnApi.columnController.pivotMode&&1==this.adaptableOptions.layoutOptions.autoSizeColumnsInPivotLayout&&this.gridOptions.columnApi.autoSizeAllColumns()});const i=[n.Events.EVENT_COLUMN_PINNED,n.Events.EVENT_COLUMN_PIVOT_CHANGED,n.Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,n.Events.EVENT_DISPLAYED_COLUMNS_CHANGED,n.Events.EVENT_SORT_CHANGED,n.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,n.Events.EVENT_ROW_GROUP_OPENED,n.Events.EVENT_COLUMN_VALUE_CHANGED];this.gridOptions.api.addGlobalListener(e=>{i.indexOf(e)>-1&&this.debouncedSaveGridLayout()}),this.gridOptions.api.addEventListener(n.Events.EVENT_COLUMN_RESIZED,e=>{1==e.finished&&"columnResized"==e.type&&e.column&&(this._emit("ColumnResized",e.column.getColId()),this.debouncedSaveGridLayout())});const o=[n.Events.EVENT_ROW_GROUP_OPENED,n.Events.EVENT_SELECTION_CHANGED,n.Events.EVENT_ROW_SELECTED];this.gridOptions.api.addGlobalListener(e=>{A.ArrayExtensions.ContainsItem(o,e)&&this.debouncedSetSelectedRows()}),this.gridOptions.api.addEventListener(n.Events.EVENT_RANGE_SELECTION_CHANGED,e=>{1==e.finished&&this.debouncedSetSelectedCells()}),this.gridOptions.api.addEventListener(n.Events.EVENT_SORT_CHANGED,e=>{this.onSortChanged(),this.debouncedSetSelectedCells()});const l=this.adaptableOptions.generalOptions.showGroupingTotalsAsHeader;this.gridOptions.api.addEventListener(n.Events.EVENT_MODEL_UPDATED,e=>{if(l&&e&&e.api){const t=e.api.getPinnedTopRow(0),i=e.api.getModel().getRootNode();t?t.updateData(i.aggData):e.api.setPinnedTopRowData([i.aggData])}}),this.rowListeners={dataChanged:e=>{this.onRowDataChanged({rowNode:e.node,oldData:e.oldData,newData:e.newData})},cellChanged:e=>{e.column&&this.onCellDataChanged({rowNode:e.node,oldValue:e.oldValue,newValue:e.newValue,colId:e.column.colId})}},Z.dispatchLocalEvent=function(e){const t=e.node,i=ee.apply(this,arguments);return t&&ne.forEachAdaptable(i=>{if(t.gridApi!==i.gridOptions.api)return;const o=i.rowListeners?i.rowListeners[e.type]:null;o&&o(e)}),i};const r=this.gridOptions.isExternalFilterPresent;this.gridOptions.isExternalFilterPresent=()=>{const e=this.api.filterApi.getAllColumnFilter(),t=A.ArrayExtensions.IsNotNullOrEmpty(e);if(t)for(const o of e){const e=this.gridOptions.columnApi.getColumn(o.ColumnId);e&&!e.isFilterActive()&&e.setFilterActive(!0)}else(this.gridOptions.columnApi.getAllColumns()||[]).forEach(e=>{e.isFilterActive()&&e.setFilterActive(!1)});const i=E.StringExtensions.IsNotNullOrEmpty(this.api.queryApi.getCurrentQuery());return t||i||!!r&&r()};const s=this.gridOptions.doesExternalFilterPass;this.gridOptions.doesExternalFilterPass=e=>{if(!this.api.internalApi.isServerSearchOptionSet("Query")){const t=this.api.queryApi.getCurrentQuery();if(t){if(!this.api.queryApi.isValidBooleanQuery(t,`Invalid CurrentQuery '${t}'`)||!this.api.internalApi.getExpressionService().evaluateBooleanExpression(t,e))return!1}}try{if(!this.api.internalApi.isServerSearchOptionSet("Filter")){const t=this.api.filterApi.getAllColumnFilter();if(t.length>0)for(const i of t)if(!this.api.filterApi.evaluateColumnFilter(i,e))return!1}}catch(t){return I.LogAdaptableError(t),!1}return!s||s(e)};const a=this.gridOptions.getMainMenuItems;this.gridOptions.getMainMenuItems=e=>this.agGridMenuHelper.buildColumnMenu(e,a);const d=this.gridOptions.getContextMenuItems;this.gridOptions.getContextMenuItems=e=>this.agGridMenuHelper.buildContextMenu(e,d),this.prepareGrid()}buildStandaloneColumnHeader(e){return this.agGridMenuHelper.buildStandaloneColumnHeader(e)}prepareGrid(){try{this.updateColDefsForSpecialColumns(),this.applyCurrentTheme(),this.applyFinalRendering(),this.applyGridFiltering()}catch(e){I.ConsoleLogError("AgGrid setup failed"),I.ConsoleLogError(e)}}setupColumns(){const e=this.gridOptions.columnApi.getAllColumns();e.map(e=>e.getColDef()).forEach(X),this.updateColumnsIntoStore(),e.forEach(e=>{const t=e.getColDef(),i=e.getColId(),o={col:e,colDef:t,colId:i,abColumn:this.api.columnApi.getColumnFromId(i)};this.setupColumnCellRenderer(o),this.setupColumnCellStyle(o),this.setupColumnCellClass(o),this.setupColumnTooltipValueGetter(o),this.setupColumnTooltipField(o),this.setupColumnValueGetter(o),this.setupColumnAggFunc(o),this.setupColumnFilter(o),this.setupColumnFloatingFilter(o),this.setupColumnValueFormatter(o),this.setupColumnValueSetter(o),this.setupColumnComparator(o),this.setupColumnCellEditor(o),this.setupColumnHeader(o)}),this.setupRowStyling(),this.redrawBody(),this.redrawHeader()}setGridOptionsProperty(e,t){const i="user."+e,o="adaptable."+e,n=this.gridOptions[e];n!==this.gridOptionsPropertyCache.get(o)&&this.gridOptionsPropertyCache.set(i,n);const l=this.gridOptionsPropertyCache.get(i),r=t(l);null!=r&&this.gridOptionsPropertyCache.set(o,r),this.gridOptions[e]=null!==r&&void 0!==r?r:l}setColDefProperty(e,t,i){const o=e.getColId(),n=e.getColDef(),l={col:e,colDef:n,colId:o},r=`user.${o}.${t}`,s=`adaptable.${o}.${t}`,a=n[t];a!==this.colDefPropertyCache.get(s)&&this.colDefPropertyCache.set(r,a);const d=this.colDefPropertyCache.get(r),u=i(d);null!=u&&this.colDefPropertyCache.set(s,u);let p=null!==u&&void 0!==u?u:d;this.forPlugins(e=>{e.interceptSetupColumnProperty&&(p=e.interceptSetupColumnProperty(l,t,p,this.api))}),"aggFunc"===t&&n[t]!==(null!==p&&void 0!==p?p:null)&&this.gridOptions.columnApi.setColumnAggFunc(o,null!==p&&void 0!==p?p:null),void 0===p&&void 0===n[t]||(n[t]=p)}getUserColDefProperty(e,t){const i=`user.${e.getColId()}.${t}`;return this.colDefPropertyCache.get(i)}setupColumnCellStyle({col:e,colId:t,abColumn:i}){this.setColDefProperty(e,"cellStyle",e=>{const t={backgroundColor:null,color:null,fontWeight:null,fontStyle:null,fontSize:null,borderColor:null},o=this.api.formatColumnApi.getFormatColumnForColumn(i),n=this.api.conditionalStyleApi.getConditionalStylesForColumn(i),l=this.getQuickSearchCellStyle(),r=void 0!=l;return s=>{const a=o?this.getFormatColumnCellStyle(o,s):void 0,d=r&&this.isQuickSearchActive(i,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t),this.getReadOnlyCellStyle(i,s)),this.getEditableCellStyle(i,s)),"function"===typeof e?e(s):e),a),this.getConditionalStyleCellStyle(n,i,s)),d?l:void 0),this.getAlertCellStyle(i,s)),this.getFlashingAlertCellStyle(i,s)),this.getCellHighlightStyle(i,s))}})}setupColumnCellClass({col:e,colId:t,abColumn:i}){this.setColDefProperty(e,"cellClass",e=>{var o;const n=this.api.formatColumnApi.getFormatColumnWithStyleClassNameForColumn(i),l=n?null===(o=n.Style)||void 0===o?void 0:o.ClassName:null,r=this.api.conditionalStyleApi.getConditionalStylesForColumn(i).filter(e=>E.StringExtensions.IsNotNullOrEmpty(e.Style.ClassName)),s=A.ArrayExtensions.IsNotNullOrEmpty(r),a=this.api.quickSearchApi.getQuickSearchStyle().ClassName,d=E.StringExtensions.IsNotNullOrEmpty(a);return o=>{const n=d&&this.isQuickSearchActive(i,o),u=this.getPrimaryKeyValueFromRowNode(o.node);let p=[this.getExcelClassNameForCell(t,u),"function"===typeof e?e(o):e,l,s?this.getConditionalStyleCellClass(r,i,o):null,n?a:null].filter(e=>!!e).join(" ");return E.StringExtensions.IsNotNullOrEmpty(p)?p:void 0}})}getExcelClassNameForCell(e,t){return`--excel-cell-${e}-${t}`}setupColumnCellEditor({colId:e,col:t}){const i=this.api.userInterfaceApi.getEditLookUpItemForColumn(e);this.setColDefProperty(t,"cellEditor",()=>{if(i)return this.isModulePresent("rich-select")?"agRichSelectCellEditor":"agSelectCellEditor"}),this.setColDefProperty(t,"cellEditorParams",()=>{if(i)return{values:this.api.userInterfaceApi.getEditLookUpValuesForEditLookUpItem(i,e)}})}setupColumnCellRenderer({col:e,colId:t,abColumn:i}){this.setColDefProperty(e,"cellRenderer",()=>{const e=this.api.formatColumnApi.getFormatColumnForColumn(i);if(e&&e.ColumnStyle){if(e.ColumnStyle.PercentBarStyle)return this.agGridHelper.createNumericStyleRendererFunc(e);if(e.ColumnStyle.CheckBoxStyle)return this.agGridHelper.createCheckboxRendererComp(i.ColumnId,i.ReadOnly)}const o=this.api.sparklineColumnApi.getSparklineByColumn(t);if(o)return this.agGridHelper.createSparklineCellRendererComp(o)})}setupColumnTooltipValueGetter({col:e,colId:t}){this.setColDefProperty(e,"tooltipValueGetter",()=>{var e;const i=this.api.formatColumnApi.getFormatColumnForColumnId(t);if(i&&i.ColumnStyle&&i.ColumnStyle.PercentBarStyle&&i.ColumnStyle.PercentBarStyle.ToolTipText&&(null===(e=null===i||void 0===i?void 0:i.ColumnStyle)||void 0===e?void 0:e.PercentBarStyle))return e=>{const t=this.api.formatColumnApi.getNumericStyleMinValue(null===i||void 0===i?void 0:i.ColumnStyle,e.node,e.value),o=this.api.formatColumnApi.getNumericStyleMaxValue(null===i||void 0===i?void 0:i.ColumnStyle,e.node,e.value),n=i.ColumnStyle.PercentBarStyle.ToolTipText;let l="";if(n.includes("CellValue"))if(i.DisplayFormat){const t=i.DisplayFormat.Options;l=t?N.default.NumberFormatter(e.value,t):e.value}else l=e.value;if(n.includes("PercentageValue")){l+=` (${((w.Helper.clamp(e.value,t,o)-t)/(o-t)*100).toFixed(0)}%)`}return l||e.value}})}setupColumnTooltipField({col:e,colId:t,colDef:i}){this.setColDefProperty(e,"tooltipField",()=>{const e=this.api.sparklineColumnApi.getSparklineByColumn(t);if(e)return e.ShowToolTip?i.field:""})}setupColumnHeader({col:e,abColumn:t}){this.setColDefProperty(e,"headerName",()=>{const e=this.api.formatColumnApi.getFormatColumnForColumnId(t.ColumnId);if(e&&e.HeaderName)return t.FriendlyName=e.HeaderName,e.HeaderName})}setupColumnFilter({col:e,colDef:t}){this.setColDefProperty(e,"filter",()=>{if(t.filter&&this.adaptableOptions.searchOptions.useAdaptableFilterForm)return this.gridOptions.api.destroyFilter(e),z.FilterWrapperFactory(this)})}setupColumnFloatingFilter({col:e,colDef:t}){const i=!t.floatingFilter||!this.adaptableOptions.searchOptions.useAdaptableQuickFilter;this.setColDefProperty(e,"floatingFilterComponent",()=>{if(!i)return W.FloatingFilterWrapperFactory(this)}),this.setColDefProperty(e,"floatingFilterComponentParams",()=>{if(!i)return{suppressFilterButton:!0}})}setupColumnValueFormatter({col:e,abColumn:t}){this.setColDefProperty(e,"valueFormatter",()=>{const e=this.api.formatColumnApi.getFormatColumnWithDisplayFormatForColumn(t);if(e&&e.DisplayFormat){let i;if("NumberFormatter"===e.DisplayFormat.Formatter&&this.api.scopeApi.isColumnInNumericScope(t,e.Scope)){const t=e.DisplayFormat.Options;i=e=>N.default.NumberFormatter(e.value,t)}if("DateFormatter"===e.DisplayFormat.Formatter&&this.api.scopeApi.isColumnInDateScope(t,e.Scope)){const t=e.DisplayFormat.Options;i=e=>N.default.DateFormatter(e.value,t)}if("StringFormatter"===e.DisplayFormat.Formatter&&this.api.scopeApi.isColumnInStringsScope(t,e.Scope)){const t=e.DisplayFormat.Options;i=e=>N.default.StringFormatter(e.value,t)}return i}})}setupColumnValueSetter({col:e,colId:t,abColumn:i}){this.setColDefProperty(e,"valueSetter",e=>{var o;const n=this.api.alertApi.getAlertDefinitionsWithPreventEdit().filter(e=>this.api.scopeApi.isColumnInScope(i,e.Scope)),l=this.adaptableOptions.editOptions.isCellEditable,r=!n.length&&!(null===(o=this.adaptableOptions.editOptions)||void 0===o?void 0:o.validateOnServer);if(r&&!l)return;return i=>{var o;if(l){let e=this.getGridCellFromRowNode(i.node,i.column.getColId());if(!l(e,i.node))return!1}const s=i.column.getColDef().field;if(r)return"function"===typeof e?e(i):(s&&(i.data[s]=i.newValue),!0);const a=this.api.internalApi.buildDataChangedInfo({oldValue:i.oldValue,newValue:i.newValue,columnId:i.column.getColId(),primaryKeyValue:this.getPrimaryKeyValueFromRowNode(i.node),rowNode:i.node,trigger:"edit"});if(!n.length)return!0;if(a.oldValue===a.newValue)return!0;if(!this.ValidationService.performValidation(a))return!1;const d=()=>{};if((null===(o=this.adaptableOptions.editOptions)||void 0===o?void 0:o.validateOnServer)&&this.ValidationService.performServerValidation(a,{onServerValidationCompleted:d})(),"function"===typeof e)return e(i);if(!s)throw"Cannot edit a column without a field - column id was "+t;return i.data[s]=i.newValue,!0}})}setupColumnComparator({col:e,colId:t,abColumn:i}){const o=this.api.customSortApi.getCustomSortByColumn(t),n=this.api.internalApi.getColumnSortComparer(i),l=()=>{if(!o&&!n)return;return n?n.comparer:this.runAdaptableComparerFunction(o.ColumnId,o.SortedValues)};this.setColDefProperty(e,"comparator",l),this.setColDefProperty(e,"pivotComparator",l)}applyCurrentTheme(){this.api.themeApi.applyCurrentTheme()}applyFinalRendering(){this.embedColumnMenu=this.isModulePresent("menu"),this.gridOptions.defaultGroupSortComparator=this.agGridHelper.runAdaptableNodeComparerFunction(),this.gridOptions.treeData&&1==this.gridOptions.treeData?this.api.internalApi.setTreeModeOn():this.api.internalApi.setTreeModeOff(),this.agGridHelper.checkShouldClearExistingFiltersOrSearches()}isModulePresent(e){let t=n.ModuleRegistry.getRegisteredModules().concat(this.agGridModules).map(e=>e.moduleName);return A.ArrayExtensions.ContainsAnyItem(t,["@ag-grid-enterprise/"+e,"@ag-grid-enterprise/all-modules"])}onRowDataChanged({rowNode:e,oldData:t,newData:i}){if(null==t||void 0==t)return;if(t==i)return;const o=this.getPrimaryKeyValueFromRowNode(e);if(!o)return;let n=[];Object.keys(t).forEach(l=>{if(this.api.columnApi.doesColumnExist(l)){const r=t[l],s=i[l];if(r!=s){const t=this.api.internalApi.buildDataChangedInfo({oldValue:r,newValue:s,columnId:l,primaryKeyValue:o,rowNode:e,trigger:"tick"});n.push(t)}}}),this.performPostEditChecks(n)}onCellDataChanged({rowNode:e,oldValue:t,newValue:i,colId:o}){if(t==i)return;const n=this.getPrimaryKeyValueFromRowNode(e);if(!n)return;if(!this.api.columnApi.doesColumnExist(o))return;const l=this.api.internalApi.buildDataChangedInfo({oldValue:t,newValue:i,columnId:o,primaryKeyValue:n,rowNode:e,trigger:"edit"});this.performPostEditChecks([l])}performPostEditChecks(e){const t=e[0];if(!t||!t.rowNode)return;const i=this.isVisibleNode(t.rowNode);e.forEach(e=>{"edit"==e.trigger&&(this.checkChangedCellCurrentlySelected(e),this.api.freeTextColumnApi.checkFreeTextColumnForDataChange(e)),this.DataService.CreateDataChangedEvent(e)}),i&&this.refreshExpressionStylesIfNeeded(t.rowNode,e),"tick"==t.trigger?this.filterOnTickingDataChange():this.filterOnEditDataChange()}refreshExpressionStylesIfNeeded(e,t){const i=this.api.conditionalStyleApi.getConditionalStylesWithExpression();if(A.ArrayExtensions.IsNullOrEmpty(i))return;let o=!1,n=!1;const l=new Set,r=new Set;t.forEach(e=>{o||i.forEach(t=>{if(!o){this.api.queryApi.getColumnsFromExpression(t.Rule.BooleanExpression).forEach(e=>l.add(e));const i=l.has(e.columnId);if(this.api.scopeApi.scopeIsAll(t.Scope)){if(i)return void(o=!0)}else this.api.scopeApi.getColumnsForScope(t.Scope).map(e=>e.ColumnId).forEach(e=>{r.add(e)})}}),l.has(e.columnId)&&(n=!0)}),o?this.redrawRow(e):n&&this.refreshCells([e],Array.from(r.values()),!0)}checkChangedCellCurrentlySelected(e){let t=this.api.gridApi.getSelectedCellInfo();if(t&&A.ArrayExtensions.IsNotNullOrEmpty(t.gridCells)){t.gridCells.find(t=>t.primaryKeyValue==e.primaryKeyValue&&t.columnId==e.columnId)&&this.setSelectedCells()}let i=this.api.gridApi.getSelectedRowInfo();if(i&&A.ArrayExtensions.IsNotNullOrEmpty(i.GridRows)){i.GridRows.find(t=>t.primaryKeyValue==e.primaryKeyValue)&&this.setSelectedRows()}}getColumnSorts(){const e=[];return this.gridOptions.columnApi.getColumnState().forEach(t=>{const{colId:i}=t;t.sort&&null!=t.sortIndex&&e.push({ColumnId:i,SortOrder:"asc"===t.sort?"Asc":"Desc",SortIndex:t.sortIndex})}),e.sort((e,t)=>e.SortIndex-t.SortIndex),e.map(e=>({ColumnId:e.ColumnId,SortOrder:e.SortOrder}))}onSortChanged(){const e=this.getColumnSorts();this.api.gridApi.setColumnSorts(e),this._emit("SortChanged",e)}expandAllRowGroups(){this.gridOptions.api.forEachNode(e=>{e.group&&(e.expanded=!0)}),this.gridOptions.api.onGroupExpandedOrCollapsed()}closeAllRowGroups(){this.gridOptions.api.forEachNode(e=>{e.group&&(e.expanded=!1)}),this.gridOptions.api.onGroupExpandedOrCollapsed()}expandRowGroupsForValues(e){if(A.ArrayExtensions.IsNotNullOrEmpty(e)){const t=e.reduce((e,t)=>(e[t]=!0,e),{});this.gridOptions.api.forEachNode(e=>{if(e.group&&!e.expanded){const i=[];let o=e;for(;o;)i.push(o.key),o=o.parent;const n=i.filter(e=>!!e).reverse().join("/");t[n]&&e.setExpanded(!0)}}),this.gridOptions.api.onGroupExpandedOrCollapsed()}}getVendorGridColumnFieldForColumn(e){return this.gridOptions.columnApi.getAllColumns().find(t=>t.getColId()===e.ColumnId).getColDef().field||""}getExpandRowGroupsKeys(){let e=[];return this.adaptableOptions.layoutOptions.includeExpandedRowGroups&&this.gridOptions.api.forEachNode(t=>{if(t.group&&t.expanded){let i=t;const o=[];for(;i;)o.push(i.key),i=i.parent;e.push(o.filter(e=>!!e).reverse().join("/"))}}),e}getRowCount(){return this.gridOptions.rowData?this.gridOptions.rowData.length:this.gridOptions.api.getDisplayedRowCount()}getColumnCount(){return this.gridOptions.columnApi.getAllColumns().length}getVisibleRowCount(){return this.gridOptions.api.getDisplayedRowCount()}getVisibleColumnCount(){return this.gridOptions.columnApi.getAllColumns().filter(e=>e.isVisible()).length}selectColumns(e){e.forEach(e=>this.selectColumn(e))}selectColumn(e){this.gridOptions.api.clearRangeSelection();const t={rowStartIndex:0,rowEndIndex:this.gridOptions.api.getDisplayedRowCount(),columnStart:e,columnEnd:e};this.gridOptions.api.addCellRange(t)}selectAll(){this.gridOptions.api.selectAll()}hideColumn(e){this.gridOptions.columnApi.getColumn(e)&&(this.gridOptions.columnApi.setColumnVisible(e,!1),this.updateColumnsIntoStore())}showColumn(e){this.gridOptions.columnApi.getColumn(e)&&(this.gridOptions.columnApi.setColumnVisible(e,!0),this.updateColumnsIntoStore())}setColumnSort(e){const t=e.reduce((e,t,i)=>(e[t.ColumnId]=Object.assign(Object.assign({},t),{SortIndex:i}),e),{});if(!this.gridOptions.api)return;const i=this.gridOptions.columnApi.getColumnState().map(e=>{const{colId:i}=e,o=Object.assign({},e),n=t[i];return n?(o.sort="Asc"===n.SortOrder?"asc":"desc",o.sortIndex=n.SortIndex):(o.sort=null,o.sortIndex=null),o});this.gridOptions.columnApi.setColumnState(i),this.gridOptions.api.onSortChanged()}setDataSource(e){this.gridOptions.api&&(this.hasAutogeneratedPrimaryKey()&&this.addSyntheticPrimaryKey(e),this.gridOptions.api.setRowData(e))}loadDataSource(e){this.hasAutogeneratedPrimaryKey()&&this.addSyntheticPrimaryKey(e),this.setDataSource(e)}updateRows(e,t){this.hasAutogeneratedPrimaryKey()&&this.addSyntheticPrimaryKeyIfMissing(e),(t=t||{}).runAsync?this.gridOptions.api.applyTransactionAsync({update:e},t.callback):this.gridOptions.api.applyTransaction({update:e})}addRows(e,t){this.hasAutogeneratedPrimaryKey()&&this.addSyntheticPrimaryKey(e),(t=t||{}).runAsync?this.gridOptions.api.applyTransactionAsync({add:e},t.callback):this.gridOptions.api.applyTransaction({add:e})}deleteRows(e,t){(t=t||{}).runAsync?this.gridOptions.api.applyTransactionAsync({remove:e},t.callback):this.gridOptions.api.applyTransaction({remove:e})}getFirstGroupedColumn(){let e=this.gridOptions.columnApi.getRowGroupColumns();if(A.ArrayExtensions.IsNotNullOrEmpty(e)){let t=e[0];return this.api.columnApi.getColumnFromId(t.getColId())}}checkColumnsDataTypeSet(){const e=this.api.columnApi.getColumns()[0];e&&e.DataType==c.DataType.Unknown&&this.updateColumnsIntoStore()}runAdaptableComparerFunction(e,t){let i=this;return function(o,n,l,r){let s=l?i.getDisplayValueFromRowNode(l,e):o,a=r?i.getDisplayValueFromRowNode(r,e):n,d=t.indexOf(s),u=d>=0,p=t.indexOf(a),h=p>=0;return u||h?u?h?d-p:-1:1:o==n?0:o<n?-1:1}}isGridSelectable(){return!(!this.isModulePresent("range-selection")||null==this.gridOptions.enableRangeSelection||!this.gridOptions.enableRangeSelection)}isGridGroupable(){return!this.api.internalApi.isGridInTreeMode()}isGridGroupingActive(){let e=!1;return this.gridOptions.api.forEachNode(t=>{e||t.group&&(e=!0)}),e}isGridPivotable(){return!this.api.internalApi.isGridInTreeMode()}isQuickFilterAvailable(){return!0===this.hasFloatingFilterOnAtLeastOneColumn()}hasFloatingFilterOnAtLeastOneColumn(e=this.gridOptions.columnDefs){if(this.gridOptions.defaultColDef&&this.gridOptions.defaultColDef.floatingFilter)return!0;let t;for(t of e){if(t.floatingFilter)return!0;if(t.children&&this.hasFloatingFilterOnAtLeastOneColumn(t.children))return!0}return!1}showQuickFilter(){this.gridOptions.api.setFloatingFiltersHeight(null)}hideQuickFilter(){this.gridOptions.api.setFloatingFiltersHeight(0)}getVendorColumnType(e){var t;const{type:i}=null!==(t=this.gridOptions.api.getColumnDef(e))&&void 0!==t?t:{};return i||""}getVendorGridLightThemeName(){const e=this.getGridContainerElement();if(e&&e.classList){const t=e.classList;for(let e=0,i=t.length;e<i;e++){const i=t[e];if(0===i.indexOf("ag-theme-"))return i.replace("-dark","")}}return this.agGridHelper.getVendorLightThemeName()}getVendorGridCurrentThemeName(){const e=this.getGridContainerElement();if(e&&e.classList){const t=e.classList;for(let e=0,i=t.length;e<i;e++){const i=t[e];if(0===i.indexOf("ag-theme-"))return i}}return this.getVendorGridLightThemeName()}applyAdaptableTheme(e){const t="string"===typeof e?e:e.Name,i=[],o=[],n=this.api.themeApi.getAllTheme().map(e=>Object.assign({},e)).reduce((e,t)=>(e[t.Name]=t,e),{}),l=document.documentElement;l.classList.forEach(e=>{if(0===e.indexOf(C.THEME_STYLE)){i.push(e);const t=e.substring(C.THEME_STYLE.length);n[t]&&o.push(n[t])}}),i.forEach(e=>l.classList.remove(e)),o.forEach(e=>{l.classList.remove("it--theme-"+e.Name)}),this.adaptableOptions.userInterfaceOptions&&this.adaptableOptions.userInterfaceOptions.useCustomMacLikeScrollbars&&b.default()>0?l.classList.add("ab--custom-mac-like-scrollbars"):l.classList.remove("ab--custom-mac-like-scrollbars");const r=n[t],s=C.THEME_STYLE+t;l.classList.add(s),l.classList.add("it--theme-"+t);const a=getComputedStyle(l),[d,u]=["--ab-loaded","--ab-theme-loaded"].map(e=>{let t=a.getPropertyValue(e);return"string"===typeof t&&t.trim&&(t=t.trim()),t}),p=!!this.api.themeApi.getAllSystemTheme().filter(e=>e.Name===t)[0],h=this.getGridContainerElement(),c=()=>this.getVendorGridLightThemeName();if(r&&p&&(t===f.LIGHT_THEME&&(r.VendorGridClassName=r.VendorGridClassName||c()),t===f.DARK_THEME&&(r.VendorGridClassName=r.VendorGridClassName||c()+"-dark")),r.VendorGridClassName||(r.VendorGridClassName=c()),null!=h){o.length&&o.forEach(e=>{e.VendorGridClassName&&h.classList.remove(e.VendorGridClassName)});const e=[];h.classList.forEach(t=>{t&&0===t.indexOf("ag-theme-")&&e.push(t)}),e.forEach(e=>h.classList.remove(e)),r&&r.VendorGridClassName&&h.classList.add(r.VendorGridClassName),h.classList.add("ab-Grid"),this.adaptableOptions.searchOptions.indicateFilteredColumns&&h.classList.add("ab-Grid--indicate-filtered-columns")}"777"!==d&&I.ConsoleLogError('Please import Adaptable styles from "adaptableadaptable/index.css"'),u!==t&&I.ConsoleLogWarning(`Theme "${t}" doesn't seem to be loaded! Make sure you import the css file for the "${t}" theme!\n\nIf it's a default theme, try\n\nimport "@adaptabletools/adaptable/themes/${t}.css"`)}setupRowStyling(){const e=this.api.conditionalStyleApi.getRowConditionalStyles();this.setGridOptionsProperty("getRowStyle",t=>i=>Object.assign(Object.assign({},null===t||void 0===t?void 0:t(i)),this.getConditionalStyleRowStyle(e,i))),this.setGridOptionsProperty("getRowClass",t=>i=>{let o=["function"===typeof t?t(i):t,this.getConditionalStyleRowClass(e.filter(e=>E.StringExtensions.IsNotNullOrEmpty(e.Style.ClassName)),i)].filter(e=>!!e).join(" ");return E.StringExtensions.IsNotNullOrEmpty(o)?o:void 0})}getConditionalStyleRowClass(e,t){if(A.ArrayExtensions.IsNotNullOrEmpty(e)){const i=this.ModuleService.getModuleById(y.ConditionalStyleModuleId);return e.map(e=>{var o;if(i.isConditionalStyleActiveForRow(e,t))return null===(o=e.Style)||void 0===o?void 0:o.ClassName}).filter(e=>!!e).join(" ")}}getConditionalStyleRowStyle(e,t){if(A.ArrayExtensions.IsNotNullOrEmpty(e)){const i=this.ModuleService.getModuleById(y.ConditionalStyleModuleId),o=e.find(e=>i.isConditionalStyleActiveForRow(e,t));if(o)return this.convertAdaptableStyleToCSS(o.Style)}}getGridOptionsApi(){if(this.gridOptions.api)return this.gridOptions.api;I.ConsoleLogError("There is a problem with your instance of ag-Grid - it has no gridApi object.  Please contact Support.")}canExportToExcel(){return this.isModulePresent("excel-export")}exportToExcel(e,t){const i=e.columns.map(e=>({field:e.ColumnId,headerName:e.FriendlyName})),o=e.columns.filter(e=>e.ColumnId.includes("."));o.length&&e.rows.forEach(e=>o.forEach(t=>{let i=e[t.ColumnId];t.ColumnId.split(".").reverse().forEach(e=>i={[e]:i}),delete e[t.ColumnId],Object.assign(e,i)}));const l={columnDefs:i,rowData:e.rows},r=new n.Grid(document.createElement("div"),l);l.api.exportDataAsExcel({sheetName:"Sheet 1",fileName:t}),r.destroy()}setExcelStylesForExport(){this.setGridOptionsProperty("excelStyles",e=>{const t=[],i=this.gridOptions.columnApi.getAllDisplayedColumns(),o=i.map(e=>e.getColDef());return this.forAllVisibleRowNodesDo((n,l)=>{const r={node:n,data:n.data,rowIndex:l,$scope:{},api:this.gridOptions.api,columnApi:this.gridOptions.columnApi,context:{}},s=this.gridOptions.getRowStyle(r);i.forEach((i,r)=>{const a=o[r],d={colDef:a,node:n,data:n.data,value:this.getRawValueFromRowNode(n,i.getId()),rowIndex:l,$scope:{},api:this.gridOptions.api,columnApi:this.gridOptions.columnApi,context:{}},u="function"===typeof a.cellStyle?a.cellStyle(d):{},p=[],h=this.getUserColDefProperty(i,"cellClass"),c=h&&e.find(e=>e.id===h);c&&p.push(c);const m=Object.assign(Object.assign({},s),Object.keys(u).reduce((e,t)=>(null!==u[t]&&(e[t]=u[t]),e),{}));if(Object.values(m).some(e=>null!=e)&&p.push(this.convertCSSToExcelStyle(m)),!p.length)return;const g="function"===typeof a.cellClass?a.cellClass(d):this.getExcelClassNameForCell(i.getId(),this.getPrimaryKeyValueFromRowNode(n)),C=Object.assign({},...p,{id:g});t.push(C)})}),t})}exportVisualDataToExcel(){this.setExcelStylesForExport(),this.gridOptions.api.exportDataAsExcel({sheetName:"Sheet 1",fileName:this.ReportService.getReportFileName(this.adaptableOptions.adaptableId),processCellCallback:e=>this.processCellForExcelExport(e)}),this.setGridOptionsProperty("excelStyles",e=>e)}convertAdaptableStyleToCSS(e){return $.convertAdaptableStyleToCSS(e)}convertCSSToExcelStyle(e){const t=e=>{const t=J(e),i=t.getAlpha();return J.mix(J("white"),t,100*i).toHexString()};let i={};if(null!=e.backgroundColor&&(i.interior={color:t(e.backgroundColor),pattern:"Solid"}),null!=e.borderColor){const t={color:e.borderColor,lineStyle:"Continuous",weight:1};i.borders={borderBottom:t,borderLeft:t,borderRight:t,borderTop:t}}return e.textAlign&&(i.alignment={horizontal:E.StringExtensions.CapitaliseFirstLetter(e.textAlign)}),null!=e.color&&(i.font||(i.font={}),i.font={color:t(e.color)}),"italic"===e.fontStyle&&(i.font||(i.font={}),i.font.italic=!0),null!=e.fontWeight&&("bold"===e.fontWeight||Number(e.fontWeight)>=600)&&(i.font||(i.font={}),i.font.bold=!0),null!=e.fontSize&&(i.font||(i.font={}),i.font.size=$.convertCSSAbsoluteFontSizeToPt(e.fontSize)),i}processCellForExcelExport(e){return this.ReportService.getCellExportValueFromRowNode(e.node,e.column.getColId())}hasAutogeneratedPrimaryKey(){return this.adaptableOptions.autogeneratePrimaryKey}addSyntheticPrimaryKey(e=[]){for(let t=0;t<e.length;t++)e[t][f.AUTOGENERATED_PK_COLUMN]=m.createUuid()}addSyntheticPrimaryKeyIfMissing(e=[]){this.adaptableOptions.primaryKey=f.AUTOGENERATED_PK_COLUMN;for(let t=0;t<e.length;t++)e[t][f.AUTOGENERATED_PK_COLUMN]||(e[t][f.AUTOGENERATED_PK_COLUMN]=m.createUuid())}}t.Adaptable=ne;t.AdaptableNoCodeWizard=class{constructor(e,t={}){this.adaptableOptions=e,this.init=t.onInit||(async({gridOptions:e,adaptableOptions:t})=>(t.vendorGrid=e,await ne.init(t))),this.extraOptions=t,this.render()}render(e){var t;let i=O.DefaultAdaptableOptions.containerOptions.adaptableContainer||"adaptable";if(!e){let o=null===(t=this.adaptableOptions.containerOptions)||void 0===t?void 0:t.adaptableContainer;o&&("string"===typeof o?i=null!==o&&void 0!==o?o:i:e=o)}if(!(e=e||document.getElementById(i)))throw new Error("Cannot find container in which to render Adaptable No Code Wizard");e.classList.add("adaptable--in-wizard"),u.render(d.createElement(k.default,Object.assign(Object.assign({adaptableOptions:this.adaptableOptions},this.extraOptions),{onInit:t=>{e.classList.remove("adaptable--in-wizard"),u.unmountComponentAtNode(e),this.init({adaptableOptions:t,gridOptions:t.vendorGrid})}})),e)}}}}]);
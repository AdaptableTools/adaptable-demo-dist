(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[7],{ydiI:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AdaptableNoCodeWizard=e.Adaptable=void 0;var o=i("mrSG"),n=i("DR3G"),r=i("hbEN"),a=i("Muja"),l=i("UXvI"),s=i("lE2N"),u=i("q1tI"),p=i("i8i4"),d=i("EYOP"),c=i("YzQ+"),g=i("RQz/"),f=i("w5Eo"),h=i("0J2a"),m=i("fwGq"),C=i("fwGq"),y=i("7VOM"),v=i("02Nn"),O=i("F9nB"),S=i("zwJd"),A=i("oej9"),E=i("qN6A"),w=i("vs66"),b=i("U/tm"),I=i("1f9d"),N=i("z1Bd"),F=i("pBDx"),D=i("fkJU"),R=i("+UTi"),G=i("adxL"),_=i("u3yE"),V=i("KOcV"),x=i("UQRY"),T=i("2WK/"),P=i("+0VI"),L=i("kVrw"),M=i("OwXO"),k=i("SF8o"),H=i("ZI/y"),U=i("QIb0"),B=i("vk8B"),W=i("n6u+"),K=i("OUop"),z=i("yRSI"),j=i("pioK"),Q=i("wnz6"),q=i("CUPq"),Y=i("YKwl"),J=i("eoug"),Z=i("Zss7");n.ModuleRegistry.registerModules(n.AllCommunityModules);var X=function(t){t&&(t.field&&!t.colId&&(t.colId=t.field),t.children?t.children.forEach(X):t.colId||F.LoggingHelper.LogAdaptableWarning("A column is missing the colId - please check ",t,'Either pass a "field" property or a "colId" property.'))},$=n.RowNode.prototype,tt=$.dispatchLocalEvent,et=n.GridApi.prototype.setColumnDefs,it=function(t,e,i){t.forEach((function(t,o,n){t.children?it(t.children,e,t):e(t,o,n,i)}))},ot={},nt=function(){function t(){var t=this;this.colDefPropertyCache=new Map,this.gridOptionsPropertyCache=new Map,this.flashingState=new Map,this._on=function(e,i){return t.emitter?t.emitter.on(e,i):function(){}},this._emit=function(e,i){return t.emitter.emit(e,i)},this._adaptableReady=!1,this.agGridModules=[],this.isPluginLoaded=function(e){for(var i=t.adaptableOptions.plugins||[],o=0,n=i.length;o<n;o++){if(i[o].pluginId===e)return!0}return!1},this.debouncedSetColumnIntoStore=r.default((function(){t.gridOptions.api&&t.updateColumnsIntoStore()}),C.HALF_SECOND),this.debouncedSaveGridLayout=r.default((function(){t.gridOptions.api&&t.updateLayoutFromGrid()}),C.HALF_SECOND),this.debouncedSetSelectedCells=r.default((function(){t.gridOptions.api&&t.setSelectedCells()}),250),this.debouncedSetSelectedRows=r.default((function(){t.gridOptions.api&&t.setSelectedRows()}),C.HALF_SECOND),this.debouncedFilterGrid=r.default((function(e){void 0===e&&(e=function(){}),t.gridOptions.api&&(t.applyGridFiltering(),e&&e())}),C.HALF_SECOND),this.mapColumnDefs=function(e,i,o){return o=o||{removeEmpty:!1},e=e||t.getGroupAndColumnDefs(),it(e,(function(t,e,n,r){var a=i(t,e,n),l=r?r.children:n;l[e]=a,e===n.length-1&&o.removeEmpty&&r&&(r.children=l.filter((function(t){return!!t})))})),o.removeEmpty&&(e=e.filter((function(t){return!!t}))),e},this.getGroupAndColumnDefs=function(){return[].concat(t.currentColumnDefs||t.gridOptions.columnDefs)},this.getColumnDefsWithCorrectVisibility=function(){var e=t.api.layoutApi.getCurrentVisibleColumnIdsMap();return t.gridOptions.columnApi.getAllColumns().map((function(t){var i=t.getColDef(),o=t.getColId();return i.colId=o,i.hide=!e[o],i}))},this.getPreviousColDefInfo=function(t){return t.__ab||{}}}return t.init=function(e){return t.initInternal(e)},t.initInternal=function(e,i){return o.__awaiter(this,void 0,void 0,(function(){var n,r,a,l,s,u,p,d,c;return o.__generator(this,(function(g){if({renderGrid:void 0,runtimeConfig:null},n=null,Array.isArray(e.plugins)){r=function(t){n=n&&n.then?n.then((function(){return t.beforeInit(e)})):t.beforeInit(e)};try{for(a=o.__values(e.plugins),l=a.next();!l.done;l=a.next())s=l.value,r(s)}catch(f){d={error:f}}finally{try{l&&!l.done&&(c=a.return)&&c.call(a)}finally{if(d)throw d.error}}}return u=function(t){return t.init(e,i,!0).then((function(i){return Array.isArray(e.plugins)&&e.plugins.forEach((function(e){e.afterInit(t)})),i}))},n&&n.then?[2,n.then((function(){var e=new t;return u(e)}))]:(p=new t,[2,u(p)])}))}))},t.collectInstance=function(t){t._id=t.adaptableOptions.adaptableId||f.createUuid(),ot[t._id]=t},t.forEachAdaptable=function(t){Object.keys(ot).forEach((function(e){t(ot[e])}))},t.dismissInstance=function(t){delete ot[t._id]},t.prototype.init=function(e,i,n){var r,a,s,u,c,g,f;return o.__awaiter(this,void 0,void 0,(function(){var h,m=this;return o.__generator(this,(function(y){return n||F.LoggingHelper.LogAdaptableWarning('\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n!!!!!!! You should not use the "Adaptable" constructor directly, as it was deprecated in v6 and removed in v7!\n!!!!!!!\n!!!!!!! Use const api = await Adaptable.init(adaptableOptions) instead.\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!'),this.emitter=new O.default,this.adaptableOptions=b.default.assignadaptableOptions(e),t.collectInstance(this),b.default.checkAdaptableOptions(this.adaptableOptions),this.runtimeConfig=i||{},this.agGridModules=this.runtimeConfig.modules||[],this.gridOptions=this.adaptableOptions.vendorGrid,void 0===this.gridOptions.allowContextMenuWithControlKey&&(this.gridOptions.allowContextMenuWithControlKey=!0),this.isInitialised=!1,this.useRowNodeLookUp=!1,this.forPlugins((function(t){return t.afterInitOptions(m,m.adaptableOptions)})),this.api=new d.AdaptableApiImpl(this),this.forPlugins((function(t){return t.afterInitApi(m,m.api)})),this.DataService=new V.DataService(this),this.AuditLogService=new R.AuditLogService(this),this.agGridHelper=new j.agGridHelper(this,this.gridOptions),this.agGridMenuHelper=new Q.agGridMenuHelper(this,this.gridOptions),this.initStore(),this.ValidationService=new k.ValidationService(this),this.ChartService=new _.ChartService(this),this.FreeTextColumnService=new x.FreeTextColumnService(this),this.ScheduleService=new L.ScheduleService(this),this.ReportService=new P.ReportService(this),this.LayoutService=new T.LayoutService(this),this.StrategyService=new M.StrategyService(this),this.CalculatedColumnExpressionService=new G.CalculatedColumnExpressionService(this),this.forPlugins((function(t){return t.afterInitServices(m)})),this.strategies=this.agGridHelper.setUpStrategies(),this.forPlugins((function(t){return t.afterInitStrategies(m,m.strategies)})),this.gridOptions.api&&(this.gridOptions.api.__adaptable=this),this.gridOptions.columnTypes=this.gridOptions.columnTypes||{},Object.assign(this.gridOptions.columnTypes,((h={})[C.AB_SPECIAL_COLUMN]={},h.abColDefNumber=null!==(r=this.gridOptions.columnTypes.abColDefNumber)&&void 0!==r?r:{},h.abColDefString=null!==(a=this.gridOptions.columnTypes.abColDefString)&&void 0!==a?a:{},h.abColDefBoolean=null!==(s=this.gridOptions.columnTypes.abColDefBoolean)&&void 0!==s?s:{},h.abColDefDate=null!==(u=this.gridOptions.columnTypes.abColDefDate)&&void 0!==u?u:{},h.abColDefObject=null!==(c=this.gridOptions.columnTypes.abColDefObject)&&void 0!==c?c:{},h.abColDefCustom=null!==(g=this.gridOptions.columnTypes.abColDefCustom)&&void 0!==g?g:{},h.abColDefNumberArray=null!==(f=this.gridOptions.columnTypes.abColDefNumberArray)&&void 0!==f?f:{},h)),[2,this.initializeAgGrid().then((function(t){if(!t)return F.LoggingHelper.LogAdaptableError("Unable to set up ag-Grid"),m.api;var e=m;return m.gridOptions.api&&(m.gridOptions.api.__adaptable=m,m.gridOptions.api.setColumnDefs=function(t){e.currentColumnDefs=[].concat(t);var i=et.apply(this,arguments);return e.setupColumns(),i}),m.adaptableStore.Load.then((function(){return m.initInternalGridLogic()}),(function(t){F.LoggingHelper.LogAdaptableError("Failed to Init Strategies : ",t),m.initInternalGridLogic(),m.api.internalApi.hideLoadingScreen()})).then((function(){return o.__awaiter(m,void 0,void 0,(function(){return o.__generator(this,(function(t){return this.isInitialised=!0,this.api.internalApi.hideLoadingScreen(),[2]}))}))})),null==m.abContainerElement&&(m.abContainerElement=m.getadaptableContainerElement()),null!=m.abContainerElement&&(m.abContainerElement.innerHTML="",p.render(U.AdaptableApp({Adaptable:m}),m.abContainerElement)),m.throttleFilterOnEditDataChange=l.default(m.gridOptions.api.onFilterChanged,m.adaptableOptions.filterOptions.filterActionOnUserDataChange.ThrottleDelay),m.throttleFilterOnTickingDataChange=l.default(m.gridOptions.api.onFilterChanged,m.adaptableOptions.filterOptions.filterActionOnExternalDataChange.ThrottleDelay),m.api}))]}))}))},t.prototype.forPlugins=function(t){Array.isArray(this.adaptableOptions.plugins)&&this.adaptableOptions.plugins.forEach((function(e){t(e)}))},t.prototype.getPlugin=function(t){var e=(this.adaptableOptions.plugins||[]).filter((function(e){return e.pluginId===t}))[0];if(!e)throw'Cannot find plugin "'+t+'". Make sure you spelled it right!';return e},t.prototype.getPluginProperty=function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var r=this.adaptableOptions.plugins||[],a=r.filter((function(e){return e.pluginId===t}))[0];if(!a)throw'Cannot find plugin "'+t+'". Make sure you spelled it right!';if(a&&a.hasProperty(e))return a.getProperty(e).apply(void 0,o.__spread(i))},t.prototype.lookupPlugins=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var n=this.adaptableOptions.plugins||[],r=0,a=n.length;r<a;r++){var l=n[r];if(l.hasProperty(t))return l.getProperty(t).apply(void 0,o.__spread(e))}},t.prototype.initStore=function(){var t=this;this.adaptableStore=new h.AdaptableStore(this),this.adaptableStore.onAny((function(e,i){t.forPlugins((function(o){return o.onStoreEvent(e,i,t.adaptableStore)})),e==h.INIT_STATE&&(t._adaptableReady=!0,t.forPlugins((function(e){return e.onAdaptableReady(t,t.adaptableOptions)})),t.api.eventApi.emit("AdaptableReady",{adaptableApi:t.api,vendorGrid:t.adaptableOptions.vendorGrid}))}))},t.prototype.initializeAgGrid=function(){var t,e=this;if(this.useRowNodeLookUp=this.agGridHelper.TrySetUpNodeIds(),Array.isArray(this.gridOptions.columnDefs)&&this.gridOptions.columnDefs.forEach(X),(null===(t=this.adaptableOptions.generalOptions)||void 0===t?void 0:t.hideEmptyGroupRows)&&(this.gridOptions.components=this.gridOptions.components||{},this.gridOptions.autoGroupColumnDef=this.gridOptions.autoGroupColumnDef||{},this.gridOptions.autoGroupColumnDef.cellRenderer||(this.gridOptions.autoGroupColumnDef.cellRenderer="__adaptableGroupCellRenderer",this.gridOptions.components.__adaptableGroupCellRenderer=J.AdaptableGroupCellRenderer)),this.adaptableOptions.userInterfaceOptions.showAdaptableToolPanel&&this.gridOptions.sideBar){this.gridOptions.sideBar=this.gridOptions.sideBar||{},this.gridOptions.components=this.gridOptions.components||{};var i=this.gridOptions.sideBar;if(!0===i)this.gridOptions.sideBar=this.agGridHelper.createAdaptableSideBarDefs(!0,!0);else if("columns"===i)this.gridOptions.sideBar=this.agGridHelper.createAdaptableSideBarDefs(!1,!0);else if("filters"===i)this.gridOptions.sideBar=this.agGridHelper.createAdaptableSideBarDefs(!0,!1);else{var r=this.gridOptions.sideBar;r&&(r.toolPanels=r.toolPanels||[],r.toolPanels.push(this.agGridHelper.createAdaptableToolPanel()))}this.gridOptions.components.AdaptableToolPanel=W.getAdaptableToolPanelAgGridComponent(this),this.gridOptions.api&&this.gridOptions.api.setSideBar(this.gridOptions.sideBar)}var a,l=function(){var t=e.getGridContainerElement();return!(!t&&!(t=e.initVendorContainerFromInitializedAgGrid()))||(F.LoggingHelper.LogAdaptableError("You must provide an element id in `containerOptions.vendorContainer`"),!1)};if(this.gridOptions.api&&"function"===typeof this.gridOptions.api.getValue)return l()?Promise.resolve(!0):Promise.resolve(!1);if(this.runtimeConfig.waitForAgGrid)return function(t){var e=Date.now();return t()?Promise.resolve():new Promise((function(i,o){var n=function(i){var r=t();if(Date.now()-e>5e4)return F.LoggingHelper.LogWarning("Could not find any agGrid instance rendered."),void o("Could not find any agGrid instance rendered.");r?i():requestAnimationFrame((function(){n(i)}))};n(i)}))}((function(){return!!e.gridOptions.api})).then((function(){return e.initVendorContainerFromInitializedAgGrid(),Promise.resolve(!0)}));if(!l())return Promise.resolve(!1);var s=(this.adaptableOptions.vendorGrid||{}).modules||[];this.agGridModules=o.__spread(this.agGridModules,s);var u=this.getGridContainerElement();return this.gridOptions.modules&&delete this.gridOptions.modules,a=new n.Grid(u,this.gridOptions,{modules:s}),this.gridOptions.api&&(this.gridOptions.api.__adaptable=this),Promise.resolve(null!=a)},t.prototype.initVendorContainerFromInitializedAgGrid=function(){if(!this.getGridContainerElement()){for(var t,e=this.gridOptions.api&&this.gridOptions.api.gridOptionsWrapper&&this.gridOptions.api.gridOptionsWrapper.layoutElements||[],i=0,o=e.length;i<o;i++){var n=e[i];if(n&&n.matches(".ag-root-wrapper")){var r=n.closest('[class*="ag-theme"]');if(r){t=r;break}}}return t||F.LoggingHelper.LogError("Could not find the agGrid vendor container. This will probably break some AdapTable functionality."),this.adaptableOptions.containerOptions.vendorContainer=t}},t.prototype.filterOnEditDataChange=function(){this.adaptableOptions.filterOptions.filterActionOnUserDataChange.RunFilter==g.FilterOnDataChangeOptions.Always?this.gridOptions.api.onFilterChanged():this.adaptableOptions.filterOptions.filterActionOnUserDataChange.RunFilter==g.FilterOnDataChangeOptions.Throttle&&this.throttleFilterOnEditDataChange()},t.prototype.filterOnTickingDataChange=function(){this.adaptableOptions.filterOptions.filterActionOnExternalDataChange.RunFilter==g.FilterOnDataChangeOptions.Always?this.gridOptions.api.onFilterChanged():this.adaptableOptions.filterOptions.filterActionOnExternalDataChange.RunFilter==g.FilterOnDataChangeOptions.Throttle&&this.throttleFilterOnTickingDataChange()},t.prototype.applyGridFiltering=function(){this.api.filterApi.isQuickFilterAvailable()&&(this.api.filterApi.isQuickFilterVisible()?this.showQuickFilter():this.hideQuickFilter()),this.gridOptions.api.onFilterChanged(),this._emit("GridFiltered"),this.setSelectedCells(),this.setSelectedRows()},t.prototype.isGroupRowNode=function(t){return!!t&&(!!t.isEmptyRowGroupNode()||(!(!t.group||!0!==t.group)||!(!t.leafGroup||!0!==t.leafGroup)))},t.prototype.isVisibleNode=function(t){return null!=this.gridOptions.api.getRenderedNodes().find((function(e){return e.id==t.id}))},t.prototype.isPinnedRowNode=function(t){return!!t&&!!t.isRowPinned()},t.prototype.clearGridFiltering=function(){this.gridOptions.columnApi.getAllColumns().forEach((function(t){t.setFilterActive(!1)}))},t.prototype.clearColumnFiltering=function(t){var e=this;t.forEach((function(t){var i=e.gridOptions.columnApi.getAllColumns().find((function(e){return e.getColId()==t}));i&&i.setFilterActive(!1)}))},t.prototype.hideFilterForm=function(){this.hideFilterFormPopup&&this.hideFilterFormPopup()},t.prototype.updateColumnsIntoStore=function(){var t=this,e=[],i=this.gridOptions.columnApi.getAllColumns(),o=this.gridOptions.columnApi.getAllDisplayedColumnGroups(),n={},r=o.reduce((function(t,e){var i,o,r;if(!(null===(o=null===(i=e.getOriginalColumnGroup)||void 0===i?void 0:i.call(e))||void 0===o?void 0:o.getColGroupDef()))return t;var a=e.getGroupId(),l=!e.getOriginalColumnGroup().getColGroupDef().marryChildren,s=null!==(r=e.getOriginalColumnGroup().getColGroupDef().headerName)&&void 0!==r?r:a,u=e.getLeafColumns();return u.forEach((function(e){var i={ColumnGroupId:a,FriendlyName:s,AllowGroupSplit:l,GroupCount:0};n[i.ColumnGroupId]=n[i.ColumnGroupId]||0,n[i.ColumnGroupId]+=u.length,t[e.getColId()]=i})),t}),{});Object.keys(r).forEach((function(t){r[t].GroupCount=n[r[t].ColumnGroupId]})),i.forEach((function(i){var o=i.getColId();t.api.columnApi.isRowGroupColumn(o)||e.push(t.createAdaptableColumn(i,r))})),this.api.internalApi.setColumns(e)},t.prototype.createAdaptableColumn=function(t,e){return this.agGridHelper.createAdaptableColumnFromVendorColumn(t,e)},t.prototype.safeSetColDefs=function(t){t=this.mapColumnDefs(t,(function(t){return t.field&&null==t.colId&&(t.colId=t.field),t})),this.gridOptions.api.setColumnDefs(t),this.updateColumnsIntoStore()},t.prototype.getFormatColumnCellStyle=function(t){var e={};if(t.Style&&(e=this.convertAdaptableStyleToCSS(t.Style)),t.CellAlignment)switch(t.CellAlignment){case"Left":e.textAlign="left";break;case"Right":e.textAlign="right";break;case"Center":e.textAlign="center"}return e},t.prototype.getAlertCellStyle=function(t,e){var i=this.api.internalApi.getAdaptableAlerts().filter((function(i){var o;return(null===(o=i.AlertDefinition.AlertProperties)||void 0===o?void 0:o.HighlightCell)&&i.DataChangedInfo&&i.DataChangedInfo.columnId===t.ColumnId&&i.DataChangedInfo.rowNode===e.node}))[0];if(i)return{backgroundColor:K.default.getColorByMessageType(i.AlertDefinition.MessageType)}},t.prototype.getCellHighlightStyle=function(t,e){var i,o=this.getPrimaryKeyValueFromRowNode(e.node),n=this.api.internalApi.getSystemState().HighlightedCells.find((function(e){return t.ColumnId===e.columnId&&e.primaryKeyValue===o}));if(n)switch(null!==(i=n.highlightType)&&void 0!==i?i:"Info"){case"Error":return{backgroundColor:"var(--ab-color-error)"};case"Info":return{backgroundColor:"var(--ab-color-info)"};case"Success":return{backgroundColor:"var(--ab-color-success)"};case"Warning":return{backgroundColor:"var(--ab-color-warn)"}}},t.prototype.getFlashingCellsCellStyle=function(t,e,i,o){if(t.IsLive){var n=this.getPrimaryKeyValueFromRowNode(o.node)+":"+t.ColumnId,r=this.flashingState.get(n);if(t&&r)switch(r.direction){case"up":return{backgroundColor:e};case"down":return{backgroundColor:i};case"neutral":return{backgroundColor:"gray"}}}},t.prototype.getQuickSearchCellStyle=function(){var t=this.api.quickSearchApi.getQuickSearchStyle();if(t&&!E.StringExtensions.IsNotNullOrEmpty(t.ClassName))return this.convertAdaptableStyleToCSS(t)},t.prototype.getGradientColumnCellStyle=function(t,e){if(t){var i,o,n=t.BaseValue,r=e.value<0;if(r?(i=t.NegativeColor,o=t.NegativeValue):(i=t.PositiveColor,o=t.PositiveValue),o&&void 0!==n){var a=Math.abs(o-n),l=(e.value-n)/a*100;r&&(l*=-1);var s=Number((l/100).toPrecision(2));return{backgroundColor:Z(i).setAlpha(s).toRgbString()}}}},t.prototype.getConditionalStyleCellStyle=function(t,e,i){void 0===t&&(t=[]);var n=this.StrategyService.getStrategyById(y.ConditionalStyleStrategyId),r=t.reduce((function(t,r){return n.isConditionalStyleActiveForColumn(r,e,i)?o.__assign(o.__assign({},t),r.Style):t}),{});return this.convertAdaptableStyleToCSS(r)},t.prototype.getConditionalStyleCellClass=function(t,e,i){void 0===t&&(t=[]);var o=this.StrategyService.getStrategyById(y.ConditionalStyleStrategyId);return t.map((function(t){var n,r;if((null===(n=t.Style)||void 0===n?void 0:n.ClassName)&&o.isConditionalStyleActiveForColumn(t,e,i))return null===(r=t.Style)||void 0===r?void 0:r.ClassName})).filter((function(t){return!!t})).join(" ")},t.prototype.isQuickSearchActive=function(t,e){if(t.IsExcludedFromQuickSearch)return!1;if(!e.node||e.node.group)return!1;var i=this.api.quickSearchApi.getQuickSearchValue();if(E.StringExtensions.IsNullOrEmpty(i))return!1;var o=D.default.CreateColumnFilter(t.ColumnId,"Contains",[i]);return this.api.filterApi.evaluateColumnFilter(o,e.node)},t.prototype.getPrimaryKeyValueFromRowNode=function(t){var e,i,o=this.getGridOptionsApi();return o&&(i=o.getValue(this.adaptableOptions.primaryKey,t)),null===i&&t&&t.data&&(i=null!==(e=t.data[this.adaptableOptions.primaryKey])&&void 0!==e?e:null),i},t.prototype.getActiveCell=function(){var t=this.gridOptions.api.getFocusedCell();if(t){var e=this.gridOptions.api.getModel().getRow(t.rowIndex);if(e&&!this.isGroupRowNode(e)){var i=t.column.getColId();return this.getGridCellFromRowNode(e,i)}}},t.prototype.getCurrentCellEditValue=function(){var t=this.gridOptions.api.getFocusedCell();if(t){var e=this.gridOptions.api.rowRenderer;if(e){var i=e.rowCompsByIndex[t.rowIndex];if(i){var o=i.cellComps[t.column.getColId()].cellEditor;if(o){var r=o instanceof n.PopupEditorWrapper?o.cellEditor:o;if(r)return r.getValue()}}}}return""},t.prototype.getSortedColumnStateForVisibleColumns=function(t,e){var i=this;e=e||this.gridOptions.columnApi.getColumnState();var n=t.reduce((function(t,e,i){return t[e]=i,t}),{}),r=e.reduce((function(t,e,i){return t[e.colId]=i,t}),{}),a=t.reduce((function(t,e,i){return t[e]=i,t}),{});return o.__spread(e).sort((function(t,e){var o=t.colId,n=e.colId,l=r[o],s=r[n],u=i.api.columnApi.isRowGroupColumn(o),p=i.api.columnApi.isRowGroupColumn(n);return u&&p?1:u?-1:p?1:null!=a[o]&&null==a[n]?-1:null==a[o]&&null!=a[n]?1:null==a[o]&&null==a[n]?l-s:a[t.colId]-a[e.colId]})).map((function(t){return o.__assign(o.__assign({},t),{hide:null==n[t.colId]})}))},t.prototype.setColumnOrder=function(t){var e=this.getSortedColumnStateForVisibleColumns(t);this.gridOptions.columnApi.setColumnState(e),this.updateColumnsIntoStore()},t.prototype.persistLayout=function(t){this.api.layoutApi.shouldAutoSaveLayout(t)?this.api.layoutApi.saveLayout(t):this.api.internalApi.updateCurrentDraftLayout(t)},t.prototype.setLayout=function(t){var e,i,n,r,l,s,u=this;t||(t=this.api.layoutApi.getCurrentLayout()),t.Columns=t.Columns||[];var p=t.Columns.reduce((function(t,e){return t[e]=!0,t}),{}),d=this.gridOptions.columnApi.getColumnState(),c={},g=d.reduce((function(t,e,i){return c[e.colId]=i,t[e.colId]=e,t}),{}),f=0,h=(null!==(e=t.ColumnSorts)&&void 0!==e?e:[]).reduce((function(t,e){var i=e.ColumnId;return p[i]?(t[i]={colId:i,sort:"Asc"===e.SortOrder?"asc":"desc",sortIndex:f},f++,t):t}),{}),m=(t.RowGroupedColumns||[]).reduce((function(t,e,i){return t[e]=i,t}),{}),C={},y=t.AggregationColumns||{},v=o.__spread(t.PivotColumns||[],Object.keys(t.AggregationColumns||{})),O=t.EnablePivot?v||[]:t.Columns;v.length&&t.RowGroupedColumns&&v.push.apply(v,o.__spread(t.RowGroupedColumns));var A=!1,E={},w=this.getSortedColumnStateForVisibleColumns(O,d);if(w=w.map((function(e){var i,n,r,l,s=e.colId,d=g[s],c=!p[s],f=o.__assign(o.__assign({},d),{hide:c});t.ColumnWidthMap&&null!=t.ColumnWidthMap[s]?f.width=t.ColumnWidthMap[s]:E[s]=!0,f.rowGroupIndex=null!=m[s]?m[s]:null,f.rowGroup=null!=f.rowGroupIndex;var v=!!t.PinnedColumnsMap&&t.PinnedColumnsMap[s];if(v&&(f.pinned=v),f.pivotIndex=null,null!=C[s]&&(f.pivotIndex=C[s]),f.aggFunc=null,null!=y[s]){var O=null===(n=null===(i=u.gridOptions)||void 0===i?void 0:i.api)||void 0===n?void 0:n.getColumnDef(s);f.aggFunc=!0===y[s]?null!==(l=null!==(r=e.aggFunc)&&void 0!==r?r:null===O||void 0===O?void 0:O.aggFunc)&&void 0!==l?l:"sum":y[s]}return h[s]?(f.sort=h[s].sort,f.sortIndex=h[s].sortIndex):(f.sort=null,f.sortIndex=null),A=A||!a.default(f,d),f})).filter((function(t){return!!t})),!A){var b=function(t){return t.colId+"-"+t.rowGroupIndex+"-"+t.pivotIndex+"-"+t.aggFunc+"-"+t.pinned+"-"+t.width+"-"+t.hide},I=d.map(b).join(","),N=w.map(b).join(",");A=N!=I}var F=!!t.EnablePivot,D=this.gridOptions.columnApi.isPivotMode()!==F;A=A||D,S.ArrayExtensions.IsNotNullOrEmpty(t.ExpandedRowGroupValues)&&this.adaptableOptions.layoutOptions.includeExpandedRowGroups&&this.expandRowGroupsForValues(t.ExpandedRowGroupValues),A&&(D&&this.gridOptions.columnApi.setPivotMode(F),this.gridOptions.columnApi.setColumnState(w),this.api.gridApi.setColumnSorts(t.ColumnSorts),this.gridOptions.columnApi.setPivotColumns(t.PivotColumns||[]),et.call(this.gridOptions.api,this.gridOptions.api.getColumnDefs()),this.updateColumnsIntoStore());var R=Object.keys(E);if(F&&(null===(n=null===(i=this.adaptableOptions)||void 0===i?void 0:i.layoutOptions)||void 0===n?void 0:n.autoSizeColumnsInPivotLayout))return requestAnimationFrame((function(){u.gridOptions.columnApi.autoSizeAllColumns()})),void setTimeout((function(){var t;null===(t=u.gridOptions.columnApi)||void 0===t||t.autoSizeAllColumns(),setTimeout((function(){var t;null===(t=u.gridOptions.columnApi)||void 0===t||t.autoSizeAllColumns()}),200)}),100);(null===(l=null===(r=this.adaptableOptions)||void 0===r?void 0:r.layoutOptions)||void 0===l?void 0:l.autoSizeColumnsInLayout)&&R.length&&(null===(s=this.gridOptions.columnApi)||void 0===s||s.autoSizeColumns(R)),this.api.layoutApi.fireLayoutUpdatedEvent(t,"UpdatedLayout")},t.prototype.updateLayoutFromGrid=function(){var t=this.api.layoutApi.getCurrentLayout(),e=o.__assign({},t),i=[],n={},r={},a=[],l=this.gridOptions.columnApi.getColumnState(),s=o.__spread(new Array(l.length)),u=o.__spread(new Array(l.length)),p=[],d={},c=l.reduce((function(t,e){var o=e.colId;return e.sort&&null!=e.sortIndex&&a.push({ColumnId:o,SortOrder:"asc"===e.sort?"Asc":"Desc",SortIndex:e.sortIndex}),null!=e.width&&(t[o]=e.width),null!=e.flex&&(n[o]=e.flex),"left"===e.pinned&&(r[o]="left"),"right"===e.pinned&&(r[o]="right"),e.hide||i.push(o),null!=e.rowGroupIndex&&(s[e.rowGroupIndex]=o),null!=e.pivotIndex&&(u[e.pivotIndex]=o),e.aggFunc&&"string"===typeof e.aggFunc&&(d[o]=e.aggFunc),t}),{});a.sort((function(t,e){return t.SortIndex-e.SortIndex})),this.gridOptions.columnApi.getPivotColumns().forEach((function(t){p.push(t.getColId())})),s=s.filter((function(t){return!!t})),u=u.filter((function(t){return!!t})),e.ColumnWidthMap=c,e.PinnedColumnsMap=r,e.Columns=i,e.ColumnSorts=a,e.RowGroupedColumns=s,Object.keys(d).length&&(e.AggregationColumns=d),e.EnablePivot=this.gridOptions.columnApi.isPivotMode(),e.PivotColumns=p,this.adaptableOptions.layoutOptions.includeExpandedRowGroups&&(e.ExpandedRowGroupValues=this.getExpandRowGroupsKeys()),this.api.layoutApi.fireLayoutUpdatedEvent(e,"UpdatedLayout"),this.persistLayout(e)},t.prototype.setSelectedCells=function(){var t=this;if(this.isSelectable()){var e=this.gridOptions.api.getCellRanges(),i=[],n=[];if(!this.api.internalApi.isGridInPivotMode()){e&&e.forEach((function(e){var r,a,l=!0,s=null!=e.startRow.rowPinned,u=null!=e.endRow.rowPinned;if(s&&(u&&(l=!1),F.LoggingHelper.LogWarning("Cannot select pinned rows in ag-Grid.")),l){var p=Math.min(e.startRow.rowIndex,e.endRow.rowIndex),d=Math.max(e.startRow.rowIndex,e.endRow.rowIndex),c=function(e){if(null!=e){var o=e.getColId(),r=t.api.columnApi.getColumnFromId(o);r&&null==i.find((function(t){return t.ColumnId==r.ColumnId}))&&i.push(r);for(var a=p;a<=d;a++){var l=t.gridOptions.api.getModel().getRow(a);if(l&&!t.isPinnedRowNode(l)){var s=t.getGridCellFromRowNode(l,o);n.push(s)}}}};try{for(var g=o.__values(e.columns),f=g.next();!f.done;f=g.next()){c(f.value)}}catch(h){r={error:h}}finally{try{f&&!f.done&&(a=g.return)&&a.call(g)}finally{if(r)throw r.error}}}}));var r={Columns:i,GridCells:n};return this.api.internalApi.setSelectedCells(r),this._emit("CellsSelected"),this.agGridHelper.fireSelectionChangedEvent(),r}}},t.prototype.setSelectedRows=function(){var t=this;if(this.isSelectable()){var e=this.gridOptions.api.getSelectedNodes(),i=[];if(!this.gridOptions.columnApi.isPivotMode()){S.ArrayExtensions.IsNotNullOrEmpty(e)&&e.forEach((function(e){var o={isMaster:!(null==e.master||1!=e.master),isExpanded:!(null==e.expanded||1!=e.expanded),isGroup:!(null==e.group||1!=e.group),level:e.level},n={primaryKeyValue:t.getPrimaryKeyValueFromRowNode(e),rowData:e.data,rowNode:e,rowInfo:o};i.push(n)}));var o={GridRows:i};return this.api.internalApi.setSelectedRows(o),this.agGridHelper.fireSelectionChangedEvent(),o}}},t.prototype.setValue=function(t){var e,i=this,o=this.api.columnApi.getColumnDataTypeFromColumnId(t.columnId);if(e=o==g.DataType.Number?Number(t.newValue):t.newValue,void 0!=o)if(t.rowNode)t.rowNode.setDataValue(t.columnId,e);else if(this.useRowNodeLookUp){var n=this.gridOptions.api.getRowNode(t.primaryKeyValue);null!=n&&(n.setDataValue(t.columnId,e),t.rowNode=n)}else{var r=!1;this.gridOptions.api.getModel().forEachNode((function(o){r||t.primaryKeyValue==i.getPrimaryKeyValueFromRowNode(o)&&(o.setDataValue(t.columnId,e),t.rowNode=o,r=!0)}))}},t.prototype.cancelEdit=function(){this.gridOptions.api.stopEditing(!0)},t.prototype.getDistinctValuesForColumn=function(t,e){var i=this,o=[],n=this.api.userInterfaceApi.getPermittedValuesForColumn(t);return S.ArrayExtensions.IsNotNull(n)?o=n.map((function(e){return{rawValue:e,displayValue:e,normalisedValue:e,columnId:t.ColumnId}})):e?this.gridOptions.api.forEachNodeAfterFilter((function(e){var n=i.addDistinctColumnValue(e,t.ColumnId);n&&void 0!=n.rawValue&&o.push(n)})):this.gridOptions.api.forEachNode((function(e){var n=i.addDistinctColumnValue(e,t.ColumnId);n&&void 0!=n.rawValue&&o.push(n)})),s.default(o,"displayValue").slice(0,this.adaptableOptions.queryOptions.maxColumnValueItemsDisplayed)},t.prototype.getColumnValueDisplayValuePairList=function(t,e,i){var o=this,n=[],r=new Map,a=this.api.columnApi.getColumnFromId(t),l=this.api.userInterfaceApi.getPermittedValuesForColumn(a);S.ArrayExtensions.IsNotNullOrEmpty(l)?l.forEach((function(e){r.set(e,{rawValue:e,displayValue:e,normalisedValue:e,columnId:t})})):r=null;this.shouldUseRawValueForColumn(t);var s=function(t,e,a){if(t&&!o.isGroupRowNode(t)){var l=o.getGridCellFromRowNode(t,e),s=!r||r.has(l.displayValue);if(s&&i){var u=o.getPrimaryKeyValueFromRowNode(t);s=!!i[u]}s&&n.push(l)}};return e?this.gridOptions.api.forEachNodeAfterFilter((function(e){s(e,t)})):this.gridOptions.api.forEachNode((function(e){s(e,t)})),n.slice(0,this.adaptableOptions.queryOptions.maxColumnValueItemsDisplayed)},t.prototype.addDistinctColumnValue=function(t,e){if(t&&!this.isGroupRowNode(t)){var i=this.getGridCellFromRowNode(t,e);return N.Helper.objectExists(i)?i:void 0}},t.prototype.shouldUseRawValueForColumn=function(t){var e=this.gridOptions.api.getColumnDef(t);return!(!e||null==e.cellRenderer)||!!this.api.columnApi.isSpecialRenderedColumn(t)},t.prototype.getDisplayValue=function(t,e){var i,o=this;if(this.useRowNodeLookUp){var n=this.gridOptions.api.getRowNode(t),r=this.getGridCellFromRowNode(n,e);r&&(i=r.displayValue)}else{var a=!1;this.gridOptions.api.getModel().forEachNode((function(n){if(!a){var r=o.getGridCellFromRowNode(n,e);r&&t==r.primaryKeyValue&&(i=r.displayValue),a=!0}}))}return i},t.prototype.getGridCellFromRowNode=function(t,e){if(null!=t){var i=this.getPrimaryKeyValueFromRowNode(t),o=this.getRawValueFromRowNode(t,e);return{rawValue:o,displayValue:this.getDisplayValueFromRawValue(e,o),normalisedValue:this.getNormalisedValueFromRowValue(o,e),columnId:e,primaryKeyValue:i}}},t.prototype.getDisplayValueFromRowNode=function(t,e){var i=this.getGridCellFromRowNode(t,e);return i?i.displayValue:void 0},t.prototype.getDisplayValueFromRawValue=function(t,e){if(this.api.columnApi.isSpecialRenderedColumn(t))return this.agGridHelper.getCleanValue(e);if(this.api.columnApi.isActionColumn(t))return this.agGridHelper.getCleanValue(e);var i=this.gridOptions.api.getColumnDef(t);if(i){if("function"==typeof i.valueFormatter){var o=this.gridOptions.columnApi.getAllColumns().find((function(e){return e.getColId()==t})),n=(0,i.valueFormatter)({value:e,node:null,data:null,colDef:i,column:o,api:this.gridOptions.api,columnApi:this.gridOptions.columnApi,context:this.gridOptions.context});return i.cellRenderer?this.agGridHelper.getRenderedValue(i,n):n||""}if(i.cellRenderer)return this.agGridHelper.getRenderedValue(i,e)}return this.agGridHelper.getCleanValue(e)},t.prototype.getNormalisedValueFromRowValue=function(t,e){if(void 0===t||null===t)return t;var i=this.api.columnApi.getColumnDataTypeFromColumnId(e);return"String"===i?"string"!==typeof t?String(t):t:"Number"===i?"number"!==typeof t?Number(t):t:"Boolean"===i?"boolean"!==typeof t?Boolean(t):t:"Date"===i?t instanceof Date?t:new Date(t):t},t.prototype.getRawValueFromRowNode=function(t,e){return this.gridOptions.api.getValue(e,t)},t.prototype.getDataRowFromRowNode=function(t){return null!=t&&void 0!=t?t.data:void 0},t.prototype.getRowNodeForPrimaryKey=function(t){var e=this;if(this.useRowNodeLookUp)return this.gridOptions.api.getRowNode(t);this.gridOptions.api.getModel().forEachNode((function(i){if(t==e.getPrimaryKeyValueFromRowNode(i))return i}))},t.prototype.getRowNodesForPrimaryKeys=function(t){var e=this,i=[];return this.useRowNodeLookUp?t.forEach((function(t){var o=e.gridOptions.api.getRowNode(t);o&&i.push(o)})):t.forEach((function(t){var o=!1;e.gridOptions.api.getModel().forEachNode((function(n){o||t!=e.getPrimaryKeyValueFromRowNode(n)||(i.push(n),o=!0)}))})),i},t.prototype.forAllRowNodesDo=function(t){this.gridOptions.api.getModel().forEachNode((function(e){t(e)}))},t.prototype.forAllVisibleRowNodesDo=function(t){this.gridOptions.api.forEachNodeAfterFilterAndSort((function(e,i){t(e,i)}))},t.prototype.selectNodes=function(t){var e=this;S.ArrayExtensions.IsNotNullOrEmpty(t)&&t.forEach((function(t){return e.selectNode(t)}))},t.prototype.selectNode=function(t){t?t.setSelected(!0,!0):F.LoggingHelper.LogAdaptableError("No node to select")},t.prototype.isRowNodeVisible=function(t){var e=!1;return this.gridOptions.api.forEachNodeAfterFilter((function(i){i==t&&(e=!0)})),e},t.prototype.redrawBody=function(){this.gridOptions.api.redrawRows(),this._emit("GridRefreshed")},t.prototype.redrawHeader=function(){this.gridOptions.api.refreshHeader()},t.prototype.redrawRow=function(t){var e={rowNodes:[t]};this.gridOptions.api.redrawRows(e)},t.prototype.refreshCells=function(t,e,i){var o={rowNodes:t,columns:e,force:i};this.gridOptions.api.refreshCells(o)},t.prototype.jumpToRow=function(t){this.gridOptions.api.ensureNodeVisible(t,"middle")},t.prototype.jumpToColumn=function(t){this.gridOptions.api.ensureColumnVisible(t)},t.prototype.jumpToCell=function(t,e){this.jumpToRow(e),this.jumpToColumn(t)},t.prototype.getColDefsForSpecialColumns=function(){return o.__spread(this.getColDefsForCalculatedColumns(),this.getColDefsForActionColumns(),this.getColDefsForFreeTextColumns())},t.prototype.getColDefsForFreeTextColumns=function(){var t=this;return this.api.freeTextColumnApi.getAllFreeTextColumn().map((function(e){var i=t.api.internalApi.getFilterOptions().enableFilterOnSpecialColumns;return{headerName:e.FriendlyName||e.ColumnId,colId:e.ColumnId,editable:!0,hide:!0,filter:i,sortable:!0,resizable:!0,enableRowGroup:!0,cellEditor:e.TextEditor&&"Large"==e.TextEditor?"agLargeTextCellEditor":"agTextCellEditor",type:[C.AB_SPECIAL_COLUMN,"abColDefString"],valueSetter:function(t){return t.data[e.ColumnId]=t.newValue},valueGetter:function(i){return t.FreeTextColumnService.GetFreeTextValue(e,i.node)}}}))},t.prototype.getColDefsForActionColumns=function(){return this.api.actionColumnApi.getAllActionColumn().map((function(t){return{headerName:t.FriendlyName?t.FriendlyName:t.ColumnId,colId:t.ColumnId,editable:!1,hide:!1,filter:!1,sortable:!1,resizable:!0,cellRenderer:z.ActionColumnRenderer,type:[C.AB_SPECIAL_COLUMN,"abColDefObject"]}}))},t.prototype.updateColDefsForSpecialColumns=function(){var t=this.getColDefsForSpecialColumns(),e=this.getGroupAndColumnDefs().filter((function(t){var e=t.type;return!(e===C.AB_SPECIAL_COLUMN||Array.isArray(e)&&e.includes(C.AB_SPECIAL_COLUMN))})),i=o.__spread(e,t);this.safeSetColDefs(i),this.setLayout()},t.prototype.getColDefsForCalculatedColumns=function(){var t=this;return this.api.calculatedColumnApi.getAllCalculatedColumn().map((function(e){var i=t.CalculatedColumnExpressionService.CleanExpressionColumnNames(e.ColumnExpression);if(!e.CalculatedColumnSettings){var o=!t.adaptableOptions.filterOptions.enableFilterOnSpecialColumns||t.adaptableOptions.filterOptions.enableFilterOnSpecialColumns;e.CalculatedColumnSettings=D.CreateEmptyCalculatedColumn(o).CalculatedColumnSettings}var n={headerName:e.FriendlyName?e.FriendlyName:e.ColumnId,colId:e.ColumnId,hide:!0,editable:!1,width:e.CalculatedColumnSettings.Width,enableValue:e.CalculatedColumnSettings.Aggregatable,filter:e.CalculatedColumnSettings.Filterable,floatingFilter:e.CalculatedColumnSettings.Filterable,resizable:e.CalculatedColumnSettings.Resizable,enableRowGroup:e.CalculatedColumnSettings.Groupable,sortable:e.CalculatedColumnSettings.Sortable,enablePivot:e.CalculatedColumnSettings.Pivotable,type:[C.AB_SPECIAL_COLUMN,t.getCalculatedColumnDataType(e,i)],valueGetter:function(e){return t.CalculatedColumnExpressionService.ComputeExpressionValue(i,e.node)}};return null!=e.CalculatedColumnSettings.ShowToolTip&&1==e.CalculatedColumnSettings.ShowToolTip&&(n.tooltipValueGetter=function(){return i}),n}))},t.prototype.getCalculatedColumnDataType=function(t,e){var i=t.CalculatedColumnSettings&&t.CalculatedColumnSettings.DataType?t.CalculatedColumnSettings.DataType:this.CalculatedColumnExpressionService.GetCalculatedColumnDataType(e);return this.agGridHelper.getAgGridDataType(i)},t.prototype.isRegularColDef=function(t){return void 0===t.children},t.prototype.isGroupColDef=function(t){return void 0!==t.children},t.prototype.getColDefs=function(){var t=this,e=this.getGroupAndColumnDefs(),i=[];return e.forEach((function(e){t.isRegularColDef(e)&&i.push(e)})),i},t.prototype.getGroupedColDefs=function(){var t=this,e=this.getGroupAndColumnDefs(),i=[];return e.forEach((function(e){t.isGroupColDef(e)&&i.push(e)})),i},t.prototype.isSpecialColumnReferenced=function(t){var e=[];return this.strategies.forEach((function(i){i.getSpecialColumnReferences(t,e)})),!!S.ArrayExtensions.IsNotNullOrEmpty(e)&&(this.api.alertApi.showAlertError("Cannot Delete the Column as it is referenced in:",e.join("\n")),!0)},t.prototype.getFirstRowNode=function(){var t;return this.gridOptions.api.forEachNode((function(e){e.group||(t=e)})),t},t.prototype.destroy=function(e){this.gridOptions&&this.gridOptions.api&&(this.gridOptions.api.__adaptable=null,this.gridOptions.api.setColumnDefs=et,this.gridOptions.getRowStyle=null,e&&!1===e.destroyApi||this.gridOptions.api.destroy()),this.colDefPropertyCache=null,this.gridOptionsPropertyCache=null,this.currentColumnDefs=null,this.rowListeners=null,this.emitter.clearListeners(),this.emitter=null,this._adaptableReady=!1,t.dismissInstance(this);var i=this.getadaptableContainerElement();e&&!e.unmount||null!=i&&p.unmountComponentAtNode(i)},t.prototype.getDefaultIPPStyle=function(){return{Header:{headerColor:"#000000",headerBackColor:"#f5f7f7",headerFontFamily:"sans-serif",headerFontSize:"12px",headerFontStyle:"normal",headerFontWeight:"400",height:65,Columns:this.api.columnApi.getColumns().map((function(t){return{columnFriendlyName:t.FriendlyName,width:200,textAlign:"start"}}))},Row:{color:"#000000",backColor:"#ffffff",altBackColor:"#fcfdfe",fontFamily:"sans-serif",fontSize:"12px",fontStyle:"normal",fontWeight:"400",height:30,Columns:this.api.columnApi.getColumns().map((function(t){return{columnFriendlyName:t.FriendlyName,width:200,textAlign:"start"}}))}}},t.prototype.getCurrentIPPStyle=function(){return this.agGridHelper.getCurrentIPPStyle()},t.prototype.getadaptableContainerElement=function(){if(!this.abContainerElement){var t=this.adaptableOptions.containerOptions.adaptableContainer;if(this.abContainerElement="string"===typeof t?document.getElementById(t):t,!this.abContainerElement){var e=document.getElementById("adaptableBlotter");e&&(F.LoggingHelper.LogAdaptableWarning('\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n!!!!! The old default container element for Adaptable was "#adaptableBlotter", configured via \'containerOptions.adaptableContainer="adaptableBlotter"\'.\n!!!!! Seems like you haven\'t updated your html container selector, so we\'re falling back to using that one.\n!!!!!\n!!!!! To make this warning go away, update your html structure and make sure you have an element with id="adaptable" in your app!\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n'),this.abContainerElement=e)}}return this.abContainerElement},t.prototype.getGridContainerElement=function(){return this.gridContainerElement||(this.gridContainerElement="string"===typeof this.adaptableOptions.containerOptions.vendorContainer?document.getElementById(this.adaptableOptions.containerOptions.vendorContainer):this.adaptableOptions.containerOptions.vendorContainer),this.gridContainerElement},t.prototype.initInternalGridLogic=function(){var e=this;if(null==this.abContainerElement&&(this.abContainerElement=this.getadaptableContainerElement()),null!=this.abContainerElement){var i=this.getGridContainerElement();i&&i.addEventListener("keydown",(function(t){return e._emit("KeyDown",t)}));var r=[n.Events.EVENT_COLUMN_MOVED,n.Events.EVENT_GRID_COLUMNS_CHANGED,n.Events.EVENT_COLUMN_EVERYTHING_CHANGED,n.Events.EVENT_DISPLAYED_COLUMNS_CHANGED,n.Events.EVENT_COLUMN_VISIBLE,n.Events.EVENT_NEW_COLUMNS_LOADED];this.gridOptions.api.addGlobalListener((function(t){r.indexOf(t)>-1&&(e.debouncedSetColumnIntoStore(),e.debouncedFilterGrid())})),this.gridOptions.api.addEventListener(n.Events.EVENT_FIRST_DATA_RENDERED,(function(){e.checkColumnsDataTypeSet(),e.setLayout()})),this.gridOptions.api.addEventListener(n.Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,(function(t){"columnPivotModeChanged"==t.type&&null!=t.columnApi&&null!=t.columnApi.columnController&&1==t.columnApi.columnController.pivotMode?(1==e.adaptableOptions.layoutOptions.autoSizeColumnsInPivotLayout&&e.gridOptions.columnApi.autoSizeAllColumns(),e.api.internalApi.setPivotModeOn()):e.api.internalApi.setPivotModeOff()})),this.gridOptions.api.addEventListener(n.Events.EVENT_COLUMN_PIVOT_CHANGED,(function(t){"columnPivotChanged"==t.type&&null!=t.columnApi&&null!=t.columnApi.columnController&&1==t.columnApi.columnController.pivotMode&&1==e.adaptableOptions.layoutOptions.autoSizeColumnsInPivotLayout&&e.gridOptions.columnApi.autoSizeAllColumns()}));var a=[n.Events.EVENT_COLUMN_PINNED,n.Events.EVENT_COLUMN_PIVOT_CHANGED,n.Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,n.Events.EVENT_DISPLAYED_COLUMNS_CHANGED,n.Events.EVENT_SORT_CHANGED,n.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,n.Events.EVENT_ROW_GROUP_OPENED];this.gridOptions.api.addGlobalListener((function(t){a.indexOf(t)>-1&&e.debouncedSaveGridLayout()})),this.gridOptions.api.addEventListener(n.Events.EVENT_COLUMN_RESIZED,(function(t){1==t.finished&&"columnResized"==t.type&&t.column&&(e._emit("ColumnResized",t.column.getColId()),e.debouncedSaveGridLayout())}));var l=[n.Events.EVENT_ROW_GROUP_OPENED,n.Events.EVENT_SELECTION_CHANGED,n.Events.EVENT_ROW_SELECTED];this.gridOptions.api.addGlobalListener((function(t){S.ArrayExtensions.ContainsItem(l,t)&&e.debouncedSetSelectedRows()})),this.gridOptions.api.addEventListener(n.Events.EVENT_RANGE_SELECTION_CHANGED,(function(t){1==t.finished&&e.debouncedSetSelectedCells()})),this.gridOptions.api.addEventListener(n.Events.EVENT_SORT_CHANGED,(function(t){e.onSortChanged(),e.debouncedSetSelectedCells()}));var s=this.adaptableOptions.generalOptions.showGroupingTotalsAsHeader;this.gridOptions.api.addEventListener(n.Events.EVENT_MODEL_UPDATED,(function(t){if(s&&t&&t.api){var e=t.api.getPinnedTopRow(0),i=t.api.getModel().getRootNode();e?e.updateData(i.aggData):t.api.setPinnedTopRowData([i.aggData])}})),this.rowListeners={dataChanged:function(t){e.onRowDataChanged({rowNode:t.node,oldData:t.oldData,newData:t.newData})},cellChanged:function(t){t.column&&e.onCellDataChanged({rowNode:t.node,oldValue:t.oldValue,newValue:t.newValue,colId:t.column.colId})}},$.dispatchLocalEvent=function(e){var i=e.node,o=tt.apply(this,arguments);return i&&t.forEachAdaptable((function(t){if(i.gridApi===t.gridOptions.api){var o=t.rowListeners?t.rowListeners[e.type]:null;o&&o(e)}})),o};var u=this.gridOptions.isExternalFilterPresent;this.gridOptions.isExternalFilterPresent=function(){var t,i,n=e.api.filterApi.getAllColumnFilter(),r=S.ArrayExtensions.IsNotNullOrEmpty(n);if(r)try{for(var a=o.__values(n),l=a.next();!l.done;l=a.next()){var s=l.value,p=e.gridOptions.columnApi.getColumn(s.ColumnId);p&&!p.isFilterActive()&&p.setFilterActive(!0)}}catch(c){t={error:c}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}var d=E.StringExtensions.IsNotNullOrEmpty(e.api.queryApi.getCurrentQuery());return r||d||!!u&&u()};var p=this.gridOptions.doesExternalFilterPass;this.gridOptions.doesExternalFilterPass=function(t){var i,n;if(!e.api.internalApi.isServerSearchOptionSet("Query")){var r=e.api.queryApi.getCurrentQuery();if(r&&!c.evaluate(r,{node:t,api:e.api,functions:e.adaptableOptions.queryOptions.expressionFunctions}))return!1}if(!e.api.internalApi.isServerSearchOptionSet("Filter")){var a=e.api.filterApi.getAllColumnFilter();if(a.length>0)try{for(var l=o.__values(a),s=l.next();!s.done;s=l.next()){var u=s.value;if(!e.api.filterApi.evaluateColumnFilter(u,t))return!1}}catch(d){i={error:d}}finally{try{s&&!s.done&&(n=l.return)&&n.call(l)}finally{if(i)throw i.error}}}return!p||p(t)};var d=this.gridOptions.getMainMenuItems;this.gridOptions.getMainMenuItems=function(t){return e.agGridMenuHelper.buildColumnMenu(t,d)};var g=this.gridOptions.getContextMenuItems;this.gridOptions.getContextMenuItems=function(t){return e.agGridMenuHelper.buildContextMenu(t,g)},this.prepareGrid()}else"string"===typeof this.adaptableOptions.containerOptions.adaptableContainer?F.LoggingHelper.LogAdaptableError('There is no DIV with id="'+this.adaptableOptions.containerOptions.adaptableContainer+'" so cannot render Adaptable'):F.LoggingHelper.LogAdaptableError("No valid adaptableContainer found to render Adaptable",this.adaptableOptions.containerOptions.adaptableContainer)},t.prototype.buildStandaloneColumnHeader=function(t){return this.agGridMenuHelper.buildStandaloneColumnHeader(t)},t.prototype.prepareGrid=function(){this.updateColDefsForSpecialColumns(),this.applyCurrentTheme(),this.applyFinalRendering(),this.applyGridFiltering()},t.prototype.setupColumns=function(){var t=this,e=this.gridOptions.columnApi.getAllColumns();e.map((function(t){return t.getColDef()})).forEach(X),this.updateColumnsIntoStore(),e.forEach((function(e){var i=e.getColDef(),o=e.getColId(),n={col:e,colDef:i,colId:o,abColumn:t.api.columnApi.getColumnFromId(o)};t.setupColumnCellRenderer(n),t.setupColumnCellStyle(n),t.setupColumnCellClass(n),t.setupColumnTooltipValueGetter(n),t.setupColumnTooltipField(n),t.setupColumnFilter(n),t.setupColumnFloatingFilter(n),t.setupColumnValueFormatter(n),t.setupColumnValueSetter(n),t.setupColumnComparator(n),t.setupColumnCellEditor(n)})),this.setupRowStyling(),this.redrawBody(),this.redrawHeader()},t.prototype.setGridOptionsProperty=function(t,e){var i="user."+t,o="adaptable."+t,n=this.gridOptions[t];n!==this.gridOptionsPropertyCache.get(o)&&this.gridOptionsPropertyCache.set(i,n);var r=this.gridOptionsPropertyCache.get(i),a=e(r);null!=a&&this.gridOptionsPropertyCache.set(o,a),this.gridOptions[t]=null!==a&&void 0!==a?a:r},t.prototype.setColDefProperty=function(t,e,i){var o=t.getColId(),n=t.getColDef(),r="user."+o+"."+e,a="adaptable."+o+"."+e,l=n[e];l!==this.colDefPropertyCache.get(a)&&this.colDefPropertyCache.set(r,l);var s=this.colDefPropertyCache.get(r),u=i(s);null!=u&&this.colDefPropertyCache.set(a,u),n[e]=null!==u&&void 0!==u?u:s},t.prototype.setupColumnCellStyle=function(t){var e=this,i=t.col,n=t.colId,r=t.abColumn;this.setColDefProperty(i,"cellStyle",(function(t){var i,a,l={backgroundColor:null,color:null,fontWeight:null,fontStyle:null,fontSize:null},s=e.api.gradientColumnApi.getGradientColumnByColumn(n),u=e.api.formatColumnApi.getFormatColumnForColumn(r),p=u?e.getFormatColumnCellStyle(u):void 0,d=e.api.conditionalStyleApi.getConditionalStylesForColumn(r),c=e.api.flashingCellApi.getFlashingCellForColumn(n);c&&(i=c.UpColor?c.UpColor:e.api.flashingCellApi.getFlashingCellState().DefaultUpColor),c&&(a=c.DownColor?c.DownColor:e.api.flashingCellApi.getFlashingCellState().DefautDownColor);var g=e.getQuickSearchCellStyle(),f=void 0!=g;return function(n){var u=f&&e.isQuickSearchActive(r,n);return o.__assign(o.__assign(o.__assign(o.__assign(o.__assign(o.__assign(o.__assign(o.__assign(o.__assign({},l),"function"===typeof t?t(n):t),s?e.getGradientColumnCellStyle(s,n):void 0),p),e.getConditionalStyleCellStyle(d,r,n)),u?g:void 0),e.getAlertCellStyle(r,n)),e.getCellHighlightStyle(r,n)),c?e.getFlashingCellsCellStyle(c,i,a,n):void 0)}}))},t.prototype.setupColumnCellClass=function(t){var e=this,i=t.col,o=t.colId,n=t.abColumn;this.setColDefProperty(i,"cellClass",(function(t){var i,r=e.api.formatColumnApi.getFormatColumnWithStyleClassNameForColumn(n),a=r?null===(i=r.Style)||void 0===i?void 0:i.ClassName:null,l=e.api.conditionalStyleApi.getConditionalStylesForColumn(n).filter((function(t){return E.StringExtensions.IsNotNullOrEmpty(t.Style.ClassName)})),s=S.ArrayExtensions.IsNotNullOrEmpty(l),u=e.api.quickSearchApi.getQuickSearchStyle().ClassName,p=E.StringExtensions.IsNotNullOrEmpty(u);return function(i){var r=p&&e.isQuickSearchActive(n,i),d=e.getPrimaryKeyValueFromRowNode(i.node),c=[e.getExcelClassNameForCell(o,d),"function"===typeof t?t(i):t,a,s?e.getConditionalStyleCellClass(l,n,i):null,r?u:null].filter((function(t){return!!t})).join(" ");return E.StringExtensions.IsNotNullOrEmpty(c)?c:void 0}}))},t.prototype.getExcelClassNameForCell=function(t,e){return"--excel-cell-"+t+"-"+e},t.prototype.setupColumnCellEditor=function(t){var e=this,i=t.colId,o=t.col,n=this.api.userInterfaceApi.getEditLookUpItemForColumn(i);this.setColDefProperty(o,"cellEditor",(function(){if(n)return e.isModulePresent("rich-select")?"agRichSelectCellEditor":"agSelectCellEditor"})),this.setColDefProperty(o,"cellEditorParams",(function(){if(n)return{values:e.api.userInterfaceApi.getEditLookUpValuesForEditLookUpItem(n,i)}}))},t.prototype.setupColumnCellRenderer=function(t){var e=this,i=t.col,o=t.colId;this.setColDefProperty(i,"cellRenderer",(function(){var t=e.api.percentBarApi.getPercentBarByColumn(o);if(t)return e.agGridHelper.createPercentBarCellRendererFunc(t);var i=e.api.sparklineColumnApi.getSparklineByColumn(o);if(i)return e.agGridHelper.createSparklineCellRendererComp(i);var n=e.api.userInterfaceApi.getCheckBoxColumnByColumnId(o);return n?e.agGridHelper.createCheckboxRendererComp(n):void 0}))},t.prototype.setupColumnTooltipValueGetter=function(t){var e=this,i=t.col,o=t.colId;this.setColDefProperty(i,"tooltipValueGetter",(function(){var t=e.api.percentBarApi.getPercentBarByColumn(o);if(null===t||void 0===t?void 0:t.ShowToolTip)return function(i){var o=e.api.percentBarApi.getPercentBarMinValue(t,i.node),n=e.api.percentBarApi.getPercentBarMaxValue(t,i.node),r=(N.Helper.clamp(i.value,o,n)-o)/(n-o)*100;return t.DisplayRawValue&&t.DisplayPercentageValue?i.value+" ("+r.toFixed(0)+"%)":t.DisplayPercentageValue?r.toFixed(0)+"%":i.value}}))},t.prototype.setupColumnTooltipField=function(t){var e=this,i=t.col,o=t.colId,n=t.colDef;this.setColDefProperty(i,"tooltipField",(function(){var t=e.api.sparklineColumnApi.getSparklineByColumn(o);if(t)return t.ShowToolTip?n.field:""}))},t.prototype.setupColumnFilter=function(t){var e=this,i=t.col,o=t.colDef;this.setColDefProperty(i,"filter",(function(){if(o.filter&&e.adaptableOptions.filterOptions.useAdaptableFilterForm)return e.gridOptions.api.destroyFilter(i),q.FilterWrapperFactory(e)}))},t.prototype.setupColumnFloatingFilter=function(t){var e=this,i=t.col,o=!t.colDef.floatingFilter||!this.adaptableOptions.filterOptions.useAdaptableQuickFilter;this.setColDefProperty(i,"floatingFilterComponent",(function(){if(!o)return Y.FloatingFilterWrapperFactory(e)})),this.setColDefProperty(i,"floatingFilterComponentParams",(function(){if(!o)return{suppressFilterButton:!0}}))},t.prototype.setupColumnValueFormatter=function(t){var e=this,i=t.col,o=t.abColumn;this.setColDefProperty(i,"valueFormatter",(function(){var t=e.api.formatColumnApi.getFormatColumnWithDisplayFormatForColumn(o);if(t&&t.DisplayFormat){var i=void 0;if("NumberFormatter"===t.DisplayFormat.Formatter&&e.api.scopeApi.isColumnInNumericScope(o,t.Scope)){var n=t.DisplayFormat.Options;i=function(t){return I.default.NumberFormatter(t.value,n)}}if("DateFormatter"===t.DisplayFormat.Formatter&&e.api.scopeApi.isColumnInDateScope(o,t.Scope)){var r=t.DisplayFormat.Options;i=function(t){return I.default.DateFormatter(t.value,r)}}if("StringFormatter"===t.DisplayFormat.Formatter&&e.api.scopeApi.isColumnInStringsScope(o,t.Scope)){var a=t.DisplayFormat.Options;i=function(t){return I.default.StringFormatter(t.value,a)}}return i}}))},t.prototype.setupColumnValueSetter=function(t){var e=this,i=t.col,o=t.colId,n=t.abColumn;this.setColDefProperty(i,"valueSetter",(function(){var t,i=e.api.cellValidationApi.getAllCellValidation().filter((function(t){return e.api.scopeApi.isColumnInScope(n,t.Scope)}));if(i.length||(null===(t=e.adaptableOptions.editOptions)||void 0===t?void 0:t.validateOnServer)){return function(t){var n,r=t.column.getColDef().field,a={oldValue:t.oldValue,newValue:t.newValue,columnId:t.column.getColId(),primaryKeyValue:e.getPrimaryKeyValueFromRowNode(t.node),rowNode:t.node};if(!i.length)return!0;if(a.oldValue===a.newValue)return!0;if(!e.ValidationService.PerformCellValidation(a))return!1;if((null===(n=e.adaptableOptions.editOptions)||void 0===n?void 0:n.validateOnServer)&&e.ValidationService.PerformServerValidation(a,{onServerValidationCompleted:function(){}})(),!r)throw"Cannot edit a column without a field - column id was "+o;return t.data[r]=t.newValue,!0}}}))},t.prototype.setupColumnComparator=function(t){var e=this,i=t.col,o=t.colId,n=this.api.customSortApi.getCustomSortByColumn(o),r=function(){if(n)return n.CustomSortComparerFunction?e.getUserFunctionHandler(C.CUSTOM_SORT_COMPARER_FUNCTION,n.CustomSortComparerFunction):e.runAdaptableComparerFunction(n.ColumnId,n.SortedValues)};this.setColDefProperty(i,"comparator",r),this.setColDefProperty(i,"pivotComparator",r)},t.prototype.applyCurrentTheme=function(){this.api.themeApi.applyCurrentTheme()},t.prototype.applyFinalRendering=function(){this.embedColumnMenu=this.isModulePresent("menu"),this.gridOptions.defaultGroupSortComparator=this.agGridHelper.runAdaptableNodeComparerFunction(),this.gridOptions.treeData&&1==this.gridOptions.treeData?this.api.internalApi.setTreeModeOn():this.api.internalApi.setTreeModeOff(),this.agGridHelper.checkShouldClearExistingFiltersOrSearches()},t.prototype.isModulePresent=function(t){var e=n.ModuleRegistry.getRegisteredModules().concat(this.agGridModules).map((function(t){return t.moduleName}));return S.ArrayExtensions.ContainsAnyItem(e,["@ag-grid-enterprise/"+t,"@ag-grid-enterprise/all-modules"])},t.prototype.isSharedQueryReferenced=function(t){var e="";return this.strategies.forEach((function(i){var o=i.getSharedQueryReferences(t);E.StringExtensions.IsNotNullOrEmpty(o)&&(e+=" "+o)})),!!E.StringExtensions.IsNotNullOrEmpty(e)&&(alert("Cannot delete the Shared Query because it is referenced in"+e),!0)},t.prototype.onRowDataChanged=function(t){var e=this,i=t.rowNode,o=t.oldData,n=t.newData;if(null!=o&&void 0!=o&&o!=n){var r=this.getPrimaryKeyValueFromRowNode(i);if(r){var a=[];Object.keys(o).forEach((function(t){if(e.api.columnApi.doesColumnExist(t)){var l=o[t],s=n[t];if(l!=s){var u={oldValue:l,newValue:s,columnId:t,primaryKeyValue:r,rowNode:i,trigger:"tick"};a.push(u)}}})),this.performPostEditChecks(a)}}},t.prototype.onCellDataChanged=function(t){var e=t.rowNode,i=t.oldValue,o=t.newValue,n=t.colId;if(i!=o){var r=this.getPrimaryKeyValueFromRowNode(e);if(r&&this.api.columnApi.doesColumnExist(n)){var a={oldValue:i,newValue:o,columnId:n,primaryKeyValue:r,rowNode:e,trigger:"edit"};this.performPostEditChecks([a])}}},t.prototype.performPostEditChecks=function(t){var e=this,i=t[0];if(i&&i.rowNode){var o=this.isVisibleNode(i.rowNode);t.forEach((function(t){"edit"==t.trigger&&(e.checkChangedCellCurrentlySelected(t),e.FreeTextColumnService.CheckIfDataChangingColumnIsFreeText(t)),e.DataService.CreateDataChangedEvent(t),o&&e.flashCellIfNeeded(t)})),o&&(this.refreshExpressionStylesIfNeeded(i.rowNode,t),this.refreshUpdatedRowsIfNeeded(i)),"tick"==i.trigger?this.filterOnTickingDataChange():this.filterOnEditDataChange()}},t.prototype.refreshExpressionStylesIfNeeded=function(t,e){var i=this,o=this.api.conditionalStyleApi.getConditionalStylesWithExpression();if(!S.ArrayExtensions.IsNullOrEmpty(o)){var n=!1,r=!1,a=new Set,l=new Set;e.forEach((function(t){n||o.forEach((function(e){if(!n){i.api.queryApi.getColumnsFromQueryObject({Expression:e.Expression}).forEach((function(t){return a.add(t)}));var o=a.has(t.columnId);if(i.api.scopeApi.scopeIsAll(e.Scope)){if(o)return void(n=!0)}else i.api.scopeApi.getColumnsForScope(e.Scope).map((function(t){return t.ColumnId})).forEach((function(t){l.add(t)}))}})),a.has(t.columnId)&&(r=!0)})),n?this.redrawRow(t):r&&this.refreshCells([t],Array.from(l.values()),!0)}},t.prototype.refreshUpdatedRowsIfNeeded=function(t){var e=this;this.api.updatedRowApi.isUpdatedRowEnabled()&&(this.api.internalApi.isRowInUpdatedRowInfo(t.primaryKeyValue)||setTimeout((function(){e.redrawRow(t.rowNode)}),10))},t.prototype.flashCellIfNeeded=function(t){var e,i=this,o=t.columnId,n=t.primaryKeyValue,r=t.oldValue,a=t.newValue,l=t.rowNode,s=this.api.flashingCellApi.getLiveFlashingCellForColumn(o);if(s){var u=n+":"+o,p=this.flashingState.get(u);p&&clearTimeout(p.timeout);var d=r<a?"up":r>a?"down":"neutral",c=setTimeout((function(){i.flashingState.delete(u),i.refreshCells([l],[o],!0)}),null!==(e=s.FlashingCellDuration)&&void 0!==e?e:this.api.flashingCellApi.getDefaultFlashingCellDuration());this.flashingState.set(u,{timeout:c,direction:d}),this.refreshCells([l],[o],!0)}},t.prototype.checkChangedCellCurrentlySelected=function(t){var e=this.api.gridApi.getSelectedCellInfo();e&&S.ArrayExtensions.IsNotNullOrEmpty(e.GridCells)&&(e.GridCells.find((function(e){return e.primaryKeyValue==t.primaryKeyValue&&e.columnId==t.columnId}))&&this.setSelectedCells());var i=this.api.gridApi.getSelectedRowInfo();i&&S.ArrayExtensions.IsNotNullOrEmpty(i.GridRows)&&(i.GridRows.find((function(e){return e.primaryKeyValue==t.primaryKeyValue}))&&this.setSelectedRows())},t.prototype.getColumnSorts=function(){var t=[];return this.gridOptions.columnApi.getColumnState().forEach((function(e){var i=e.colId;e.sort&&null!=e.sortIndex&&t.push({ColumnId:i,SortOrder:"asc"===e.sort?"Asc":"Desc",SortIndex:e.sortIndex})})),t.sort((function(t,e){return t.SortIndex-e.SortIndex})),t.map((function(t){return{ColumnId:t.ColumnId,SortOrder:t.SortOrder}}))},t.prototype.onSortChanged=function(){var t=this.getColumnSorts();this.api.gridApi.setColumnSorts(t),this._emit("SortChanged",t)},t.prototype.expandAllRowGroups=function(){this.gridOptions.api.forEachNode((function(t){t.group&&(t.expanded=!0)})),this.gridOptions.api.onGroupExpandedOrCollapsed()},t.prototype.closeAllRowGroups=function(){this.gridOptions.api.forEachNode((function(t){t.group&&(t.expanded=!1)})),this.gridOptions.api.onGroupExpandedOrCollapsed()},t.prototype.expandRowGroupsForValues=function(t){if(S.ArrayExtensions.IsNotNullOrEmpty(t)){var e=t.reduce((function(t,e){return t[e]=!0,t}),{});this.gridOptions.api.forEachNode((function(t){if(t.group&&!t.expanded){for(var i=[],o=t;o;)i.push(o.key),o=o.parent;var n=i.filter((function(t){return!!t})).reverse().join("/");e[n]&&t.setExpanded(!0)}})),this.gridOptions.api.onGroupExpandedOrCollapsed()}},t.prototype.getColumnFieldForAdaptableColumn=function(t){return this.gridOptions.columnApi.getAllColumns().find((function(e){return e.getColId()===t.ColumnId})).getColDef().field||""},t.prototype.getExpandRowGroupsKeys=function(){var t=[];return this.adaptableOptions.layoutOptions.includeExpandedRowGroups&&this.gridOptions.api.forEachNode((function(e){if(e.group&&e.expanded){for(var i=e,o=[];i;)o.push(i.key),i=i.parent;t.push(o.filter((function(t){return!!t})).reverse().join("/"))}})),t},t.prototype.getRowCount=function(){return this.gridOptions.rowData?this.gridOptions.rowData.length:this.gridOptions.api.getDisplayedRowCount()},t.prototype.getColumnCount=function(){return this.gridOptions.columnApi.getAllColumns().length},t.prototype.getVisibleRowCount=function(){return this.gridOptions.api.getDisplayedRowCount()},t.prototype.getVisibleColumnCount=function(){return this.gridOptions.columnApi.getAllColumns().filter((function(t){return t.isVisible()})).length},t.prototype.selectColumns=function(t){var e=this;t.forEach((function(t){return e.selectColumn(t)}))},t.prototype.selectColumn=function(t){this.gridOptions.api.clearRangeSelection();var e={rowStartIndex:0,rowEndIndex:this.gridOptions.api.getDisplayedRowCount(),columnStart:t,columnEnd:t};this.gridOptions.api.addCellRange(e)},t.prototype.selectAll=function(){this.gridOptions.api.selectAll()},t.prototype.hideColumn=function(t){this.gridOptions.columnApi.getColumn(t)&&(this.gridOptions.columnApi.setColumnVisible(t,!1),this.updateColumnsIntoStore())},t.prototype.showColumn=function(t){this.gridOptions.columnApi.getColumn(t)&&(this.gridOptions.columnApi.setColumnVisible(t,!0),this.updateColumnsIntoStore())},t.prototype.setColumnSort=function(t){var e=t.reduce((function(t,e,i){return t[e.ColumnId]=o.__assign(o.__assign({},e),{SortIndex:i}),t}),{});if(this.gridOptions.api){var i=this.gridOptions.columnApi.getColumnState().map((function(t){var i=t.colId,n=o.__assign({},t),r=e[i];return r?(n.sort="Asc"===r.SortOrder?"asc":"desc",n.sortIndex=r.SortIndex):(n.sort=null,n.sortIndex=null),n}));this.gridOptions.columnApi.setColumnState(i),this.gridOptions.api.onSortChanged()}},t.prototype.setDataSource=function(t){this.gridOptions.api&&this.gridOptions.api.setRowData(t)},t.prototype.loadDataSource=function(t){this.setDataSource(t)},t.prototype.updateRows=function(t,e){(e=e||{}).runAsync?this.gridOptions.api.applyTransactionAsync({update:t},e.callback):this.gridOptions.api.applyTransaction({update:t})},t.prototype.addRows=function(t,e){(e=e||{}).runAsync?this.gridOptions.api.applyTransactionAsync({add:t},e.callback):this.gridOptions.api.applyTransaction({add:t})},t.prototype.deleteRows=function(t,e){(e=e||{}).runAsync?this.gridOptions.api.applyTransactionAsync({remove:t},e.callback):this.gridOptions.api.applyTransaction({remove:t})},t.prototype.getFirstGroupedColumn=function(){var t=this.gridOptions.columnApi.getRowGroupColumns();if(S.ArrayExtensions.IsNotNullOrEmpty(t)){var e=t[0];return this.api.columnApi.getColumnFromId(e.getColId())}},t.prototype.checkColumnsDataTypeSet=function(){var t=this.api.columnApi.getColumns()[0];t&&t.DataType==g.DataType.Unknown&&this.updateColumnsIntoStore()},t.prototype.runAdaptableComparerFunction=function(t,e){var i=this;return function(o,n,r,a){var l=r?i.getDisplayValueFromRowNode(r,t):o,s=a?i.getDisplayValueFromRowNode(a,t):n,u=e.indexOf(l),p=u>=0,d=e.indexOf(s),c=d>=0;return p||c?p?c?u-d:-1:1:o==n?0:o<n?-1:1}},t.prototype.isSelectable=function(){return!(!this.isModulePresent("range-selection")||null==this.gridOptions.enableRangeSelection||!this.gridOptions.enableRangeSelection)},t.prototype.isGroupable=function(){return!this.api.internalApi.isGridInTreeMode()},t.prototype.isGroupingActive=function(){var t=!1;return this.gridOptions.api.forEachNode((function(e){t||e.group&&(t=!0)})),t},t.prototype.isPivotable=function(){return!this.api.internalApi.isGridInTreeMode()},t.prototype.isQuickFilterAvailable=function(){return!0===this.hasFloatingFilterOnAtLeastOneColumn()},t.prototype.hasFloatingFilterOnAtLeastOneColumn=function(t){var e,i,n;if(void 0===t&&(t=this.gridOptions.columnDefs),this.gridOptions.defaultColDef&&this.gridOptions.defaultColDef.floatingFilter)return!0;try{for(var r=o.__values(t),a=r.next();!a.done;a=r.next()){if((n=a.value).floatingFilter)return!0;if(n.children&&this.hasFloatingFilterOnAtLeastOneColumn(n.children))return!0}}catch(l){e={error:l}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}return!1},t.prototype.showQuickFilter=function(){this.gridOptions.api.setFloatingFiltersHeight(null)},t.prototype.hideQuickFilter=function(){this.gridOptions.api.setFloatingFiltersHeight(0)},t.prototype.getVendorGridLightThemeName=function(){var t=this.getGridContainerElement();if(t&&t.classList)for(var e=t.classList,i=0,o=e.length;i<o;i++){var n=e[i];if(0===n.indexOf("ag-theme-"))return n.replace("-dark","")}return this.agGridHelper.getVendorLightThemeName()},t.prototype.getVendorGridCurrentThemeName=function(){var t=this.getGridContainerElement();if(t&&t.classList)for(var e=t.classList,i=0,o=e.length;i<o;i++){var n=e[i];if(0===n.indexOf("ag-theme-"))return n}return this.getVendorGridLightThemeName()},t.prototype.applyAdaptableTheme=function(t){var e=this,i="string"===typeof t?t:t.Name,n=[],r=[],a=this.api.themeApi.getAllTheme().map((function(t){return o.__assign({},t)})).reduce((function(t,e){return t[e.Name]=e,t}),{}),l=document.documentElement;l.classList.forEach((function(t){if(0===t.indexOf(m.THEME_STYLE)){n.push(t);var e=t.substring(m.THEME_STYLE.length);a[e]&&r.push(a[e])}})),n.forEach((function(t){return l.classList.remove(t)})),this.adaptableOptions.userInterfaceOptions&&this.adaptableOptions.userInterfaceOptions.useCustomMacLikeScrollbars&&w.default()>0?l.classList.add("ab--custom-mac-like-scrollbars"):l.classList.remove("ab--custom-mac-like-scrollbars");var s=a[i],u=m.THEME_STYLE+i;l.classList.add(u);var p=getComputedStyle(l),d=o.__read(["--ab-loaded","--ab-theme-loaded"].map((function(t){var e=p.getPropertyValue(t);return"string"===typeof e&&e.trim&&(e=e.trim()),e})),2),c=d[0],g=d[1],f=!!this.api.themeApi.getAllSystemTheme().filter((function(t){return t.Name===i}))[0],h=this.getGridContainerElement(),y=function(){return e.getVendorGridLightThemeName()};if(s&&f&&(i===C.LIGHT_THEME&&(s.VendorGridClassName=s.VendorGridClassName||y()),i===C.DARK_THEME&&(s.VendorGridClassName=s.VendorGridClassName||y()+"-dark")),s.VendorGridClassName||(s.VendorGridClassName=y()),null!=h){r.length&&r.forEach((function(t){t.VendorGridClassName&&h.classList.remove(t.VendorGridClassName)}));var v=[];h.classList.forEach((function(t){t&&0===t.indexOf("ag-theme-")&&v.push(t)})),v.forEach((function(t){return h.classList.remove(t)})),s&&s.VendorGridClassName&&h.classList.add(s.VendorGridClassName),h.classList.add("ab-Grid"),this.adaptableOptions.filterOptions.indicateFilteredColumns&&h.classList.add("ab-Grid--indicate-filtered-columns")}"777"!==c&&F.LoggingHelper.LogError('Please import Adaptable styles from "adaptableadaptable/index.css"'),g!==i&&F.LoggingHelper.LogWarning('Theme "'+i+'" doesn\'t seem to be loaded! Make sure you import the css file for the "'+i+'" theme!\n\nIf it\'s a default theme, try\n\nimport "@adaptabletools/adaptable/themes/'+i+'.css"')},t.prototype.setupRowStyling=function(){var t=this,e=this.api.userInterfaceApi.getUserInterfaceState().RowStyles,i=this.api.conditionalStyleApi.getRowConditionalStyles(),n=this.api.updatedRowApi.getUpdatedRowState();this.setGridOptionsProperty("getRowStyle",(function(r){return function(a){return o.__assign(o.__assign(o.__assign(o.__assign({},null===r||void 0===r?void 0:r(a)),t.getUserInterfaceRowStyle(e,a)),t.getConditionalStyleRowStyle(i,a)),n.EnableUpdatedRow?t.getUpdatedRowRowStyle(n,a):null)}})),this.setGridOptionsProperty("getRowClass",(function(e){return function(o){var n=["function"===typeof e?e(o):e,t.getConditionalStyleRowClass(i.filter((function(t){return E.StringExtensions.IsNotNullOrEmpty(t.Style.ClassName)})),o)].filter((function(t){return!!t})).join(" ");return E.StringExtensions.IsNotNullOrEmpty(n)?n:void 0}}))},t.prototype.getUserInterfaceRowStyle=function(t,e){var i=this;return t.reduce((function(t,n){return"All"===n.RowType||"Odd"===n.RowType&&e.node.rowIndex%2===1||"Even"===n.RowType&&e.node.rowIndex%2===0?o.__assign(o.__assign({},t),i.convertAdaptableStyleToCSS(n.Style)):t}),{})},t.prototype.getUserInterfaceRowClass=function(t,e){return t.map((function(t){var i;if("All"===t.RowType||"Odd"===t.RowType&&e.node.rowIndex%2===1||"Even"===t.RowType&&e.node.rowIndex%2===0)return null===(i=t.Style)||void 0===i?void 0:i.ClassName})).filter((function(t){return!!t})).join(" ")},t.prototype.getConditionalStyleRowClass=function(t,e){if(S.ArrayExtensions.IsNotNullOrEmpty(t)){var i=this.StrategyService.getStrategyById(y.ConditionalStyleStrategyId);return t.map((function(t){var o;if(i.isConditionalStyleActiveForRow(t,e))return null===(o=t.Style)||void 0===o?void 0:o.ClassName})).filter((function(t){return!!t})).join(" ")}},t.prototype.getConditionalStyleRowStyle=function(t,e){if(S.ArrayExtensions.IsNotNullOrEmpty(t)){var i=this.StrategyService.getStrategyById(y.ConditionalStyleStrategyId),o=t.find((function(t){return i.isConditionalStyleActiveForRow(t,e)}));if(o)return this.convertAdaptableStyleToCSS(o.Style)}},t.prototype.getUpdatedRowRowStyle=function(t,e){var i=this.getPrimaryKeyValueFromRowNode(e.node);return this.api.internalApi.isRowInUpdatedRowInfoWithDirection(i,g.ChangeDirection.Up)?{backgroundColor:t.UpColor}:this.api.internalApi.isRowInUpdatedRowInfoWithDirection(i,g.ChangeDirection.Down)?{backgroundColor:t.DownColor}:this.api.internalApi.isRowInUpdatedRowInfoWithDirection(i,g.ChangeDirection.Neutral)?{backgroundColor:t.NeutralColor}:void 0},t.prototype.getGridOptionsApi=function(){if(this.gridOptions.api)return this.gridOptions.api;F.LogAdaptableError("There is a problem with your instance of ag-Grid - it has no gridApi object.  Please contact Support.")},t.prototype.getUserFunctionHandler=function(t,e){var i,n;if(!this.adaptableOptions.userFunctions)return null;try{for(var r=o.__values(this.adaptableOptions.userFunctions),a=r.next();!a.done;a=r.next()){var l=a.value;if(l.type===t&&l.name===e)return l.handler}}catch(s){i={error:s}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return null},t.prototype.canExportToExcel=function(){return this.isModulePresent("excel-export")},t.prototype.exportToExcel=function(t,e){var i={columnDefs:t.columns.map((function(t){return{field:t.ColumnId,headerName:t.FriendlyName}})),rowData:t.rows},o=new n.Grid(document.createElement("div"),i);i.api.exportDataAsExcel({sheetName:"Sheet 1",fileName:e}),o.destroy()},t.prototype.setExcelStylesForExport=function(){var t=this;this.setGridOptionsProperty("excelStyles",(function(e){var i=[],n=t.gridOptions.columnApi.getAllDisplayedColumns(),r=n.map((function(t){return t.getColDef()}));return t.forAllVisibleRowNodesDo((function(e,a){var l={node:e,data:e.data,rowIndex:a,$scope:{},api:t.gridOptions.api,columnApi:t.gridOptions.columnApi,context:{}},s=t.gridOptions.getRowStyle(l);n.forEach((function(n,l){var u=r[l],p={colDef:u,node:e,data:e.data,value:t.getRawValueFromRowNode(e,n.getId()),rowIndex:a,$scope:{},api:t.gridOptions.api,columnApi:t.gridOptions.columnApi,context:{}},d="function"===typeof u.cellStyle?u.cellStyle(p):{},c=o.__assign(o.__assign({},s),Object.keys(d).reduce((function(t,e){return null!==d[e]&&(t[e]=d[e]),t}),{}));i.push(o.__assign({id:t.getExcelClassNameForCell(n.getId(),t.getPrimaryKeyValueFromRowNode(e))},t.convertCSSToExcelStyle(c)))}))})),o.__spread(null!==e&&void 0!==e?e:[],i)}))},t.prototype.exportVisibleToClipboard=function(t){var e=this.getGridOptionsApi();e.selectAllFiltered(),e.copySelectedRowsToClipboard(!0),e.deselectAll()},t.prototype.exportVisibleToExcel=function(t){this.adaptableOptions.exportOptions.exportToExcelWithStyles&&this.setExcelStylesForExport(),this.gridOptions.api.exportDataAsExcel({sheetName:"Sheet 1",fileName:t.Name}),this.setGridOptionsProperty("excelStyles",(function(t){return t}))},t.prototype.exportVisibleToCsv=function(t){this.gridOptions.api.exportDataAsCsv({fileName:t.Name})},t.prototype.convertAdaptableStyleToCSS=function(t){var e={};return void 0!==t.BackColor&&null!==t.BackColor&&(e.backgroundColor=t.BackColor),void 0!==t.ForeColor&&null!==t.ForeColor&&(e.color=t.ForeColor),void 0!==t.FontWeight&&null!==t.FontWeight&&(e.fontWeight=t.FontWeight.toLocaleLowerCase()),void 0!==t.FontStyle&&null!==t.FontStyle&&(e.fontStyle=t.FontStyle.toLocaleLowerCase()),void 0!==t.FontSize&&null!==t.FontSize&&(e.fontSize=A.EnumExtensions.getCssFontSizeFromFontSizeEnum(t.FontSize)),e},t.prototype.convertCSSToExcelStyle=function(t){var e=function(t){var e=Z(t),i=e.getAlpha();return Z.mix(Z("white"),e,100*i).toHexString()},i={};return i.interior=i.interior||{},i.font=i.font||{},i.alignment=i.alignment||{},null!=t.backgroundColor&&(i.interior.pattern="solid",i.interior.color=e(t.backgroundColor)),null!=t.color&&(i.font.color=e(t.color)),i.alignment.horizontal=t.textAlign?H.toUpperFirst(t.textAlign):"Left","italic"===t.fontStyle&&(i.font.italic=!0),null!=t.fontWeight&&("bold"===t.fontWeight||Number(t.fontWeight)>=600)&&(i.font.bold=!0),i},t}();e.Adaptable=nt;var rt=function(){function t(t,e){var i=this;void 0===e&&(e={});this.adaptableOptions=t,this.init=e.onInit||function(t){var e=t.gridOptions,n=t.adaptableOptions;return o.__awaiter(i,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return n.vendorGrid=e,[4,nt.init(n)];case 1:return[2,t.sent()]}}))}))},this.extraOptions=e,this.render()}return t.prototype.render=function(t){var e,i=this,n=v.DefaultAdaptableOptions.containerOptions.adaptableContainer||"adaptable";if(!t){var r=null===(e=this.adaptableOptions.containerOptions)||void 0===e?void 0:e.adaptableContainer;r&&("string"===typeof r?n=null!==r&&void 0!==r?r:n:t=r)}if(!(t=t||document.getElementById(n)))throw new Error("Cannot find container in which to render Adaptable No Code Wizard");t.classList.add("adaptable--in-wizard"),p.render(u.createElement(B.default,o.__assign(o.__assign({adaptableOptions:this.adaptableOptions},this.extraOptions),{onInit:function(e){t.classList.remove("adaptable--in-wizard"),p.unmountComponentAtNode(t),i.init({adaptableOptions:e,gridOptions:e.vendorGrid})}})),t)},t}();e.AdaptableNoCodeWizard=rt}}]);
(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[7],{ydiI:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AdaptableNoCodeWizard=e.Adaptable=e.waitForCondition=void 0;var i=o("mrSG"),n=o("DR3G"),r=i.__importDefault(o("hbEN")),a=i.__importDefault(o("Muja")),l=i.__importDefault(o("UXvI")),s=i.__importDefault(o("lE2N")),u=i.__importStar(o("q1tI")),p=i.__importStar(o("i8i4")),d=i.__importDefault(o("8QLk")),c=o("EYOP"),f=o("RQz/"),h=o("w5Eo"),m=o("0J2a"),g=i.__importStar(o("fwGq")),C=o("fwGq"),y=i.__importStar(o("+Pxh")),v=o("02Nn"),O=i.__importDefault(o("F9nB")),S=o("zwJd"),A=o("qN6A"),E=i.__importDefault(o("vs66")),b=i.__importDefault(o("U/tm")),w=i.__importDefault(o("1f9d")),N=o("z1Bd"),I=o("pBDx"),F=i.__importStar(o("fkJU")),D=o("adxL"),_=o("KOcV"),G=o("9G3X"),R=o("+0VI"),V=o("bQXN"),x=o("SF8o"),P=o("QEyg"),T=o("hNCx"),L=o("fmQe"),M=o("QIb0"),k=i.__importDefault(o("vk8B")),H=o("n6u+"),U=i.__importDefault(o("OUop")),K=o("yRSI"),B=o("pioK"),z=o("wnz6"),W=o("CUPq"),j=o("YKwl"),Q=o("eoug"),q=o("E/Df"),Y=o("mbJ9"),J=o("Zss7");n.ModuleRegistry.registerModules(n.AllCommunityModules);var X=function(t){t&&(t.field&&!t.colId&&(t.colId=t.field),t.children?t.children.forEach(X):t.colId||I.LogAdaptableWarning("A column is missing the colId - please check ",t,'Either pass a "field" property or a "colId" property.'))};e.waitForCondition=function(t,e){void 0===e&&(e=5e3);var o=Date.now();return t()?Promise.resolve():new Promise((function(i,n){var r=function(i){var a=t();Date.now()-o>e?n("Wait time expired"):a?i():setTimeout((function(){r(i)}),16)};r(i)}))};var Z=n.RowNode.prototype,$=Z.dispatchLocalEvent,tt=n.GridApi.prototype.setColumnDefs,et=function(t,e,o){t.forEach((function(t,i,n){t.children?et(t.children,e,t):e(t,i,n,o)}))},ot={},it=function(){function t(){var t=this;this.colDefPropertyCache=new Map,this.gridOptionsPropertyCache=new Map,this.flashingState=new Map,this._on=function(e,o){return t.emitter?t.emitter.on(e,o):function(){}},this._emit=function(e,o){if(t.emitter)return t.emitter.emit(e,o)},this._emitSync=function(e,o){if(t.emitter)return t.emitter.emitSync(e,o)},this._adaptableReady=!1,this.agGridModules=[],this.isPluginLoaded=function(e){for(var o=t.adaptableOptions.plugins||[],i=0,n=o.length;i<n;i++){if(o[i].pluginId===e)return!0}return!1},this.debouncedSetColumnIntoStore=r.default((function(){t.gridOptions.api&&t.updateColumnsIntoStore()}),C.HALF_SECOND),this.debouncedSaveGridLayout=r.default((function(){t.gridOptions.api&&t.updateLayoutFromGrid()}),C.HALF_SECOND),this.debouncedSetSelectedCells=r.default((function(){t.gridOptions.api&&t.setSelectedCells()}),250),this.debouncedSetSelectedRows=r.default((function(){t.gridOptions.api&&t.setSelectedRows()}),C.HALF_SECOND),this.debouncedFilterGrid=r.default((function(e){void 0===e&&(e=function(){}),t.gridOptions.api&&(t.applyGridFiltering(),e&&e())}),C.HALF_SECOND),this.mapColumnDefs=function(e,o,i){return i=i||{removeEmpty:!1},e=e||t.getGroupAndColumnDefs(),et(e,(function(t,e,n,r){var a=o(t,e,n),l=r?r.children:n;l[e]=a,e===n.length-1&&i.removeEmpty&&r&&(r.children=l.filter((function(t){return!!t})))})),i.removeEmpty&&(e=e.filter((function(t){return!!t}))),e},this.getGroupAndColumnDefs=function(){return[].concat(t.currentColumnDefs||t.gridOptions.columnDefs)},this.getColumnDefsWithCorrectVisibility=function(){var e=t.api.layoutApi.getCurrentVisibleColumnIdsMap();return t.gridOptions.columnApi.getAllColumns().map((function(t){var o=t.getColDef(),i=t.getColId();return o.colId=i,o.hide=!e[i],o}))},this.getPreviousColDefInfo=function(t){return t.__ab||{}}}return t.init=function(e){return t.initInternal(e)},t.initInternal=function(e,o){return i.__awaiter(this,void 0,void 0,(function(){var n,r,a,l,s,u,p,d,c;return i.__generator(this,(function(f){if({renderGrid:void 0,runtimeConfig:null},n=null,Array.isArray(e.plugins)){r=function(t){n=n&&n.then?n.then((function(){return t.beforeInit(e)})):t.beforeInit(e)};try{for(a=i.__values(e.plugins),l=a.next();!l.done;l=a.next())s=l.value,r(s)}catch(h){d={error:h}}finally{try{l&&!l.done&&(c=a.return)&&c.call(a)}finally{if(d)throw d.error}}}return u=function(t){return t.init(e,o,!0).then((function(o){return Array.isArray(e.plugins)&&e.plugins.forEach((function(e){e.afterInit(t)})),o}))},n&&n.then?[2,n.then((function(){var e=new t;return u(e)}))]:(p=new t,[2,u(p)])}))}))},t.collectInstance=function(t){t._id=t.adaptableOptions.adaptableId||h.createUuid(),ot[t._id]=t},t.forEachAdaptable=function(t){Object.keys(ot).forEach((function(e){t(ot[e])}))},t.dismissInstance=function(t){delete ot[t._id]},t.prototype.init=function(e,o,n){var r,a,s,u,d,f,h;return i.__awaiter(this,void 0,void 0,(function(){var m,g=this;return i.__generator(this,(function(y){return n||I.ConsoleLogWarning('\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n!!!!!!! You should not use the "Adaptable" constructor directly, as it was deprecated in v6 and removed in v7!\n!!!!!!!\n!!!!!!! Use const api = await Adaptable.init(adaptableOptions) instead.\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!'),this.emitter=new O.default,this.adaptableOptions=b.default.assignadaptableOptions(e),this.hasAutogeneratedPrimaryKey()&&(I.LogAdaptableInfo("Autogenerated primary key (adaptableOptions.autogeneratedPrimaryKey = TRUE) should be used only as a last resort,\n      when no unique column is available, as it limits some Adaptable functionalities!\n\n      For more details see: https://docs.adaptabletools.com/docs/key-topics/primary-key"),this.adaptableOptions.primaryKey=C.AUTOGENERATED_PK_COLUMN),t.collectInstance(this),b.default.checkAdaptableOptions(this.adaptableOptions),this.runtimeConfig=o||{},this.agGridModules=this.runtimeConfig.modules||[],this.gridOptions=this.adaptableOptions.vendorGrid,void 0===this.gridOptions.allowContextMenuWithControlKey&&(this.gridOptions.allowContextMenuWithControlKey=!0),this.isInitialised=!1,this.useRowNodeLookUp=!1,this.forPlugins((function(t){return t.afterInitOptions(g,g.adaptableOptions)})),this.api=new c.AdaptableApiImpl(this),this.forPlugins((function(t){return t.afterInitApi(g,g.api)})),this.DataService=new _.DataService(this),this.agGridHelper=new B.agGridHelper(this,this.gridOptions),this.agGridMenuHelper=new z.agGridMenuHelper(this,this.gridOptions),this.initStore(),this.ValidationService=new x.ValidationService(this),this.ReportService=new R.ReportService(this),this.ModuleService=new V.ModuleService(this),this.CalculatedColumnExpressionService=new D.CalculatedColumnExpressionService(this),this.EntitlementService=new P.EntitlementService(this),this.ExpressionService=new T.ExpressionService(this),this.AlertService=new L.AlertService(this),this.TeamSharingService=new G.TeamSharingService(this),this.forPlugins((function(t){return t.afterInitServices(g)})),this.modules=this.agGridHelper.setUpModules(),this.forPlugins((function(t){return t.afterInitModules(g,g.modules)})),this.gridOptions.api&&(this.gridOptions.api.__adaptable=this),this.gridOptions.columnTypes=this.gridOptions.columnTypes||{},Object.assign(this.gridOptions.columnTypes,((m={})[C.AB_SPECIAL_COLUMN]={},m.abColDefNumber=null!==(r=this.gridOptions.columnTypes.abColDefNumber)&&void 0!==r?r:{},m.abColDefString=null!==(a=this.gridOptions.columnTypes.abColDefString)&&void 0!==a?a:{},m.abColDefBoolean=null!==(s=this.gridOptions.columnTypes.abColDefBoolean)&&void 0!==s?s:{},m.abColDefDate=null!==(u=this.gridOptions.columnTypes.abColDefDate)&&void 0!==u?u:{},m.abColDefObject=null!==(d=this.gridOptions.columnTypes.abColDefObject)&&void 0!==d?d:{},m.abColDefCustom=null!==(f=this.gridOptions.columnTypes.abColDefCustom)&&void 0!==f?f:{},m.abColDefNumberArray=null!==(h=this.gridOptions.columnTypes.abColDefNumberArray)&&void 0!==h?h:{},m)),void 0===this.gridOptions.columnTypes.abColDefNumber.cellEditor&&(this.gridOptions.columnTypes.abColDefNumber.cellEditor=Y.AdaptableNumberEditor),void 0===this.gridOptions.columnTypes.abColDefDate.cellEditor&&(this.gridOptions.columnTypes.abColDefDate.cellEditor=Y.AdaptableDateEditor),[2,this.initializeAgGrid().then((function(t){if(!t)return I.LogAdaptableError("Unable to set up ag-Grid"),g.api;var e=g;return g.gridOptions.api&&(g.gridOptions.api.__adaptable=g,g.gridOptions.api.setColumnDefs=function(t){e.currentColumnDefs=[].concat(t);var o=tt.apply(this,arguments);return e.setupColumns(),o}),g.adaptableStore.Load.then((function(){g.initInternalGridLogic(),b.default.checkValidPrimaryKey(g)}),(function(t){I.LogAdaptableError("Failed to Init Modules : ",t),g.initInternalGridLogic(),g.api.internalApi.hideLoadingScreen()})).then((function(){return i.__awaiter(g,void 0,void 0,(function(){return i.__generator(this,(function(t){return this.isInitialised=!0,this.api.internalApi.hideLoadingScreen(),[2]}))}))})),null==g.abContainerElement&&(g.abContainerElement=g.getadaptableContainerElement()),null!=g.abContainerElement&&(g.abContainerElement.innerHTML="",p.render(M.AdaptableApp({Adaptable:g}),g.abContainerElement)),g.throttleFilterOnEditDataChange=l.default(g.gridOptions.api.onFilterChanged,g.adaptableOptions.searchOptions.filterActionOnUserDataChange.throttleDelay),g.throttleFilterOnTickingDataChange=l.default(g.gridOptions.api.onFilterChanged,g.adaptableOptions.searchOptions.filterActionOnExternalDataChange.throttleDelay),g.api}))]}))}))},t.prototype.forPlugins=function(t){Array.isArray(this.adaptableOptions.plugins)&&this.adaptableOptions.plugins.forEach((function(e){t(e)}))},t.prototype.getPlugin=function(t){var e=(this.adaptableOptions.plugins||[]).filter((function(e){return e.pluginId===t}))[0];if(!e)throw'Cannot find plugin "'+t+'". Make sure you spelled it right!';return e},t.prototype.getPluginProperty=function(t,e){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];var r=this.adaptableOptions.plugins||[],a=r.filter((function(e){return e.pluginId===t}))[0];if(!a)throw'Cannot find plugin "'+t+'". Make sure you spelled it right!';if(a&&a.hasProperty(e))return a.getProperty(e).apply(void 0,i.__spread(o))},t.prototype.lookupPlugins=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];for(var n=this.adaptableOptions.plugins||[],r=0,a=n.length;r<a;r++){var l=n[r];if(l.hasProperty(t))return l.getProperty(t).apply(void 0,i.__spread(e))}},t.prototype.initStore=function(){var t=this;this.adaptableStore=new m.AdaptableStore(this),this.adaptableStore.onAny((function(e,o){t.performAudit(o.action,o.state,o.newState),t.forPlugins((function(i){return i.onStoreEvent(e,o,t.adaptableStore)})),e==m.INIT_STATE&&(t._adaptableReady=!0,t.modules.forEach((function(t){return t.updateOldConfig()})),t.forPlugins((function(e){return e.onAdaptableReady(t,t.adaptableOptions)})),t.api.eventApi.emit("AdaptableReady",{adaptableApi:t.api,vendorGrid:t.adaptableOptions.vendorGrid}))}))},t.prototype.performAudit=function(t,e,o){var i={actionName:t.type,clientTimestamp:new Date,userName:this.adaptableOptions.userName,adaptableId:this.adaptableOptions.adaptableId,adaptableStateKey:this.adaptableOptions.adaptableStateKey,action:t,oldState:e,newState:o};this.api.eventApi.emit("AdaptableStateChanged",i)},t.prototype.initializeAgGrid=function(){var t,o=this;if(this.useRowNodeLookUp=this.agGridHelper.TrySetUpNodeIds(),Array.isArray(this.gridOptions.columnDefs)&&this.gridOptions.columnDefs.forEach(X),(null===(t=this.adaptableOptions.generalOptions)||void 0===t?void 0:t.hideEmptyGroupRows)&&(this.gridOptions.components=this.gridOptions.components||{},this.gridOptions.autoGroupColumnDef=this.gridOptions.autoGroupColumnDef||{},this.gridOptions.autoGroupColumnDef.cellRenderer||(this.gridOptions.autoGroupColumnDef.cellRenderer="__adaptableGroupCellRenderer",this.gridOptions.components.__adaptableGroupCellRenderer=Q.AdaptableGroupCellRenderer)),this.adaptableOptions.userInterfaceOptions.showAdaptableToolPanel&&this.gridOptions.sideBar){this.gridOptions.sideBar=this.gridOptions.sideBar||{},this.gridOptions.components=this.gridOptions.components||{};var r=this.gridOptions.sideBar;if(!0===r)this.gridOptions.sideBar=this.agGridHelper.createAdaptableSideBarDefs(!0,!0);else if("columns"===r)this.gridOptions.sideBar=this.agGridHelper.createAdaptableSideBarDefs(!1,!0);else if("filters"===r)this.gridOptions.sideBar=this.agGridHelper.createAdaptableSideBarDefs(!0,!1);else{var a=this.gridOptions.sideBar;a&&(a.toolPanels=a.toolPanels||[],a.toolPanels.push(this.agGridHelper.createAdaptableToolPanel()))}this.gridOptions.components.AdaptableToolPanel=H.getAdaptableToolPanelAgGridComponent(this),this.gridOptions.api&&this.gridOptions.api.setSideBar(this.gridOptions.sideBar)}var l,s=function(){var t=o.getGridContainerElement();return!(!t&&!(t=o.initVendorContainerFromInitializedAgGrid()))||(I.LogAdaptableError("You must provide an element id in `containerOptions.vendorContainer`"),!1)};if(this.gridOptions.api&&"function"===typeof this.gridOptions.api.getValue)return s()?Promise.resolve(!0):Promise.resolve(!1);if(this.runtimeConfig.waitForAgGrid)return e.waitForCondition((function(){return!!o.gridOptions.api})).then((function(){return o.initVendorContainerFromInitializedAgGrid(),Promise.resolve(!0)}),(function(){return I.ConsoleLogError("Could not find any agGrid instance rendered."),Promise.reject(!1)}));if(!s())return Promise.resolve(!1);var u=(this.adaptableOptions.vendorGrid||{}).modules||[];this.agGridModules=i.__spread(this.agGridModules,u);var p=this.getGridContainerElement();return this.gridOptions.modules&&delete this.gridOptions.modules,l=new n.Grid(p,this.gridOptions,{modules:u}),this.gridOptions.api&&(this.gridOptions.api.__adaptable=this),Promise.resolve(null!=l)},t.prototype.initVendorContainerFromInitializedAgGrid=function(){if(!this.getGridContainerElement()){var t,e=this.gridOptions.api&&this.gridOptions.api.gridOptionsWrapper&&this.gridOptions.api.gridOptionsWrapper.layoutElements||[];e.length||e.push(this.gridOptions.api.gridBodyCon.eGridBody);for(var o=0,i=e.length;o<i;o++){var n=e[o];if(n&&n.matches(".ag-root-wrapper, .ag-root")){var r=n.closest('[class*="ag-theme"]');if(r){t=r;break}}}return t||I.ConsoleLogError("Could not find the agGrid vendor container. This will probably break some AdapTable functionality."),this.adaptableOptions.containerOptions.vendorContainer=t}},t.prototype.filterOnEditDataChange=function(){this.adaptableOptions.searchOptions.filterActionOnUserDataChange.applyFilter==f.FilterOnDataChangeOptions.Always?this.gridOptions.api.onFilterChanged():this.adaptableOptions.searchOptions.filterActionOnUserDataChange.applyFilter==f.FilterOnDataChangeOptions.Throttle&&this.throttleFilterOnEditDataChange()},t.prototype.filterOnTickingDataChange=function(){this.adaptableOptions.searchOptions.filterActionOnExternalDataChange.applyFilter==f.FilterOnDataChangeOptions.Always?this.gridOptions.api.onFilterChanged():this.adaptableOptions.searchOptions.filterActionOnExternalDataChange.applyFilter==f.FilterOnDataChangeOptions.Throttle&&this.throttleFilterOnTickingDataChange()},t.prototype.applyGridFiltering=function(){this.api.filterApi.isQuickFilterAvailable()&&(this.api.filterApi.isQuickFilterVisible()?this.showQuickFilter():this.hideQuickFilter()),this.gridOptions.api.onFilterChanged(),this._emit("GridFiltered"),this.setSelectedCells(),this.setSelectedRows()},t.prototype.isGroupRowNode=function(t){return!!t&&(!!t.isEmptyRowGroupNode()||(!(!t.group||!0!==t.group)||!(!t.leafGroup||!0!==t.leafGroup)))},t.prototype.isVisibleNode=function(t){return null!=this.gridOptions.api.getRenderedNodes().find((function(e){return e.id==t.id}))},t.prototype.isPinnedRowNode=function(t){return!!t&&!!t.isRowPinned()},t.prototype.clearGridFiltering=function(){this.gridOptions.columnApi.getAllColumns().forEach((function(t){t.setFilterActive(!1)}))},t.prototype.clearColumnFiltering=function(t){var e=this;t.forEach((function(t){var o=e.gridOptions.columnApi.getAllColumns().find((function(e){return e.getColId()==t}));o&&o.setFilterActive(!1)}))},t.prototype.hideFilterForm=function(){this.hideFilterFormPopup&&this.hideFilterFormPopup()},t.prototype.updateColumnsIntoStore=function(){var t=this,e=[],o=this.gridOptions.columnApi.getAllColumns(),i=this.gridOptions.columnApi.getAllDisplayedColumnGroups(),n={},r=i.reduce((function(t,e){var o,i,r;if(!(null===(i=null===(o=e.getOriginalColumnGroup)||void 0===o?void 0:o.call(e))||void 0===i?void 0:i.getColGroupDef()))return t;var a=e.getGroupId(),l=!e.getOriginalColumnGroup().getColGroupDef().marryChildren,s=null!==(r=e.getOriginalColumnGroup().getColGroupDef().headerName)&&void 0!==r?r:a,u=e.getLeafColumns();return u.forEach((function(e){var o={ColumnGroupId:a,FriendlyName:s,AllowGroupSplit:l,GroupCount:0};n[o.ColumnGroupId]=n[o.ColumnGroupId]||0,n[o.ColumnGroupId]+=u.length,t[e.getColId()]=o})),t}),{});Object.keys(r).forEach((function(t){r[t].GroupCount=n[r[t].ColumnGroupId]})),o.forEach((function(o){var i=o.getColId();t.api.columnApi.isRowGroupColumn(i)||e.push(t.createAdaptableColumn(o,r))})),this.api.internalApi.setColumns(e)},t.prototype.createAdaptableColumn=function(t,e){return this.agGridHelper.createAdaptableColumnFromVendorColumn(t,e)},t.prototype.safeSetColDefs=function(t){t=this.mapColumnDefs(t,(function(t){return t.field&&null==t.colId&&(t.colId=t.field),t})),this.gridOptions.api.setColumnDefs(t),this.updateColumnsIntoStore()},t.prototype.getFormatColumnCellStyle=function(t,e){if(t.IncludeGroupedRows||!this.isGroupRowNode(e.node)){var o={},i=t.ColumnStyle;if(i){var n=null===i||void 0===i?void 0:i.GradientStyle;if(n){var r=this.api.formatColumnApi.getNumericStyleMinValue(i,e.node,e.value),a=this.api.formatColumnApi.getNumericStyleMaxValue(i,e.node,e.value),l=d.default(e.value,r,a),s=void 0,u=!1;if(n.ColumnComparison)s=n.ColumnComparison.Color;else{var p=n.CellRanges.find((function(t){return t.Min<=l&&t.Max>=l}));p&&(s=p.Color,u=p.ReverseGradient)}var c=Math.abs(a-r),f=(e.value-r)/c*100,h=Number((f/100).toPrecision(2));u&&(h=1-h),o.backgroundColor=J(s).setAlpha(h).toRgbString()}}else t.Style&&(o=this.convertAdaptableStyleToCSS(t.Style));if(t.CellAlignment)switch(t.CellAlignment){case"Left":o.textAlign="left";break;case"Right":o.textAlign="right";break;case"Center":o.textAlign="center"}return o}},t.prototype.getAlertCellStyle=function(t,e){var o=this.api.internalApi.getAdaptableAlerts().filter((function(o){var i;return(null===(i=o.alertDefinition.AlertProperties)||void 0===i?void 0:i.HighlightCell)&&o.dataChangedInfo&&o.dataChangedInfo.columnId===t.ColumnId&&o.dataChangedInfo.rowNode===e.node}))[0];if(o)return{backgroundColor:U.default.getColorByMessageType(o.alertDefinition.MessageType)}},t.prototype.getFlashingAlertRowStyle=function(t){var e=this.getPrimaryKeyValueFromRowNode(t.node);return this.getFlashingAlertStyleFor(e)},t.prototype.getFlashingAlertStyleFor=function(t,e){var o,i=this.api.internalApi.getAdaptableFlashingAlertFor(t,e);return i?this.convertAdaptableStyleToCSS(null!==(o="up"===i.direction?i.flashingAlertDefinition.UpChangeStyle:"down"===i.direction?i.flashingAlertDefinition.DownChangeStyle:i.flashingAlertDefinition.NeutralChangeStyle)&&void 0!==o?o:{}):{}},t.prototype.getFlashingAlertCellStyle=function(t,e){var o=this.getPrimaryKeyValueFromRowNode(e.node);return this.getFlashingAlertStyleFor(o,t.ColumnId)},t.prototype.getCellHighlightStyle=function(t,e){var o,i=this.getPrimaryKeyValueFromRowNode(e.node),n=this.api.internalApi.getSystemState().HighlightedCells.find((function(e){return t.ColumnId===e.columnId&&e.primaryKeyValue===i}));if(n)switch(null!==(o=n.highlightType)&&void 0!==o?o:"Info"){case"Error":return{backgroundColor:"var(--ab-color-error)"};case"Info":return{backgroundColor:"var(--ab-color-info)"};case"Success":return{backgroundColor:"var(--ab-color-success)"};case"Warning":return{backgroundColor:"var(--ab-color-warn)"}}},t.prototype.getQuickSearchCellStyle=function(){var t=this.api.quickSearchApi.getQuickSearchStyle();if(t&&!A.StringExtensions.IsNotNullOrEmpty(t.ClassName))return this.convertAdaptableStyleToCSS(t)},t.prototype.getEditableCellStyle=function(t,e){var o=this.api.userInterfaceApi.getEditableCellStyle();if(o){var i=this.getGridCellFromRowNode(e.node,t.ColumnId);return i&&this.api.gridApi.areCellsEditable([i])?this.convertAdaptableStyleToCSS(o):void 0}},t.prototype.getReadOnlyCellStyle=function(t,e){var o=this.api.userInterfaceApi.getReadOnlyCellStyle();if(o){var i=this.getGridCellFromRowNode(e.node,t.ColumnId);return i&&!this.api.gridApi.areCellsEditable([i])?this.convertAdaptableStyleToCSS(o):void 0}},t.prototype.getConditionalStyleCellStyle=function(t,e,o){void 0===t&&(t=[]);var n=this.ModuleService.getModuleById(y.ConditionalStyleModuleId),r=t.reduce((function(t,r){return n.isConditionalStyleActiveForColumn(r,e,o)?i.__assign(i.__assign({},t),r.Style):t}),{});return this.convertAdaptableStyleToCSS(r)},t.prototype.getConditionalStyleCellClass=function(t,e,o){void 0===t&&(t=[]);var i=this.ModuleService.getModuleById(y.ConditionalStyleModuleId);return t.map((function(t){var n,r;if((null===(n=t.Style)||void 0===n?void 0:n.ClassName)&&i.isConditionalStyleActiveForColumn(t,e,o))return null===(r=t.Style)||void 0===r?void 0:r.ClassName})).filter((function(t){return!!t})).join(" ")},t.prototype.isQuickSearchActive=function(t,e){if(t.IsExcludedFromQuickSearch)return!1;if(!e.node||e.node.group)return!1;var o=this.api.quickSearchApi.getQuickSearchValue();if(A.StringExtensions.IsNullOrEmpty(o))return!1;var i=F.default.CreateColumnFilter(t.ColumnId,"Contains",[o]);return this.api.filterApi.evaluateColumnFilter(i,e.node)},t.prototype.getPrimaryKeyValueFromRowNode=function(t){var e,o,i=this.getGridOptionsApi();return i&&!this.hasAutogeneratedPrimaryKey()&&(o=i.getValue(this.adaptableOptions.primaryKey,t)),(null===o||void 0==o)&&t&&t.data&&(o=null!==(e=t.data[this.adaptableOptions.primaryKey])&&void 0!==e?e:null),o},t.prototype.getSortedColumnStateForVisibleColumns=function(t,e){var o=this;e=e||this.gridOptions.columnApi.getColumnState();var n=t.reduce((function(t,e,o){return t[e]=o,t}),{}),r=e.reduce((function(t,e,o){return t[e.colId]=o,t}),{}),a=t.reduce((function(t,e,o){return t[e]=o,t}),{});return i.__spread(e).sort((function(t,e){var i=t.colId,n=e.colId,l=r[i],s=r[n],u=o.api.columnApi.isRowGroupColumn(i),p=o.api.columnApi.isRowGroupColumn(n);return u&&p?1:u?-1:p?1:null!=a[i]&&null==a[n]?-1:null==a[i]&&null!=a[n]?1:null==a[i]&&null==a[n]?l-s:a[t.colId]-a[e.colId]})).map((function(t){return i.__assign(i.__assign({},t),{hide:null==n[t.colId]})}))},t.prototype.setColumnOrder=function(t){var e=this.getSortedColumnStateForVisibleColumns(t);this.gridOptions.columnApi.setColumnState(e),this.updateColumnsIntoStore()},t.prototype.persistLayout=function(t){this.api.layoutApi.shouldAutoSaveLayout(t)?this.api.layoutApi.saveLayout(t):this.api.internalApi.updateCurrentDraftLayout(t)},t.prototype.setLayout=function(t){var e,o,n,r,l,s,u=this;t||(t=this.api.layoutApi.getCurrentLayout()),t.Columns=t.Columns||[];var p=t.Columns.reduce((function(t,e){return t[e]=!0,t}),{}),d=this.gridOptions.columnApi.getColumnState(),c={},f=d.reduce((function(t,e,o){return c[e.colId]=o,t[e.colId]=e,t}),{}),h=0,m=(null!==(e=t.ColumnSorts)&&void 0!==e?e:[]).reduce((function(t,e){var o=e.ColumnId;return p[o]?(t[o]={colId:o,sort:"Asc"===e.SortOrder?"asc":"desc",sortIndex:h},h++,t):t}),{}),g=(t.RowGroupedColumns||[]).reduce((function(t,e,o){return t[e]=o,t}),{}),C={},y=t.AggregationColumns||{},v=i.__spread(t.PivotColumns||[],Object.keys(t.AggregationColumns||{})),O=t.EnablePivot?v||[]:t.Columns;v.length&&t.RowGroupedColumns&&v.push.apply(v,i.__spread(t.RowGroupedColumns));var A=!1,E={},b=this.getSortedColumnStateForVisibleColumns(O,d);if(b=b.map((function(e){var o,n,r,l,s=e.colId,d=f[s],c=!p[s],h=i.__assign(i.__assign({},d),{hide:c});t.ColumnWidthMap&&null!=t.ColumnWidthMap[s]?h.width=t.ColumnWidthMap[s]:E[s]=!0,h.rowGroupIndex=null!=g[s]?g[s]:null,h.rowGroup=null!=h.rowGroupIndex;var v=!!t.PinnedColumnsMap&&t.PinnedColumnsMap[s];if(v&&(h.pinned=v),h.pivotIndex=null,null!=C[s]&&(h.pivotIndex=C[s]),h.aggFunc=null,null!=y[s]){var O=null===(n=null===(o=u.gridOptions)||void 0===o?void 0:o.api)||void 0===n?void 0:n.getColumnDef(s);h.aggFunc=!0===y[s]?null!==(l=null!==(r=e.aggFunc)&&void 0!==r?r:null===O||void 0===O?void 0:O.aggFunc)&&void 0!==l?l:"sum":y[s]}return m[s]?(h.sort=m[s].sort,h.sortIndex=m[s].sortIndex):(h.sort=null,h.sortIndex=null),A=A||!a.default(h,d),h})).filter((function(t){return!!t})),!A){var w=function(t){return t.colId+"-"+t.rowGroupIndex+"-"+t.pivotIndex+"-"+t.aggFunc+"-"+t.pinned+"-"+t.width+"-"+t.hide},N=d.map(w).join(","),I=b.map(w).join(",");A=I!=N}var F=!!t.EnablePivot,D=this.gridOptions.columnApi.isPivotMode()!==F;A=A||D,S.ArrayExtensions.IsNotNullOrEmpty(t.ExpandedRowGroupValues)&&this.adaptableOptions.layoutOptions.includeExpandedRowGroups&&this.expandRowGroupsForValues(t.ExpandedRowGroupValues),A&&(D&&this.gridOptions.columnApi.setPivotMode(F),this.gridOptions.columnApi.setColumnState(b),this.api.gridApi.setColumnSorts(t.ColumnSorts),this.gridOptions.columnApi.setPivotColumns(t.PivotColumns||[]),tt.call(this.gridOptions.api,this.gridOptions.api.getColumnDefs()));var _=Object.keys(E);if(F&&(null===(n=null===(o=this.adaptableOptions)||void 0===o?void 0:o.layoutOptions)||void 0===n?void 0:n.autoSizeColumnsInPivotLayout))return requestAnimationFrame((function(){u.gridOptions.columnApi.autoSizeAllColumns()})),void setTimeout((function(){var t;null===(t=u.gridOptions.columnApi)||void 0===t||t.autoSizeAllColumns(),setTimeout((function(){var t;null===(t=u.gridOptions.columnApi)||void 0===t||t.autoSizeAllColumns()}),200)}),100);(null===(l=null===(r=this.adaptableOptions)||void 0===r?void 0:r.layoutOptions)||void 0===l?void 0:l.autoSizeColumnsInLayout)&&_.length&&(null===(s=this.gridOptions.columnApi)||void 0===s||s.autoSizeColumns(_)),this.forPlugins((function(e){e.afterSetLayout&&e.afterSetLayout(u,t)}))},t.prototype.updateLayoutFromGrid=function(){var t=this.api.layoutApi.getCurrentLayout(),e=i.__assign({},t),o=[],n={},r={},a=[],l=this.gridOptions.columnApi.getColumnState(),s=i.__spread(new Array(l.length)),u=i.__spread(new Array(l.length)),p=[],d={},c=l.reduce((function(t,e){var i=e.colId;return e.sort&&null!=e.sortIndex&&a.push({ColumnId:i,SortOrder:"asc"===e.sort?"Asc":"Desc",SortIndex:e.sortIndex}),null!=e.width&&(t[i]=e.width),null!=e.flex&&(n[i]=e.flex),"left"===e.pinned&&(r[i]="left"),"right"===e.pinned&&(r[i]="right"),e.hide||o.push(i),null!=e.rowGroupIndex&&(s[e.rowGroupIndex]=i),null!=e.pivotIndex&&(u[e.pivotIndex]=i),e.aggFunc&&"string"===typeof e.aggFunc&&(d[i]=e.aggFunc),t}),{});a.sort((function(t,e){return t.SortIndex-e.SortIndex})),this.gridOptions.columnApi.getPivotColumns().forEach((function(t){p.push(t.getColId())})),s=s.filter((function(t){return!!t})),u=u.filter((function(t){return!!t})),e.ColumnWidthMap=c,e.PinnedColumnsMap=r,e.Columns=o,e.ColumnSorts=a,e.RowGroupedColumns=s,Object.keys(d).length&&(e.AggregationColumns=d),e.EnablePivot=this.gridOptions.columnApi.isPivotMode(),e.PivotColumns=p,this.adaptableOptions.layoutOptions.includeExpandedRowGroups&&(e.ExpandedRowGroupValues=this.getExpandRowGroupsKeys()),this.persistLayout(e)},t.prototype.setSelectedCells=function(){var t=this;if(this.isGridSelectable()){var e=this.gridOptions.api.getCellRanges(),o=[],n=[];if(!this.api.internalApi.isGridInPivotMode()){e&&e.forEach((function(e){var r,a,l=!0;if(e.startRow&&e.endRow){var s=null!=e.startRow.rowPinned,u=null!=e.endRow.rowPinned;if(s&&(u&&(l=!1),I.ConsoleLogWarning("Cannot select pinned rows in ag-Grid.")),l){var p=Math.min(e.startRow.rowIndex,e.endRow.rowIndex),d=Math.max(e.startRow.rowIndex,e.endRow.rowIndex),c=function(e){if(null!=e){var i=e.getColId(),r=t.api.columnApi.getColumnFromId(i);r&&null==o.find((function(t){return t.ColumnId==r.ColumnId}))&&o.push(r);for(var a=p;a<=d;a++){var l=t.gridOptions.api.getModel().getRow(a);if(l&&!t.isPinnedRowNode(l)){var s=t.getGridCellFromRowNode(l,i);n.push(s)}}}};try{for(var f=i.__values(e.columns),h=f.next();!h.done;h=f.next()){c(h.value)}}catch(m){r={error:m}}finally{try{h&&!h.done&&(a=f.return)&&a.call(f)}finally{if(r)throw r.error}}}}}));var r={columns:o,gridCells:n};return this.api.internalApi.setSelectedCells(r),this._emit("CellsSelected"),this.agGridHelper.fireSelectionChangedEvent(),r}}},t.prototype.setSelectedRows=function(){var t=this;if(this.isGridSelectable()){var e=this.gridOptions.api.getSelectedNodes(),o=[];if(!this.gridOptions.columnApi.isPivotMode()){S.ArrayExtensions.IsNotNullOrEmpty(e)&&e.forEach((function(e){var i={isMaster:!(null==e.master||1!=e.master),isExpanded:!(null==e.expanded||1!=e.expanded),isGroup:!(null==e.group||1!=e.group),level:e.level},n={primaryKeyValue:t.getPrimaryKeyValueFromRowNode(e),rowData:e.data,rowNode:e,rowInfo:i};o.push(n)}));var i={GridRows:o};return this.api.internalApi.setSelectedRows(i),this.agGridHelper.fireSelectionChangedEvent(),i}}},t.prototype.setValue=function(t){var e,o=this,i=this.api.columnApi.getColumnDataTypeFromColumnId(t.columnId);if(e=i==f.DataType.Number?Number(t.newValue):t.newValue,void 0!=i)if(t.rowNode)t.rowNode.setDataValue(t.columnId,e);else if(this.useRowNodeLookUp){var n=this.gridOptions.api.getRowNode(t.primaryKeyValue);null!=n&&(n.setDataValue(t.columnId,e),t.rowNode=n)}else{var r=!1;this.gridOptions.api.getModel().forEachNode((function(i){r||t.primaryKeyValue==o.getPrimaryKeyValueFromRowNode(i)&&(i.setDataValue(t.columnId,e),t.rowNode=i,r=!0)}))}},t.prototype.cancelEdit=function(){this.gridOptions.api.stopEditing(!0)},t.prototype.getDistinctValuesForColumn=function(t,e,o){var i=this,n=[],r=this.api.userInterfaceApi.getPermittedValuesForColumn(t);return S.ArrayExtensions.IsNotNull(r)?n=r.map((function(e){return{rawValue:e,displayValue:e,normalisedValue:e,columnId:t.ColumnId,rowNode:void 0}})):e?this.gridOptions.api.forEachNodeAfterFilter((function(e){var r=i.addDistinctColumnValue(e,t.ColumnId);r&&void 0!=r.rawValue&&r.rowNode!==o&&n.push(r)})):this.gridOptions.api.forEachNode((function(e){var r=i.addDistinctColumnValue(e,t.ColumnId);r&&void 0!=r.rawValue&&r.rowNode!==o&&n.push(r)})),s.default(n,"displayValue").slice(0,this.adaptableOptions.searchOptions.maxColumnValueItemsDisplayed)},t.prototype.getColumnValueDisplayValuePairList=function(t,e,o){var i=this,n=[],r=new Map,a=this.api.columnApi.getColumnFromId(t),l=this.api.userInterfaceApi.getPermittedValuesForColumn(a);S.ArrayExtensions.IsNotNullOrEmpty(l)?l.forEach((function(e){r.set(e,{rawValue:e,displayValue:e,normalisedValue:e,columnId:t,rowNode:void 0})})):r=null;this.shouldUseRawValueForColumn(a);var s=function(t,e,a){if(t&&!i.isGroupRowNode(t)){var l=i.getGridCellFromRowNode(t,e),s=!r||r.has(l.displayValue);if(s&&o){var u=i.getPrimaryKeyValueFromRowNode(t);s=!!o[u]}s&&n.push(l)}};return e?this.gridOptions.api.forEachNodeAfterFilter((function(e){s(e,t)})):this.gridOptions.api.forEachNode((function(e){s(e,t)})),n.slice(0,this.adaptableOptions.searchOptions.maxColumnValueItemsDisplayed)},t.prototype.addDistinctColumnValue=function(t,e){if(t&&!this.isGroupRowNode(t)){var o=this.getGridCellFromRowNode(t,e);return N.Helper.objectExists(o)?o:void 0}},t.prototype.shouldUseRawValueForColumn=function(t){var e=this.gridOptions.api.getColumnDef(t.ColumnId);return!(!e||null==e.cellRenderer)||!!this.api.columnApi.isFormatNumericStyleColumn(t)},t.prototype.getDisplayValue=function(t,e){var o,i=this;if(this.useRowNodeLookUp){var n=this.gridOptions.api.getRowNode(t),r=this.getGridCellFromRowNode(n,e);r&&(o=r.displayValue)}else{var a=!1;this.gridOptions.api.getModel().forEachNode((function(n){if(!a){var r=i.getGridCellFromRowNode(n,e);r&&t==r.primaryKeyValue&&(o=r.displayValue),a=!0}}))}return o},t.prototype.getGridCellFromRowNode=function(t,e){if(null!=t){var o=this.getPrimaryKeyValueFromRowNode(t),i=this.getRawValueFromRowNode(t,e),n=this.getDisplayValueFromRawValue(e,i),r=this.getNormalisedValueFromRowValue(i,e);this.api.columnApi.getColumnFromId(e);return{rawValue:i,displayValue:n,normalisedValue:r,columnId:e,primaryKeyValue:o,rowNode:t}}},t.prototype.getDisplayValueFromRowNode=function(t,e){var o=this.getGridCellFromRowNode(t,e);return o?o.displayValue:void 0},t.prototype.getFormattedValueFromRowNode=function(t,e){if(null!=t){var o=this.getRawValueFromRowNode(t,e);return this.getFormattedValueFromRawValue(e,o)}},t.prototype.getDisplayValueFromRawValue=function(t,e,o){void 0===o&&(o=!1);var i=this.api.columnApi.getColumnFromId(t);if(this.api.columnApi.isFormatNumericStyleColumn(i)){var n=this.gridOptions.api.getColumnDef(t);return"function"==typeof n.valueFormatter?this.getFormattedValue(e,t,n,n.valueFormatter):this.agGridHelper.getCleanValue(e)}if(this.api.columnApi.isActionColumn(t))return this.agGridHelper.getCleanValue(e);var r=this.gridOptions.api.getColumnDef(t);if(r){if("function"==typeof r.valueFormatter){var a=this.getFormattedValue(e,t,r,r.valueFormatter);return r.cellRenderer&&!o?this.agGridHelper.getRenderedValue(r,a):a||""}if(r.cellRenderer&&!o)return this.agGridHelper.getRenderedValue(r,e)}return this.agGridHelper.getCleanValue(e)},t.prototype.getFormattedValue=function(t,e,o,i){return i({value:t,node:null,data:null,colDef:o,column:this.gridOptions.columnApi.getAllColumns().find((function(t){return t.getColId()==e})),api:this.gridOptions.api,columnApi:this.gridOptions.columnApi,context:this.gridOptions.context})},t.prototype.getFormattedValueFromRawValue=function(t,e){return this.getDisplayValueFromRawValue(t,e,!0)},t.prototype.getNormalisedValueFromRowValue=function(t,e){if(void 0===t||null===t)return t;var o=this.api.columnApi.getColumnDataTypeFromColumnId(e);return"String"===o?"string"!==typeof t?String(t):t:"Number"===o?"number"!==typeof t?Number(t):t:"Boolean"===o?"boolean"!==typeof t?Boolean(t):t:"Date"===o?t instanceof Date?t:new Date(t):t},t.prototype.getRawValueFromRowNode=function(t,e){return this.gridOptions.api.getValue(e,t)},t.prototype.getDataRowFromRowNode=function(t){return null!=t&&void 0!=t?t.data:void 0},t.prototype.getRowNodeForPrimaryKey=function(t){var e=this;if(this.useRowNodeLookUp)return this.gridOptions.api.getRowNode(t);this.gridOptions.api.getModel().forEachNode((function(o){if(t==e.getPrimaryKeyValueFromRowNode(o))return o}))},t.prototype.getRowNodesForPrimaryKeys=function(t){var e=this,o=[];return this.useRowNodeLookUp?t.forEach((function(t){var i=e.gridOptions.api.getRowNode(t);i&&o.push(i)})):t.forEach((function(t){var i=!1;e.gridOptions.api.getModel().forEachNode((function(n){i||t!=e.getPrimaryKeyValueFromRowNode(n)||(o.push(n),i=!0)}))})),o},t.prototype.forAllRowNodesDo=function(t){this.gridOptions.api.getModel().forEachNode((function(e){t(e)}))},t.prototype.forAllVisibleRowNodesDo=function(t){this.gridOptions.api.forEachNodeAfterFilterAndSort((function(e,o){t(e,o)}))},t.prototype.selectNodes=function(t){var e=this;S.ArrayExtensions.IsNotNullOrEmpty(t)&&t.forEach((function(t){return e.selectNode(t)}))},t.prototype.selectNode=function(t){t?t.setSelected(!0,!0):I.LogAdaptableError("No node to select")},t.prototype.selectCells=function(t,e,o){var i={rowStartIndex:e.rowIndex,rowEndIndex:o.rowIndex,columns:t};this.gridOptions.api.addCellRange(i)},t.prototype.isRowNodeVisible=function(t){var e=!1;return this.gridOptions.api.forEachNodeAfterFilter((function(o){o==t&&(e=!0)})),e},t.prototype.redrawBody=function(){this.gridOptions.api.redrawRows(),this._emit("GridRefreshed")},t.prototype.redrawHeader=function(){this.gridOptions.api.refreshHeader()},t.prototype.redrawRow=function(t){var e={rowNodes:[t]};try{this.gridOptions.api.redrawRows(e)}catch(o){I.LogAdaptableError("ag-grid redrawRows was unable to find some row nodes. Tried to redraw row node: ",t,o),console.error(o)}},t.prototype.refreshCells=function(t,e,o){var i={rowNodes:t,columns:e,force:o};this.gridOptions.api.refreshCells(i)},t.prototype.jumpToRow=function(t){this.gridOptions.api.ensureNodeVisible(t,"middle")},t.prototype.jumpToColumn=function(t){this.gridOptions.api.ensureColumnVisible(t)},t.prototype.jumpToCell=function(t,e){this.jumpToRow(e),this.jumpToColumn(t)},t.prototype.getColDefsForSpecialColumns=function(){return i.__spread(this.getColDefsForCalculatedColumns(),this.getColDefsForActionColumns(),this.getColDefsForFreeTextColumns())},t.prototype.getColDefsForFreeTextColumns=function(){var t=this,e=this.api.internalApi.getAdaptableOptions().searchOptions.enableFilterOnSpecialColumns;return this.api.freeTextColumnApi.getAllFreeTextColumn().map((function(o){var i="Number"===o.DataType?Y.AdaptableNumberEditor:"Date"===o.DataType?Y.AdaptableDateEditor:null;return{headerName:o.FriendlyName||o.ColumnId,colId:o.ColumnId,editable:!0,hide:!0,filter:e,sortable:!0,resizable:!0,enableRowGroup:!0,cellEditor:null!==i&&void 0!==i?i:o.TextEditor&&"Large"==o.TextEditor?"agLargeTextCellEditor":"agTextCellEditor",type:[C.AB_SPECIAL_COLUMN,t.agGridHelper.getAgGridDataType(o.DataType)],valueSetter:function(t){return t.data[o.ColumnId]=t.newValue},cellRenderer:o.DataType&&"Boolean"==o.DataType?t.agGridHelper.createCheckboxRendererComp(o.ColumnId,!1):void 0,valueGetter:function(e){return t.api.freeTextColumnApi.getFreeTextColumnValueFromRowNode(o,e.node)}}}))},t.prototype.setupColumnValueGetter=function(t){var e=t.col;this.setColDefProperty(e,"valueGetter",(function(t){return t}))},t.prototype.setupColumnAggFunc=function(t){var e=t.col;this.setColDefProperty(e,"aggFunc",(function(t){return t}))},t.prototype.getColDefsForActionColumns=function(){return this.api.userInterfaceApi.getAllActionColumn().map((function(t){return{headerName:t.friendlyName?t.friendlyName:t.columnId,colId:t.columnId,editable:!1,hide:!1,filter:!1,sortable:!1,resizable:!0,cellRenderer:K.ActionColumnRenderer,type:[C.AB_SPECIAL_COLUMN,"abColDefObject"]}}))},t.prototype.updateColDefsForSpecialColumns=function(){var t=this.getColDefsForSpecialColumns(),e=this.getGroupAndColumnDefs().filter((function(t){var e=t.type;return!(e===C.AB_SPECIAL_COLUMN||Array.isArray(e)&&e.includes(C.AB_SPECIAL_COLUMN))})),o=i.__spread(e,t);this.safeSetColDefs(o),this.setLayout()},t.prototype.getColDefsForCalculatedColumns=function(){var t=this;return this.api.calculatedColumnApi.getAllCalculatedColumn().map((function(e){var o;if(!e.CalculatedColumnSettings){var i=!t.adaptableOptions.searchOptions.enableFilterOnSpecialColumns||t.adaptableOptions.searchOptions.enableFilterOnSpecialColumns;e.CalculatedColumnSettings=F.CreateEmptyCalculatedColumn(i).CalculatedColumnSettings}e.CalculatedColumnSettings.DataType||(e.CalculatedColumnSettings.DataType=t.CalculatedColumnExpressionService.GetCalculatedColumnDataType(null===(o=e.Query)||void 0===o?void 0:o.ScalarExpression));var n={headerName:e.FriendlyName?e.FriendlyName:e.ColumnId,colId:e.ColumnId,hide:!0,editable:!1,width:e.CalculatedColumnSettings.Width,enableValue:e.CalculatedColumnSettings.Aggregatable,filter:e.CalculatedColumnSettings.Filterable,floatingFilter:e.CalculatedColumnSettings.Filterable,resizable:e.CalculatedColumnSettings.Resizable,enableRowGroup:e.CalculatedColumnSettings.Groupable,sortable:e.CalculatedColumnSettings.Sortable,enablePivot:e.CalculatedColumnSettings.Pivotable,type:[C.AB_SPECIAL_COLUMN,t.agGridHelper.getAgGridDataType(e.CalculatedColumnSettings.DataType)],valueGetter:function(o){var i;return t.CalculatedColumnExpressionService.ComputeExpressionValue(null===(i=e.Query)||void 0===i?void 0:i.ScalarExpression,o.node)}};return null!=e.CalculatedColumnSettings.ShowToolTip&&1==e.CalculatedColumnSettings.ShowToolTip&&(n.tooltipValueGetter=function(){var t;return null===(t=e.Query)||void 0===t?void 0:t.ScalarExpression}),n}))},t.prototype.isRegularColDef=function(t){return void 0===t.children},t.prototype.isGroupColDef=function(t){return void 0!==t.children},t.prototype.getColDefs=function(){var t=this,e=this.getGroupAndColumnDefs(),o=[];return e.forEach((function(e){t.isRegularColDef(e)&&o.push(e)})),o},t.prototype.getGroupedColDefs=function(){var t=this,e=this.getGroupAndColumnDefs(),o=[];return e.forEach((function(e){t.isGroupColDef(e)&&o.push(e)})),o},t.prototype.getFirstRowNode=function(){var t;return this.gridOptions.api.forEachNode((function(e){e.group||(t=e)})),t},t.prototype.destroy=function(e){var o,i,n,r,a,l;this.gridOptions&&this.gridOptions.api&&(this.gridOptions.api.__adaptable=null,this.gridOptions.api.setColumnDefs=tt,this.gridOptions.getRowStyle=null,e&&!1===e.destroyApi||this.gridOptions.api.destroy()),this.colDefPropertyCache=null,this.gridOptionsPropertyCache=null,this.currentColumnDefs=null,this.rowListeners=null,this.emitter.clearListeners(),this.emitter=null,this._adaptableReady=!1,t.dismissInstance(this);var s=this.getadaptableContainerElement();e&&!e.unmount||(null!=s&&p.unmountComponentAtNode(s),null===(o=this.CalculatedColumnExpressionService)||void 0===o||o.desstroy(),null===(i=this.DataService)||void 0===i||i.desstroy(),null===(n=this.EntitlementService)||void 0===n||n.desstroy(),null===(r=this.ReportService)||void 0===r||r.desstroy(),null===(a=this.ModuleService)||void 0===a||a.desstroy(),null===(l=this.ValidationService)||void 0===l||l.desstroy())},t.prototype.getDefaultIPPStyle=function(){return{Header:{headerColor:"#000000",headerBackColor:"#f5f7f7",headerFontFamily:"sans-serif",headerFontSize:"12px",headerFontStyle:"normal",headerFontWeight:"400",height:65,Columns:this.api.columnApi.getColumns().map((function(t){return{columnFriendlyName:t.FriendlyName,width:200,textAlign:"start"}}))},Row:{color:"#000000",backColor:"#ffffff",altBackColor:"#fcfdfe",fontFamily:"sans-serif",fontSize:"12px",fontStyle:"normal",fontWeight:"400",height:30,Columns:this.api.columnApi.getColumns().map((function(t){return{columnFriendlyName:t.FriendlyName,width:200,textAlign:"start"}}))}}},t.prototype.getCurrentIPPStyle=function(){return this.agGridHelper.getCurrentIPPStyle()},t.prototype.getadaptableContainerElement=function(){if(!this.abContainerElement){var t=this.adaptableOptions.containerOptions.adaptableContainer;if(this.abContainerElement="string"===typeof t?document.getElementById(t):t,!this.abContainerElement){var e=document.getElementById("adaptableBlotter");e&&(I.LogAdaptableWarning('\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n!!!!! The old default container element for Adaptable was "#adaptableBlotter", configured via \'containerOptions.adaptableContainer="adaptableBlotter"\'.\n!!!!! Seems like you haven\'t updated your html container selector, so we\'re falling back to using that one.\n!!!!!\n!!!!! To make this warning go away, update your html structure and make sure you have an element with id="adaptable" in your app!\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n'),this.abContainerElement=e)}}return this.abContainerElement},t.prototype.getGridContainerElement=function(){return this.gridContainerElement||(this.gridContainerElement="string"===typeof this.adaptableOptions.containerOptions.vendorContainer?document.getElementById(this.adaptableOptions.containerOptions.vendorContainer):this.adaptableOptions.containerOptions.vendorContainer),this.gridContainerElement},t.prototype.initInternalGridLogic=function(){var e=this;if(null==this.abContainerElement&&(this.abContainerElement=this.getadaptableContainerElement()),null!=this.abContainerElement){var o=this.getGridContainerElement();o&&o.addEventListener("keydown",(function(t){return e._emit("KeyDown",t)}));var r=[n.Events.EVENT_COLUMN_MOVED,n.Events.EVENT_GRID_COLUMNS_CHANGED,n.Events.EVENT_COLUMN_EVERYTHING_CHANGED,n.Events.EVENT_DISPLAYED_COLUMNS_CHANGED,n.Events.EVENT_COLUMN_VISIBLE,n.Events.EVENT_NEW_COLUMNS_LOADED];this.gridOptions.api.addGlobalListener((function(t){r.indexOf(t)>-1&&(e.debouncedSetColumnIntoStore(),e.debouncedFilterGrid())})),this.gridOptions.api.addEventListener(n.Events.EVENT_FIRST_DATA_RENDERED,(function(){e.checkColumnsDataTypeSet(),e.setLayout()})),this.gridOptions.api.addEventListener(n.Events.EVENT_CELL_EDITING_STARTED,(function(t){if(!e.gridOptions.columnApi.isPivotMode()){var o=e.adaptableOptions.editOptions.isCellEditable;if(o)o(e.getGridCellFromRowNode(t.node,t.column.getColId()),t.node)||e.gridOptions.api.stopEditing()}})),this.gridOptions.api.addEventListener(n.Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,(function(t){"columnPivotModeChanged"==t.type&&null!=t.columnApi&&null!=t.columnApi.columnController&&1==t.columnApi.columnController.pivotMode?(1==e.adaptableOptions.layoutOptions.autoSizeColumnsInPivotLayout&&e.gridOptions.columnApi.autoSizeAllColumns(),e.api.internalApi.setPivotModeOn()):e.api.internalApi.setPivotModeOff()})),this.gridOptions.api.addEventListener(n.Events.EVENT_COLUMN_PIVOT_CHANGED,(function(t){"columnPivotChanged"==t.type&&null!=t.columnApi&&null!=t.columnApi.columnController&&1==t.columnApi.columnController.pivotMode&&1==e.adaptableOptions.layoutOptions.autoSizeColumnsInPivotLayout&&e.gridOptions.columnApi.autoSizeAllColumns()}));var a=[n.Events.EVENT_COLUMN_PINNED,n.Events.EVENT_COLUMN_PIVOT_CHANGED,n.Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,n.Events.EVENT_DISPLAYED_COLUMNS_CHANGED,n.Events.EVENT_SORT_CHANGED,n.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,n.Events.EVENT_ROW_GROUP_OPENED,n.Events.EVENT_COLUMN_VALUE_CHANGED];this.gridOptions.api.addGlobalListener((function(t){a.indexOf(t)>-1&&e.debouncedSaveGridLayout()})),this.gridOptions.api.addEventListener(n.Events.EVENT_COLUMN_RESIZED,(function(t){1==t.finished&&"columnResized"==t.type&&t.column&&(e._emit("ColumnResized",t.column.getColId()),e.debouncedSaveGridLayout())}));var l=[n.Events.EVENT_ROW_GROUP_OPENED,n.Events.EVENT_SELECTION_CHANGED,n.Events.EVENT_ROW_SELECTED];this.gridOptions.api.addGlobalListener((function(t){S.ArrayExtensions.ContainsItem(l,t)&&e.debouncedSetSelectedRows()})),this.gridOptions.api.addEventListener(n.Events.EVENT_RANGE_SELECTION_CHANGED,(function(t){1==t.finished&&e.debouncedSetSelectedCells()})),this.gridOptions.api.addEventListener(n.Events.EVENT_SORT_CHANGED,(function(t){e.onSortChanged(),e.debouncedSetSelectedCells()}));var s=this.adaptableOptions.generalOptions.showGroupingTotalsAsHeader;this.gridOptions.api.addEventListener(n.Events.EVENT_MODEL_UPDATED,(function(t){if(s&&t&&t.api){var e=t.api.getPinnedTopRow(0),o=t.api.getModel().getRootNode();e?e.updateData(o.aggData):t.api.setPinnedTopRowData([o.aggData])}})),this.rowListeners={dataChanged:function(t){e.onRowDataChanged({rowNode:t.node,oldData:t.oldData,newData:t.newData})},cellChanged:function(t){t.column&&e.onCellDataChanged({rowNode:t.node,oldValue:t.oldValue,newValue:t.newValue,colId:t.column.colId})}},Z.dispatchLocalEvent=function(e){var o=e.node,i=$.apply(this,arguments);return o&&t.forEachAdaptable((function(t){if(o.gridApi===t.gridOptions.api){var i=t.rowListeners?t.rowListeners[e.type]:null;i&&i(e)}})),i};var u=this.gridOptions.isExternalFilterPresent;this.gridOptions.isExternalFilterPresent=function(){var t,o,n=e.api.filterApi.getAllColumnFilter(),r=S.ArrayExtensions.IsNotNullOrEmpty(n);if(r)try{for(var a=i.__values(n),l=a.next();!l.done;l=a.next()){var s=l.value,p=e.gridOptions.columnApi.getColumn(s.ColumnId);p&&!p.isFilterActive()&&p.setFilterActive(!0)}}catch(c){t={error:c}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(t)throw t.error}}else(e.gridOptions.columnApi.getAllColumns()||[]).forEach((function(t){t.isFilterActive()&&t.setFilterActive(!1)}));var d=A.StringExtensions.IsNotNullOrEmpty(e.api.queryApi.getCurrentQuery());return r||d||!!u&&u()};var p=this.gridOptions.doesExternalFilterPass;this.gridOptions.doesExternalFilterPass=function(t){var o,n;if(!e.api.internalApi.isServerSearchOptionSet("Query")){var r=e.api.queryApi.getCurrentQuery();if(r)if(!e.api.queryApi.isValidBooleanQuery(r,"Invalid CurrentQuery '"+r+"'")||!e.api.internalApi.getExpressionService().evaluateBooleanExpression(r,t))return!1}try{if(!e.api.internalApi.isServerSearchOptionSet("Filter")){var a=e.api.filterApi.getAllColumnFilter();if(a.length>0)try{for(var l=i.__values(a),s=l.next();!s.done;s=l.next()){var u=s.value;if(!e.api.filterApi.evaluateColumnFilter(u,t))return!1}}catch(d){o={error:d}}finally{try{s&&!s.done&&(n=l.return)&&n.call(l)}finally{if(o)throw o.error}}}}catch(c){return I.LogAdaptableError(c),!1}return!p||p(t)};var d=this.gridOptions.getMainMenuItems;this.gridOptions.getMainMenuItems=function(t){return e.agGridMenuHelper.buildColumnMenu(t,d)};var c=this.gridOptions.getContextMenuItems;this.gridOptions.getContextMenuItems=function(t){return e.agGridMenuHelper.buildContextMenu(t,c)},this.prepareGrid()}else"string"===typeof this.adaptableOptions.containerOptions.adaptableContainer?I.LogAdaptableError('There is no DIV with id="'+this.adaptableOptions.containerOptions.adaptableContainer+'" so cannot render Adaptable'):I.LogAdaptableError("No valid adaptableContainer found to render Adaptable",this.adaptableOptions.containerOptions.adaptableContainer)},t.prototype.buildStandaloneColumnHeader=function(t){return this.agGridMenuHelper.buildStandaloneColumnHeader(t)},t.prototype.prepareGrid=function(){try{this.updateColDefsForSpecialColumns(),this.applyCurrentTheme(),this.applyFinalRendering(),this.applyGridFiltering()}catch(t){I.LogAdaptableError("AgGrid setup failed"),I.LogAdaptableError(t)}},t.prototype.setupColumns=function(){var t=this,e=this.gridOptions.columnApi.getAllColumns();e.map((function(t){return t.getColDef()})).forEach(X),this.updateColumnsIntoStore(),e.forEach((function(e){var o=e.getColDef(),i=e.getColId(),n={col:e,colDef:o,colId:i,abColumn:t.api.columnApi.getColumnFromId(i)};t.setupColumnCellRenderer(n),t.setupColumnCellStyle(n),t.setupColumnCellClass(n),t.setupColumnTooltipValueGetter(n),t.setupColumnTooltipField(n),t.setupColumnValueGetter(n),t.setupColumnAggFunc(n),t.setupColumnFilter(n),t.setupColumnFloatingFilter(n),t.setupColumnValueFormatter(n),t.setupColumnValueSetter(n),t.setupColumnComparator(n),t.setupColumnCellEditor(n),t.setupColumnHeader(n)})),this.setupRowStyling(),this.redrawBody(),this.redrawHeader()},t.prototype.setGridOptionsProperty=function(t,e){var o="user."+t,i="adaptable."+t,n=this.gridOptions[t];n!==this.gridOptionsPropertyCache.get(i)&&this.gridOptionsPropertyCache.set(o,n);var r=this.gridOptionsPropertyCache.get(o),a=e(r);null!=a&&this.gridOptionsPropertyCache.set(i,a),this.gridOptions[t]=null!==a&&void 0!==a?a:r},t.prototype.setColDefProperty=function(t,e,o){var i=this,n=t.getColId(),r=t.getColDef(),a={col:t,colDef:r,colId:n},l="user."+n+"."+e,s="adaptable."+n+"."+e,u=r[e];u!==this.colDefPropertyCache.get(s)&&this.colDefPropertyCache.set(l,u);var p=this.colDefPropertyCache.get(l),d=o(p);null!=d&&this.colDefPropertyCache.set(s,d);var c=null!==d&&void 0!==d?d:p;this.forPlugins((function(t){t.interceptSetupColumnProperty&&(c=t.interceptSetupColumnProperty(a,e,c,i.api))})),"aggFunc"===e&&r[e]!==(null!==c&&void 0!==c?c:null)&&this.gridOptions.columnApi.setColumnAggFunc(n,null!==c&&void 0!==c?c:null),void 0===c&&void 0===r[e]||(r[e]=c)},t.prototype.getUserColDefProperty=function(t,e){var o="user."+t.getColId()+"."+e;return this.colDefPropertyCache.get(o)},t.prototype.setupColumnCellStyle=function(t){var e=this,o=t.col,n=(t.colId,t.abColumn);this.setColDefProperty(o,"cellStyle",(function(t){var o={backgroundColor:null,color:null,fontWeight:null,fontStyle:null,fontSize:null,borderColor:null},r=e.api.formatColumnApi.getFormatColumnForColumn(n),a=e.api.conditionalStyleApi.getConditionalStylesForColumn(n),l=e.getQuickSearchCellStyle(),s=void 0!=l;return function(u){var p=r?e.getFormatColumnCellStyle(r,u):void 0,d=s&&e.isQuickSearchActive(n,u);return i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign({},o),e.getReadOnlyCellStyle(n,u)),e.getEditableCellStyle(n,u)),"function"===typeof t?t(u):t),p),e.getConditionalStyleCellStyle(a,n,u)),d?l:void 0),e.getAlertCellStyle(n,u)),e.getFlashingAlertCellStyle(n,u)),e.getCellHighlightStyle(n,u))}}))},t.prototype.setupColumnCellClass=function(t){var e=this,o=t.col,i=t.colId,n=t.abColumn;this.setColDefProperty(o,"cellClass",(function(t){var o,r=e.api.formatColumnApi.getFormatColumnWithStyleClassNameForColumn(n),a=r?null===(o=r.Style)||void 0===o?void 0:o.ClassName:null,l=e.api.conditionalStyleApi.getConditionalStylesForColumn(n).filter((function(t){return A.StringExtensions.IsNotNullOrEmpty(t.Style.ClassName)})),s=S.ArrayExtensions.IsNotNullOrEmpty(l),u=e.api.quickSearchApi.getQuickSearchStyle().ClassName,p=A.StringExtensions.IsNotNullOrEmpty(u);return function(o){var r=p&&e.isQuickSearchActive(n,o),d=e.getPrimaryKeyValueFromRowNode(o.node),c=[e.getExcelClassNameForCell(i,d),"function"===typeof t?t(o):t,a,s?e.getConditionalStyleCellClass(l,n,o):null,r?u:null].filter((function(t){return!!t})).join(" ");return A.StringExtensions.IsNotNullOrEmpty(c)?c:void 0}}))},t.prototype.getExcelClassNameForCell=function(t,e){return"--excel-cell-"+t+"-"+e},t.prototype.setupColumnCellEditor=function(t){var e=this,o=t.colId,i=t.col,n=this.api.userInterfaceApi.getEditLookUpItemForColumn(o);this.setColDefProperty(i,"cellEditor",(function(){if(n)return e.isModulePresent("rich-select")?"agRichSelectCellEditor":"agSelectCellEditor"})),this.setColDefProperty(i,"cellEditorParams",(function(){if(n)return{values:e.api.userInterfaceApi.getEditLookUpValuesForEditLookUpItem(n,o)}}))},t.prototype.setupColumnCellRenderer=function(t){var e=this,o=t.col,i=t.colId,n=t.abColumn;this.setColDefProperty(o,"cellRenderer",(function(){var t=e.api.formatColumnApi.getFormatColumnForColumn(n);if(t&&t.ColumnStyle){if(t.ColumnStyle.PercentBarStyle)return e.agGridHelper.createNumericStyleRendererFunc(t);if(t.ColumnStyle.CheckBoxStyle)return e.agGridHelper.createCheckboxRendererComp(n.ColumnId,n.ReadOnly)}var o=e.api.sparklineColumnApi.getSparklineByColumn(i);if(o)return e.agGridHelper.createSparklineCellRendererComp(o)}))},t.prototype.setupColumnTooltipValueGetter=function(t){var e=this,o=t.col,i=t.colId;this.setColDefProperty(o,"tooltipValueGetter",(function(){var t,o=e.api.formatColumnApi.getFormatColumnForColumnId(i);if(o&&o.ColumnStyle&&o.ColumnStyle.PercentBarStyle&&o.ColumnStyle.PercentBarStyle.ToolTipText&&(null===(t=null===o||void 0===o?void 0:o.ColumnStyle)||void 0===t?void 0:t.PercentBarStyle))return function(t){var i=e.api.formatColumnApi.getNumericStyleMinValue(null===o||void 0===o?void 0:o.ColumnStyle,t.node,t.value),n=e.api.formatColumnApi.getNumericStyleMaxValue(null===o||void 0===o?void 0:o.ColumnStyle,t.node,t.value),r=o.ColumnStyle.PercentBarStyle.ToolTipText,a="";if(r.includes("CellValue"))if(o.DisplayFormat){var l=o.DisplayFormat.Options;a=l?w.default.NumberFormatter(t.value,l):t.value}else a=t.value;r.includes("PercentageValue")&&(a+=" ("+((N.Helper.clamp(t.value,i,n)-i)/(n-i)*100).toFixed(0)+"%)");return a||t.value}}))},t.prototype.setupColumnTooltipField=function(t){var e=this,o=t.col,i=t.colId,n=t.colDef;this.setColDefProperty(o,"tooltipField",(function(){var t=e.api.sparklineColumnApi.getSparklineByColumn(i);if(t)return t.ShowToolTip?n.field:""}))},t.prototype.setupColumnHeader=function(t){var e=this,o=t.col,i=t.abColumn;this.setColDefProperty(o,"headerName",(function(){var t=e.api.formatColumnApi.getFormatColumnForColumnId(i.ColumnId);if(t&&t.HeaderName)return i.FriendlyName=t.HeaderName,t.HeaderName}))},t.prototype.setupColumnFilter=function(t){var e=this,o=t.col,i=t.colDef;this.setColDefProperty(o,"filter",(function(){if(i.filter&&e.adaptableOptions.searchOptions.useAdaptableFilterForm)return e.gridOptions.api.destroyFilter(o),W.FilterWrapperFactory(e)}))},t.prototype.setupColumnFloatingFilter=function(t){var e=this,o=t.col,i=!t.colDef.floatingFilter||!this.adaptableOptions.searchOptions.useAdaptableQuickFilter;this.setColDefProperty(o,"floatingFilterComponent",(function(){if(!i)return j.FloatingFilterWrapperFactory(e)})),this.setColDefProperty(o,"floatingFilterComponentParams",(function(){if(!i)return{suppressFilterButton:!0}}))},t.prototype.setupColumnValueFormatter=function(t){var e=this,o=t.col,i=t.abColumn;this.setColDefProperty(o,"valueFormatter",(function(){var t=e.api.formatColumnApi.getFormatColumnWithDisplayFormatForColumn(i);if(t&&t.DisplayFormat){var o=void 0;if("NumberFormatter"===t.DisplayFormat.Formatter&&e.api.scopeApi.isColumnInNumericScope(i,t.Scope)){var n=t.DisplayFormat.Options;o=function(t){return w.default.NumberFormatter(t.value,n)}}if("DateFormatter"===t.DisplayFormat.Formatter&&e.api.scopeApi.isColumnInDateScope(i,t.Scope)){var r=t.DisplayFormat.Options;o=function(t){return w.default.DateFormatter(t.value,r)}}if("StringFormatter"===t.DisplayFormat.Formatter&&e.api.scopeApi.isColumnInStringsScope(i,t.Scope)){var a=t.DisplayFormat.Options;o=function(t){return w.default.StringFormatter(t.value,a)}}return o}}))},t.prototype.setupColumnValueSetter=function(t){var e=this,o=t.col,i=t.colId,n=t.abColumn;this.setColDefProperty(o,"valueSetter",(function(t){var o,r=e.api.alertApi.getAlertDefinitionsWithPreventEdit().filter((function(t){return e.api.scopeApi.isColumnInScope(n,t.Scope)})),a=e.adaptableOptions.editOptions.isCellEditable,l=!r.length&&!(null===(o=e.adaptableOptions.editOptions)||void 0===o?void 0:o.validateOnServer);if(!l||a){return function(o){var n;if(a){var s=e.getGridCellFromRowNode(o.node,o.column.getColId());if(!a(s,o.node))return!1}var u=o.column.getColDef().field;if(l)return"function"===typeof t?t(o):(u&&(o.data[u]=o.newValue),!0);var p=e.api.internalApi.buildDataChangedInfo({oldValue:o.oldValue,newValue:o.newValue,columnId:o.column.getColId(),primaryKeyValue:e.getPrimaryKeyValueFromRowNode(o.node),rowNode:o.node,trigger:"edit"});if(!r.length)return!0;if(p.oldValue===p.newValue)return!0;if(!e.ValidationService.performValidation(p))return!1;if((null===(n=e.adaptableOptions.editOptions)||void 0===n?void 0:n.validateOnServer)&&e.ValidationService.performServerValidation(p,{onServerValidationCompleted:function(){}})(),"function"===typeof t)return t(o);if(!u)throw"Cannot edit a column without a field - column id was "+i;return o.data[u]=o.newValue,!0}}}))},t.prototype.setupColumnComparator=function(t){var e=this,o=t.col,i=t.colId,n=t.abColumn,r=this.api.customSortApi.getCustomSortByColumn(i),a=this.api.internalApi.getColumnSortComparer(n),l=function(){if(r||a)return a?a.comparer:e.runAdaptableComparerFunction(r.ColumnId,r.SortedValues)};this.setColDefProperty(o,"comparator",l),this.setColDefProperty(o,"pivotComparator",l)},t.prototype.applyCurrentTheme=function(){this.api.themeApi.applyCurrentTheme()},t.prototype.applyFinalRendering=function(){this.embedColumnMenu=this.isModulePresent("menu"),this.gridOptions.defaultGroupSortComparator=this.agGridHelper.runAdaptableNodeComparerFunction(),this.gridOptions.treeData&&1==this.gridOptions.treeData?this.api.internalApi.setTreeModeOn():this.api.internalApi.setTreeModeOff(),this.agGridHelper.checkShouldClearExistingFiltersOrSearches()},t.prototype.isModulePresent=function(t){var e=n.ModuleRegistry.getRegisteredModules().concat(this.agGridModules).map((function(t){return t.moduleName}));return S.ArrayExtensions.ContainsAnyItem(e,["@ag-grid-enterprise/"+t,"@ag-grid-enterprise/all-modules"])},t.prototype.onRowDataChanged=function(t){var e=this,o=t.rowNode,i=t.oldData,n=t.newData;if(null!=i&&void 0!=i&&i!=n){var r=this.getPrimaryKeyValueFromRowNode(o);if(r){var a=[];Object.keys(i).forEach((function(t){if(e.api.columnApi.doesColumnExist(t)){var l=i[t],s=n[t];if(l!=s){var u=e.api.internalApi.buildDataChangedInfo({oldValue:l,newValue:s,columnId:t,primaryKeyValue:r,rowNode:o,trigger:"tick"});a.push(u)}}})),this.performPostEditChecks(a)}}},t.prototype.onCellDataChanged=function(t){var e=t.rowNode,o=t.oldValue,i=t.newValue,n=t.colId;if(o!=i){var r=this.getPrimaryKeyValueFromRowNode(e);if(r&&this.api.columnApi.doesColumnExist(n)){var a=this.api.internalApi.buildDataChangedInfo({oldValue:o,newValue:i,columnId:n,primaryKeyValue:r,rowNode:e,trigger:"edit"});this.performPostEditChecks([a])}}},t.prototype.performPostEditChecks=function(t){var e=this,o=t[0];if(o&&o.rowNode){var i=this.isVisibleNode(o.rowNode);t.forEach((function(t){"edit"==t.trigger&&(e.checkChangedCellCurrentlySelected(t),e.api.freeTextColumnApi.checkFreeTextColumnForDataChange(t)),e.DataService.CreateDataChangedEvent(t)})),i&&this.refreshExpressionStylesIfNeeded(o.rowNode,t),"tick"==o.trigger?this.filterOnTickingDataChange():this.filterOnEditDataChange()}},t.prototype.refreshExpressionStylesIfNeeded=function(t,e){var o=this,i=this.api.conditionalStyleApi.getConditionalStylesWithExpression();if(!S.ArrayExtensions.IsNullOrEmpty(i)){var n=!1,r=!1,a=new Set,l=new Set;e.forEach((function(t){n||i.forEach((function(e){if(!n){o.api.queryApi.getColumnsFromExpression(e.Rule.BooleanExpression).forEach((function(t){return a.add(t)}));var i=a.has(t.columnId);if(o.api.scopeApi.scopeIsAll(e.Scope)){if(i)return void(n=!0)}else o.api.scopeApi.getColumnsForScope(e.Scope).map((function(t){return t.ColumnId})).forEach((function(t){l.add(t)}))}})),a.has(t.columnId)&&(r=!0)})),n?this.redrawRow(t):r&&this.refreshCells([t],Array.from(l.values()),!0)}},t.prototype.checkChangedCellCurrentlySelected=function(t){var e=this.api.gridApi.getSelectedCellInfo();e&&S.ArrayExtensions.IsNotNullOrEmpty(e.gridCells)&&(e.gridCells.find((function(e){return e.primaryKeyValue==t.primaryKeyValue&&e.columnId==t.columnId}))&&this.setSelectedCells());var o=this.api.gridApi.getSelectedRowInfo();o&&S.ArrayExtensions.IsNotNullOrEmpty(o.GridRows)&&(o.GridRows.find((function(e){return e.primaryKeyValue==t.primaryKeyValue}))&&this.setSelectedRows())},t.prototype.getColumnSorts=function(){var t=[];return this.gridOptions.columnApi.getColumnState().forEach((function(e){var o=e.colId;e.sort&&null!=e.sortIndex&&t.push({ColumnId:o,SortOrder:"asc"===e.sort?"Asc":"Desc",SortIndex:e.sortIndex})})),t.sort((function(t,e){return t.SortIndex-e.SortIndex})),t.map((function(t){return{ColumnId:t.ColumnId,SortOrder:t.SortOrder}}))},t.prototype.onSortChanged=function(){var t=this.getColumnSorts();this.api.gridApi.setColumnSorts(t),this._emit("SortChanged",t)},t.prototype.expandAllRowGroups=function(){this.gridOptions.api.forEachNode((function(t){t.group&&(t.expanded=!0)})),this.gridOptions.api.onGroupExpandedOrCollapsed()},t.prototype.closeAllRowGroups=function(){this.gridOptions.api.forEachNode((function(t){t.group&&(t.expanded=!1)})),this.gridOptions.api.onGroupExpandedOrCollapsed()},t.prototype.expandRowGroupsForValues=function(t){if(S.ArrayExtensions.IsNotNullOrEmpty(t)){var e=t.reduce((function(t,e){return t[e]=!0,t}),{});this.gridOptions.api.forEachNode((function(t){if(t.group&&!t.expanded){for(var o=[],i=t;i;)o.push(i.key),i=i.parent;var n=o.filter((function(t){return!!t})).reverse().join("/");e[n]&&t.setExpanded(!0)}})),this.gridOptions.api.onGroupExpandedOrCollapsed()}},t.prototype.getVendorGridColumnFieldForColumn=function(t){return this.gridOptions.columnApi.getAllColumns().find((function(e){return e.getColId()===t.ColumnId})).getColDef().field||""},t.prototype.getExpandRowGroupsKeys=function(){var t=[];return this.adaptableOptions.layoutOptions.includeExpandedRowGroups&&this.gridOptions.api.forEachNode((function(e){if(e.group&&e.expanded){for(var o=e,i=[];o;)i.push(o.key),o=o.parent;t.push(i.filter((function(t){return!!t})).reverse().join("/"))}})),t},t.prototype.getRowCount=function(){return this.gridOptions.rowData?this.gridOptions.rowData.length:this.gridOptions.api.getDisplayedRowCount()},t.prototype.getColumnCount=function(){return this.gridOptions.columnApi.getAllColumns().length},t.prototype.getVisibleRowCount=function(){return this.gridOptions.api.getDisplayedRowCount()},t.prototype.getVisibleColumnCount=function(){return this.gridOptions.columnApi.getAllColumns().filter((function(t){return t.isVisible()})).length},t.prototype.selectColumns=function(t){var e=this;t.forEach((function(t){return e.selectColumn(t)}))},t.prototype.selectColumn=function(t){this.gridOptions.api.clearRangeSelection();var e={rowStartIndex:0,rowEndIndex:this.gridOptions.api.getDisplayedRowCount(),columnStart:t,columnEnd:t};this.gridOptions.api.addCellRange(e)},t.prototype.selectAll=function(){this.gridOptions.api.selectAll()},t.prototype.hideColumn=function(t){this.gridOptions.columnApi.getColumn(t)&&(this.gridOptions.columnApi.setColumnVisible(t,!1),this.updateColumnsIntoStore())},t.prototype.showColumn=function(t){this.gridOptions.columnApi.getColumn(t)&&(this.gridOptions.columnApi.setColumnVisible(t,!0),this.updateColumnsIntoStore())},t.prototype.setColumnSort=function(t){var e=t.reduce((function(t,e,o){return t[e.ColumnId]=i.__assign(i.__assign({},e),{SortIndex:o}),t}),{});if(this.gridOptions.api){var o=this.gridOptions.columnApi.getColumnState().map((function(t){var o=t.colId,n=i.__assign({},t),r=e[o];return r?(n.sort="Asc"===r.SortOrder?"asc":"desc",n.sortIndex=r.SortIndex):(n.sort=null,n.sortIndex=null),n}));this.gridOptions.columnApi.setColumnState(o),this.gridOptions.api.onSortChanged()}},t.prototype.setDataSource=function(t){this.gridOptions.api&&(this.hasAutogeneratedPrimaryKey()&&this.addSyntheticPrimaryKey(t),this.gridOptions.api.setRowData(t))},t.prototype.loadDataSource=function(t){this.hasAutogeneratedPrimaryKey()&&this.addSyntheticPrimaryKey(t),this.setDataSource(t)},t.prototype.updateRows=function(t,e){this.hasAutogeneratedPrimaryKey()&&this.addSyntheticPrimaryKeyIfMissing(t),(e=e||{}).runAsync?this.gridOptions.api.applyTransactionAsync({update:t},e.callback):this.gridOptions.api.applyTransaction({update:t})},t.prototype.addRows=function(t,e){this.hasAutogeneratedPrimaryKey()&&this.addSyntheticPrimaryKey(t),(e=e||{}).runAsync?this.gridOptions.api.applyTransactionAsync({add:t},e.callback):this.gridOptions.api.applyTransaction({add:t})},t.prototype.deleteRows=function(t,e){(e=e||{}).runAsync?this.gridOptions.api.applyTransactionAsync({remove:t},e.callback):this.gridOptions.api.applyTransaction({remove:t})},t.prototype.getFirstGroupedColumn=function(){var t=this.gridOptions.columnApi.getRowGroupColumns();if(S.ArrayExtensions.IsNotNullOrEmpty(t)){var e=t[0];return this.api.columnApi.getColumnFromId(e.getColId())}},t.prototype.checkColumnsDataTypeSet=function(){var t=this.api.columnApi.getColumns()[0];t&&t.DataType==f.DataType.Unknown&&this.updateColumnsIntoStore()},t.prototype.runAdaptableComparerFunction=function(t,e){var o=this;return function(i,n,r,a){var l=r?o.getDisplayValueFromRowNode(r,t):i,s=a?o.getDisplayValueFromRowNode(a,t):n,u=e.indexOf(l),p=u>=0,d=e.indexOf(s),c=d>=0;return p||c?p?c?u-d:-1:1:i==n?0:i<n?-1:1}},t.prototype.isGridSelectable=function(){return!(!this.isModulePresent("range-selection")||null==this.gridOptions.enableRangeSelection||!this.gridOptions.enableRangeSelection)},t.prototype.isGridGroupable=function(){return!this.api.internalApi.isGridInTreeMode()},t.prototype.isGridGroupingActive=function(){var t=!1;return this.gridOptions.api.forEachNode((function(e){t||e.group&&(t=!0)})),t},t.prototype.isGridPivotable=function(){return!this.api.internalApi.isGridInTreeMode()},t.prototype.isQuickFilterAvailable=function(){return!0===this.hasFloatingFilterOnAtLeastOneColumn()},t.prototype.hasFloatingFilterOnAtLeastOneColumn=function(t){var e,o,n;if(void 0===t&&(t=this.gridOptions.columnDefs),this.gridOptions.defaultColDef&&this.gridOptions.defaultColDef.floatingFilter)return!0;try{for(var r=i.__values(t),a=r.next();!a.done;a=r.next()){if((n=a.value).floatingFilter)return!0;if(n.children&&this.hasFloatingFilterOnAtLeastOneColumn(n.children))return!0}}catch(l){e={error:l}}finally{try{a&&!a.done&&(o=r.return)&&o.call(r)}finally{if(e)throw e.error}}return!1},t.prototype.showQuickFilter=function(){this.gridOptions.api.setFloatingFiltersHeight(null)},t.prototype.hideQuickFilter=function(){this.gridOptions.api.setFloatingFiltersHeight(0)},t.prototype.getVendorColumnType=function(t){var e;return(null!==(e=this.gridOptions.api.getColumnDef(t))&&void 0!==e?e:{}).type||""},t.prototype.getVendorGridLightThemeName=function(){var t=this.getGridContainerElement();if(t&&t.classList)for(var e=t.classList,o=0,i=e.length;o<i;o++){var n=e[o];if(0===n.indexOf("ag-theme-"))return n.replace("-dark","")}return this.agGridHelper.getVendorLightThemeName()},t.prototype.getVendorGridCurrentThemeName=function(){var t=this.getGridContainerElement();if(t&&t.classList)for(var e=t.classList,o=0,i=e.length;o<i;o++){var n=e[o];if(0===n.indexOf("ag-theme-"))return n}return this.getVendorGridLightThemeName()},t.prototype.applyAdaptableTheme=function(t){var e=this,o="string"===typeof t?t:t.Name,n=[],r=[],a=this.api.themeApi.getAllTheme().map((function(t){return i.__assign({},t)})).reduce((function(t,e){return t[e.Name]=e,t}),{}),l=document.documentElement;l.classList.forEach((function(t){if(0===t.indexOf(g.THEME_STYLE)){n.push(t);var e=t.substring(g.THEME_STYLE.length);a[e]&&r.push(a[e])}})),n.forEach((function(t){return l.classList.remove(t)})),r.forEach((function(t){l.classList.remove("it--theme-"+t.Name)})),this.adaptableOptions.userInterfaceOptions&&this.adaptableOptions.userInterfaceOptions.useCustomMacLikeScrollbars&&E.default()>0?l.classList.add("ab--custom-mac-like-scrollbars"):l.classList.remove("ab--custom-mac-like-scrollbars");var s=a[o],u=g.THEME_STYLE+o;l.classList.add(u),l.classList.add("it--theme-"+o);var p=getComputedStyle(l),d=i.__read(["--ab-loaded","--ab-theme-loaded"].map((function(t){var e=p.getPropertyValue(t);return"string"===typeof e&&e.trim&&(e=e.trim()),e})),2),c=d[0],f=d[1],h=!!this.api.themeApi.getAllSystemTheme().filter((function(t){return t.Name===o}))[0],m=this.getGridContainerElement(),y=function(){return e.getVendorGridLightThemeName()};if(s&&h&&(o===C.LIGHT_THEME&&(s.VendorGridClassName=s.VendorGridClassName||y()),o===C.DARK_THEME&&(s.VendorGridClassName=s.VendorGridClassName||y()+"-dark")),s.VendorGridClassName||(s.VendorGridClassName=y()),null!=m){r.length&&r.forEach((function(t){t.VendorGridClassName&&m.classList.remove(t.VendorGridClassName)}));var v=[];m.classList.forEach((function(t){t&&0===t.indexOf("ag-theme-")&&v.push(t)})),v.forEach((function(t){return m.classList.remove(t)})),s&&s.VendorGridClassName&&m.classList.add(s.VendorGridClassName),m.classList.add("ab-Grid"),this.adaptableOptions.searchOptions.indicateFilteredColumns&&m.classList.add("ab-Grid--indicate-filtered-columns")}"777"!==c&&I.ConsoleLogError('Please import Adaptable styles from "adaptableadaptable/index.css"'),f!==o&&I.ConsoleLogWarning('Theme "'+o+'" doesn\'t seem to be loaded! Make sure you import the css file for the "'+o+'" theme!\n\nIf it\'s a default theme, try\n\nimport "@adaptabletools/adaptable/themes/'+o+'.css"')},t.prototype.setupRowStyling=function(){var t=this,e=this.api.conditionalStyleApi.getRowConditionalStyles();this.setGridOptionsProperty("getRowStyle",(function(o){return function(n){return i.__assign(i.__assign({},null===o||void 0===o?void 0:o(n)),t.getConditionalStyleRowStyle(e,n))}})),this.setGridOptionsProperty("getRowClass",(function(o){return function(i){var n=["function"===typeof o?o(i):o,t.getConditionalStyleRowClass(e.filter((function(t){return A.StringExtensions.IsNotNullOrEmpty(t.Style.ClassName)})),i)].filter((function(t){return!!t})).join(" ");return A.StringExtensions.IsNotNullOrEmpty(n)?n:void 0}}))},t.prototype.getConditionalStyleRowClass=function(t,e){if(S.ArrayExtensions.IsNotNullOrEmpty(t)){var o=this.ModuleService.getModuleById(y.ConditionalStyleModuleId);return t.map((function(t){var i;if(o.isConditionalStyleActiveForRow(t,e))return null===(i=t.Style)||void 0===i?void 0:i.ClassName})).filter((function(t){return!!t})).join(" ")}},t.prototype.getConditionalStyleRowStyle=function(t,e){if(S.ArrayExtensions.IsNotNullOrEmpty(t)){var o=this.ModuleService.getModuleById(y.ConditionalStyleModuleId),i=t.find((function(t){return o.isConditionalStyleActiveForRow(t,e)}));if(i)return this.convertAdaptableStyleToCSS(i.Style)}},t.prototype.getGridOptionsApi=function(){if(this.gridOptions.api)return this.gridOptions.api;I.LogAdaptableError("There is a problem with your instance of ag-Grid - it has no gridApi object.  Please contact Support.")},t.prototype.canExportToExcel=function(){return this.isModulePresent("excel-export")},t.prototype.exportToExcel=function(t,e){var o=t.columns.map((function(t){return{field:t.ColumnId,headerName:t.FriendlyName}})),i=t.columns.filter((function(t){return t.ColumnId.includes(".")}));i.length&&t.rows.forEach((function(t){return i.forEach((function(e){var o=t[e.ColumnId];e.ColumnId.split(".").reverse().forEach((function(t){var e;return(e={})[t]=o,o=e})),delete t[e.ColumnId],Object.assign(t,o)}))}));var r={columnDefs:o,rowData:t.rows},a=new n.Grid(document.createElement("div"),r);r.api.exportDataAsExcel({sheetName:"Sheet 1",fileName:e}),a.destroy()},t.prototype.setExcelStylesForExport=function(){var t=this;this.setGridOptionsProperty("excelStyles",(function(e){var o=[],n=t.gridOptions.columnApi.getAllDisplayedColumns(),r=n.map((function(t){return t.getColDef()}));return t.forAllVisibleRowNodesDo((function(a,l){var s={node:a,data:a.data,rowIndex:l,$scope:{},api:t.gridOptions.api,columnApi:t.gridOptions.columnApi,context:{}},u=t.gridOptions.getRowStyle(s);n.forEach((function(n,s){var p=r[s],d={colDef:p,node:a,data:a.data,value:t.getRawValueFromRowNode(a,n.getId()),rowIndex:l,$scope:{},api:t.gridOptions.api,columnApi:t.gridOptions.columnApi,context:{}},c="function"===typeof p.cellStyle?p.cellStyle(d):{},f=[],h=t.getUserColDefProperty(n,"cellClass"),m=h&&e.find((function(t){return t.id===h}));m&&f.push(m);var g=i.__assign(i.__assign({},u),Object.keys(c).reduce((function(t,e){return null!==c[e]&&(t[e]=c[e]),t}),{}));if(Object.values(g).some((function(t){return null!=t}))&&f.push(t.convertCSSToExcelStyle(g)),f.length){var C="function"===typeof p.cellClass?p.cellClass(d):t.getExcelClassNameForCell(n.getId(),t.getPrimaryKeyValueFromRowNode(a)),y=Object.assign.apply(Object,i.__spread([{}],f,[{id:C}]));o.push(y)}}))})),o}))},t.prototype.exportVisualDataToExcel=function(){var t=this;this.setExcelStylesForExport(),this.gridOptions.api.exportDataAsExcel({sheetName:"Sheet 1",fileName:this.ReportService.getReportFileName(this.adaptableOptions.adaptableId),processCellCallback:function(e){return t.processCellForExcelExport(e)}}),this.setGridOptionsProperty("excelStyles",(function(t){return t}))},t.prototype.convertAdaptableStyleToCSS=function(t){return q.convertAdaptableStyleToCSS(t)},t.prototype.convertCSSToExcelStyle=function(t){var e=function(t){var e=J(t),o=e.getAlpha();return J.mix(J("white"),e,100*o).toHexString()},o={};if(null!=t.backgroundColor&&(o.interior={color:e(t.backgroundColor),pattern:"Solid"}),null!=t.borderColor){var i={color:t.borderColor,lineStyle:"Continuous",weight:1};o.borders={borderBottom:i,borderLeft:i,borderRight:i,borderTop:i}}return t.textAlign&&(o.alignment={horizontal:A.StringExtensions.CapitaliseFirstLetter(t.textAlign)}),null!=t.color&&(o.font||(o.font={}),o.font={color:e(t.color)}),"italic"===t.fontStyle&&(o.font||(o.font={}),o.font.italic=!0),null!=t.fontWeight&&("bold"===t.fontWeight||Number(t.fontWeight)>=600)&&(o.font||(o.font={}),o.font.bold=!0),null!=t.fontSize&&(o.font||(o.font={}),o.font.size=q.convertCSSAbsoluteFontSizeToPt(t.fontSize)),o},t.prototype.processCellForExcelExport=function(t){return this.ReportService.getCellExportValueFromRowNode(t.node,t.column.getColId())},t.prototype.hasAutogeneratedPrimaryKey=function(){return this.adaptableOptions.autogeneratePrimaryKey},t.prototype.addSyntheticPrimaryKey=function(t){void 0===t&&(t=[]);for(var e=0;e<t.length;e++)t[e][C.AUTOGENERATED_PK_COLUMN]=h.createUuid()},t.prototype.addSyntheticPrimaryKeyIfMissing=function(t){void 0===t&&(t=[]),this.adaptableOptions.primaryKey=C.AUTOGENERATED_PK_COLUMN;for(var e=0;e<t.length;e++)t[e][C.AUTOGENERATED_PK_COLUMN]||(t[e][C.AUTOGENERATED_PK_COLUMN]=h.createUuid())},t}();e.Adaptable=it;var nt=function(){function t(t,e){var o=this;void 0===e&&(e={});this.adaptableOptions=t,this.init=e.onInit||function(t){var e=t.gridOptions,n=t.adaptableOptions;return i.__awaiter(o,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return n.vendorGrid=e,[4,it.init(n)];case 1:return[2,t.sent()]}}))}))},this.extraOptions=e,this.render()}return t.prototype.render=function(t){var e,o=this,n=v.DefaultAdaptableOptions.containerOptions.adaptableContainer||"adaptable";if(!t){var r=null===(e=this.adaptableOptions.containerOptions)||void 0===e?void 0:e.adaptableContainer;r&&("string"===typeof r?n=null!==r&&void 0!==r?r:n:t=r)}if(!(t=t||document.getElementById(n)))throw new Error("Cannot find container in which to render Adaptable No Code Wizard");t.classList.add("adaptable--in-wizard"),p.render(u.createElement(k.default,i.__assign(i.__assign({adaptableOptions:this.adaptableOptions},this.extraOptions),{onInit:function(e){t.classList.remove("adaptable--in-wizard"),p.unmountComponentAtNode(t),o.init({adaptableOptions:e,gridOptions:e.vendorGrid})}})),t)},t}();e.AdaptableNoCodeWizard=nt}}]);